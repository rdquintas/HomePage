(function(){MQA.withModule("nominatimio",function(){var C=window.MQA,B=C.Log.debug,A=C.extend;runSearch=function(E,D,F,H){var G=new C.NominatimIO();G.search(E,D,F,function(I){if(F){C.Nominatim.processResults(I,F)}if(C.Util.isFunction(H)){H(I)}})};runReverse=function(H,D,E,G){var F=new C.NominatimIO();F.reverse(H,D,E,function(J,K,I){J.lon=I;J.lat=K;if(E){C.Nominatim.processResults(J,E)}if(C.Util.isFunction(G)){G(J)}})};Nominatim={constructPOI:function(D,E){return this._constructPOI(D,E)},_constructPOI:function(D,E){var H=MQICONSERVER+"/icons/";if(!E){H+="map-center.png"}else{H+="search.png?text="+E}var G=D.display_name,J=D.lat,F=D.lon,I=new C.Poi({lat:J,lng:F},new C.Icon(H,20,29));I.setRolloverContent("<div style='white-space: nowrap'>LatLng: "+J+", "+F+"</div>");I.setInfoTitleHTML(G);I.setInfoContentHTML(G);return I},processResults:function(D,E){this._processResults(D,E)},_processResults:function(E,G){if(E&&E[0]){if(E[1]){var F=0,H=E.length;for(;F<H;F++){var D=E[F];if(D){G.addShape(this.constructPOI(D,F+1))}}}else{G.addShape(this.constructPOI(E[0]))}G.bestFit()}else{if(E){G.addShape(this.constructPOI(E))}}},search:function(D,E,F,G){if(!E){E={}}if(F&&!E.viewbox){E.viewbox={};E.viewbox.top=F.getBounds().ul.lat;E.viewbox.left=F.getBounds().ul.lng;E.viewbox.bottom=F.getBounds().lr.lat;E.viewbox.right=F.getBounds().lr.lng}if(!E.format){E.format="json"}runSearch(D,E,F,G)},reverse:function(E,D,F,G){if(!D){D={}}if(!D.format){D.format="json"}runReverse(E,D,F,G)}};A(C.TileMap.prototype,{nominatimSearchAndAddLocation:function(D,E){C.Nominatim.search(D,null,this,E)},nominatimReverseAndAddLocation:function(E,D){C.Nominatim.reverse(E,null,this,D)}});C.Nominatim=Nominatim;C.Loader._moduleLoaded("nominatim")})})();