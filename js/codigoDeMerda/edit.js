define("compiled/edit",function(){}),/**
 * @license
 * jQuery autoGrowInput plugin by James Padolsey
 * expands a text field to accommodate its contents
 * borrowed from
 * http://jsbin.com/ahaxe
 * http://stackoverflow.com/questions/1288297/jquery-auto-size-text-input-not-textarea
 * See related thread: http://stackoverflow.com/questions/931207/is-there-a-jquery-autogrow-plugin-for-text-fields
 */
function(e){e.fn.autoGrowInput=function(t){return t=e.extend({maxWidth:1e7,minWidth:10,comfortZone:20},t),this.filter("input:text").each(function(){var i=t.minWidth||e(this).width(),a="",o=e(this),n=e('<span class="autoGrowInputTester" />').css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),letterSpacing:o.css("letterSpacing"),whiteSpace:"nowrap"}),s=function(){if(a!==(a=o.val())){var e=a.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");n.html(e);var s=n.width(),r=s+t.comfortZone>=i?s+t.comfortZone:i,l=o.width(),c=l>r&&r>=i||r>i&&r<t.maxWidth;c&&o.width(r)}};n.insertAfter(o),e(this).bind("keyup keydown blur focus update change",s)}),this}}(jQuery),define("autoGrowInput",function(){}),define("class/removable",[],function(){var e=function(e,t){var i=this;i.node=$(e),i.o=$.extend({trigger:".remove",animate:"none",animateSpeed:250},t),i.init()};return e.prototype={init:function(){var e=this;e.node.find(e.o.trigger).unbind("click.removable").bind("click.removable",function(t){t.preventDefault(),e.remove()})},remove:function(){var e=this;if(e.o.beforeRemove){var t=e.o.beforeRemove.call(e);if(!t)return}switch(e.o.animate){case"slideUp":e.slideUp();break;case"fadeOut":e.fadeOut();break;default:e.destroy()}},slideUp:function(){var e=this;e.node.animate({height:"0","margin-bottom":"0",opacity:"0"},e.o.animateSpeed,function(){e.destroy()})},fadeOut:function(){var e=this;e.node.animate({opacity:"0"},e.o.animateSpeed,function(){e.destroy()})},destroy:function(){var e=this;e.node.remove(),e.o.afterRemove&&e.o.afterRemove.call(e),e.node.trigger("removable_removed"),e.node.removeData("removable"),delete e.node}},$.fn.removable=function(t){return this.each(function(){var i=$(this);i.data("removable",new e(this,t))})},e}),define("class/typeahead",["log","class/menu","lib/ajax","lib/utils","lib/event"],function(e,t,i,a,o){e.module("class/typeahead");var n=function(t,i){var a=this;return a.o=$.extend({forcewidth:!1,keyboard:!0,menuClass:"light",menuNode:"<div />"},i),a.field=$(t),a.field.closest(".autocompletemenu").length?void e.error("This field is already autocompleted."):(a.field.wrap(a.o.menuNode),a.node=a.field.parent(),a.node.addClass("autocompletemenu"),a.node.append('<ul class="menu-content"></div>'),void a.init())};return n.prototype={init:function(){var e=this;e.node.addClass(e.o.menuClass),e.field.attr("autocomplete","off"),e.node.menu({keyboard:e.o.keyboard,forcewidth:e.o.forcewidth,afterShow:function(){e.o.menuAfterShow&&e.o.menuAfterShow.call(e)},afterHide:function(){e.o.menuAfterHide&&e.o.menuAfterHide.call(e)},afterSelect:function(){e.o.menuAfterSelect&&e.o.menuAfterSelect.call(e)},afterUnselect:function(){e.o.menuAfterUnselect&&e.o.menuAfterUnselect.call(e)},afterInit:function(){e.menu=this,e.field.on("keyup.autocomplete",function(){var t=$(this);$.doTimeout("autocomplete_menushow",200,function(){var i=t.val();i.length>=2?i!=t.data("lastval")&&e.autocomplete(i):e.menu.hide(),e.terms="",t.data("lastval",i)})}),e.menu.menuitems.on("click","li.item",function(){var t=$(this);e.field.data("lastval",t.text()),e.field.val(t.text()),e.menu.hide(),e.o.afterSelect&&e.o.afterSelect.call(e),o.trigger("autocomplete_select",e.field)})}}),e.field.blur(function(){$(".autocompletemenu li.item.selected").length||e.menu.hide()}),e.o.afterInit&&e.o.afterInit.call(e)},autocomplete:function(e){var t=this,a={value:e,corpus:t.o.corpus,hint:t.o.hint},o={success:function(e){t.autocomplete_success.call(t,e)},error:function(e){t.autocomplete_error.call(t,e)}};$.doTimeout("search_autocomplete",100,function(){i.post("autocomplete",a,o)})},autocomplete_success:function(t){e("autocomplete_success");var i=this;if(!t.matches)return void i.autocomplete_error(t);var o=i.field.val();if(o!=t.value)return void e("Not showing mismatched autocomplete results");if(i.terms==t.value)return void e("A search has already been completed with these terms. Not showing autocomplete results");if(t.matches.length){var n=i.autocomplete_dedupe(t.matches);i.menu.node.find("ul").empty(),$.each(n,function(e,t){var o=$('<li class="item"><span>'+a.htmlEncode(t.term)+"</span></li>");i.menu.node.find("ul").append(o)}),i.menu.show()}else i.menu.hide();i.o.afterSuccess&&i.o.afterSuccess.call(i)},autocomplete_dedupe:function(e){var t={},i=[];for(var a in e)t[e[a].term]||(t[e[a].term]=!0,i.push(e[a]));return i},autocomplete_error:function(){e("autocomplete_error");var t=this;t.menu.hide(),t.o.afterError&&t.o.afterError.call(t)}},$.fn.typeahead=function(e){return this.each(function(){var t=$(this);t.data("typeahead",new n(this,e))})},$(document).ready(n.init),n}),define("class/tokenbox",["log","lib/utils","lib/event","autoGrowInput","class/removable","class/typeahead"],function(e,t,i){e.module("class/tokenbox");var a=function(e,t){this.node=$(e),this.o=$.extend({debug:!1,typeahead:!1,allowPaste:!0,trimtext:!0,allowemptytext:!1,ignoreinvalidinput:!1,sortable:!0,allowinput:!0,tokenize_keycodes:[9,13,32,188]},t),this.init()};return a.prototype={init:function(){var e=this;if(e.o.limit&&(e.o.limitmessage=e.o.limitmessage||"Only "+e.o.limit+" items allowed.","undefined"==typeof e.o.limitcallback&&(e.o.limitcallback=function(){var e=this;e.limited?e.alarum||(e.alarum=$('<label class="alarum">'+e.o.limitmessage+"</label>"),e.node.after(e.alarum)):e.alarum&&(e.alarum.remove(),e.alarum=null)})),e.o.allowinput&&e.setupInput(),e.o.id){var t=e.o.debug?"text":"hidden";e.partner=$('<input type="'+t+'" id="'+e.o.id+'" name="'+e.o.id+'" size="100" />'),e.node.after(e.partner)}e.o.sortable&&$(e.node).sortable({containment:"parent",tolerance:"pointer",items:".token",cancel:"input.tokeninput, .remove",scroll:!1,start:function(t,i){e.node.addClass("dragging"),e.node.find(".selected").removeClass("selected"),i.item.addClass("selected shadow"),i.placeholder.html("&nbsp;").css({border:"1px dotted #666",height:"auto",opacity:.2}).vshow(),e.inputNode.blur()},stop:function(t,i){e.node.removeClass("dragging"),i.item.removeClass("selected shadow"),e.changed(),e.inputNode.focus()}}),e.o.init&&e.o.init.call(e),e.o.typeahead&&(e.typeahead=e.inputNode.typeahead($.extend(e.o.typeahead,{menuAfterShow:function(){e.node.addClass("showingTypeahead")},menuAfterHide:function(){e.node.removeClass("showingTypeahead")},menuAfterSelect:function(){e.inputNode.off("keyup.tokenbox"),e.inputNode.off("keydown.tokenbox"),e.inputNode.off("blur.tokenbox")},menuAfterUnselect:function(){e.inputNode.off("keyup.tokenbox").on("keyup.tokenbox",e.handleKeyup).off("keydown.tokenbox").on("keydown.tokenbox",e.handleKeydown).off("blur.tokenbox").on("blur.tokenbox",e.handleBlur)}}))),e.o.items&&e.insertTokens(e.o.items)},setupInput:function(){var e=this;e.inputNode=$('<input type="text" class="tokeninput" autocomplete="off" spellcheck="false" />'),e.o.maxlength&&e.inputNode.attr("maxlength",e.o.maxlength),e.inputNode.on("keyup.tokenbox",e.handleKeyup),e.inputNode.on("keydown.tokenbox",e.handleKeydown),e.inputNode.on("blur.tokenbox",e.handleBlur),e.inputNode.bind("paste",e.handlePaste),e.inputNode.attr("tabindex",e.node.attr("tabindex")),e.node.removeAttr("tabindex"),e.node.addClass("tokenbox").append(e.inputNode).click(function(){e.deselectItem(),e.inputNode.focus()}),e.inputNode.autoGrowInput(),i.on("autocomplete_select",e.inputNode,function(){e.validate.call(e,!0,"event")})},validate:function(e){var t=this;if(t.inputNode.val()){var i=t.newToken(t.inputNode.val());i?t.inputNode.val("").removeClass("error"):t.o.ignoreinvalidinput?t.inputNode.val("").removeClass("error"):t.inputNode.addClass("error"),e&&t.inputNode.focus()}},handlePaste:function(){var e=$(this).closest(".tokenbox").tokenbox();return e.o.allowPaste?e.limited?!1:void(e.o.tokenizeOnPaste&&e.o.tokenize&&$.doTimeout("tokenize",100,function(){e.o.tokenize.call(e)})):!1},handleKeydown:function(e){var i=$(this).closest(".tokenbox").tokenbox();e=t.getEvent(e);var a=t.getKeyCode(e);if(!e.metaKey&&!e.ctrlKey){if(""==i.inputNode.val()&&$.inArray(a,[8,9,13,37,38,39,40])>=0)switch(a){case 8:i.deleteSelectedItem(),e.preventDefault();break;case 9:case 13:return;case 37:case 38:i.selectPreviousItem(),e.preventDefault();break;case 39:case 40:i.selectNextItem()}else{if(i.limited)return!1;i.deselectItem(),i.inputNode.focus(),i.scrollToItem(i.inputNode)}if(i.o.keydown&&i.o.keydown.apply(i,[e]),$.inArray(a,i.o.tokenize_keycodes)>-1){if(188==a&&e.shiftKey)return!0;i.o.tokenize?i.o.tokenize.call(i):i.validate(!0,"keydown"),9!=a&&32!=a&&(i.inputNode.focus(),e.preventDefault())}}},handleKeyup:function(e){var t=$(this).closest(".tokenbox").tokenbox();""==t.inputNode.val()&&t.inputNode.removeClass("error"),t.o.keyup&&t.o.keyup.apply(t,[e])},handleBlur:function(){var e=$(this).closest(".tokenbox").tokenbox();e.inputNode.val()&&(e.o.tokenize?e.o.tokenize.call(e):e.validate.call(e,"blur")),e.deselectItem()},scrollToItem:function(e){e=$(e);{var t=e.closest(".tokenbox").tokenbox();e.offset().top-t.node.offset().top}},deleteSelectedItem:function(){var e=this,t=e.node.find(".token.selected");t.length?(t.remove(),e.changed(),e.inputNode&&e.inputNode.focus()):e.selectLastItem()},selectPreviousItem:function(){var e=this,t=e.node.find(".token.selected");if(t.length){var i=t.prev(".token");i.length&&(t.removeClass("selected"),i.addClass("selected"),e.scrollToItem(i))}else e.selectLastItem()},selectNextItem:function(){var e=this,t=e.node.find(".token.selected");if(t.length){var i=t.next(".token");t.removeClass("selected"),i.length&&(i.addClass("selected"),e.scrollToItem(i))}},selectLastItem:function(){var e=this,t=e.node.find(".token").last();t.length&&(t.addClass("selected"),e.scrollToItem(t))},deselectItem:function(){var e=this;e.node.find(".token.selected").removeClass("selected")},checkLimit:function(){var t=this;t.o.limit&&t.node.find(".token").length>=t.o.limit?(e("Reached token limit: "+t.o.limit),t.limited=!0):t.limited=!1,t.o.limitcallback&&t.o.limitcallback.call(t)},newToken:function(e,t){var i=this;if(i.o.trimtext&&(e=$.trim(e)),i.o.minlength&&e.length<i.o.minlength)return!1;if(i.o.validateToken&&(e=i.o.validateToken.apply(i,[e])),i.o.allowemptytext||""===e&&(e=!1),e===!1)return!1;if(!i.limited){t=$.extend({removable:!0},t);var a=i.tokenMarkup(e,t);return t.removable&&(a.addClass("removable").prepend('<div class="remove glyph-close glyph-center">&nbsp;</div>').removable({afterRemove:function(){i.changed()}}),a.mousedown(function(){i.inputNode&&i.inputNode.blur()}),a.click(function(){return i.node.find(".token.selected").removeClass("selected"),$(this).addClass("selected"),i.inputNode&&i.inputNode.focus(),!1})),i.o.typeahead?i.inputNode.closest(".autocompletemenu").before(a):i.inputNode?i.inputNode.before(a):i.node.append(a),i.changed(),a}},tokenMarkup:function(e){var i=$('<div class="token"><span class="token-content">'+t.htmlEncode(e).replace("&amp;","&")+"</span></div>");return i.data("token",e),i},insertTokens:function(e,t){for(var i in e)this.newToken(e[i],t)},getTokens:function(){var e=[];return this.node.find(".token").each(function(){var t=$(this).data("token");e.push(t)}),e},changed:function(){var e=this;if(e.partner){var t=e.getTokens();e.partner.val(JSON.stringify(t))}e.typeahead&&e.inputNode.data("typeahead").menu.hide(),e.checkLimit(),e.o.onchange&&e.o.onchange.call(e)},reset:function(){var e=this;e.node.find(".token").remove(),e.changed()},destroy:function(){var e=this;e.node.find(".token").remove(),e.node.find("input.tokeninput").remove(),e.node.removeData("tokenbox")}},$.fn.tokenbox=function(e){if("string"==typeof e&&"undefined"!=typeof e){switch(e){case"destroy":this.data("tokenbox")&&this.data("tokenbox").destroy();break;case"reset":this.data("tokenbox")&&this.data("tokenbox").reset()}return this.data("tokenbox")?this.data("tokenbox"):!1}return this.data("tokenbox")?this.data("tokenbox"):$(this).find("input.tokeninput").length?!1:this.each(function(){$(this).data("tokenbox",new a(this,e))})},a.configs={jobs:{tokenize_keycodes:[9,13],allowPaste:!1,minlength:2,maxlength:50,id:"jobs",limit:10,limitmessage:"You can enter up to 10 jobs.",limitcallback:function(){},init:function(){},validateToken:function(e){var t=this;if(e.match(/[<>*?+\/\\\[\]\{\}]/g))return!1;e=e.replace(/\s+/g," ");var i=t.getTokens();for(var a in i)i[a]=i[a].toLowerCase();return-1==$.inArray(e.toLowerCase(),i)?e:!1}},educations:{tokenize_keycodes:[9,13],allowPaste:!1,minlength:2,maxlength:70,id:"educations",limit:10,limitmessage:"You can enter up to 10 schools.",limitcallback:function(){},init:function(){},validateToken:function(e){var t=this;if(e.match(/[<>*?+\/\\\[\]\{\}]/g))return!1;e=e.replace(/\s+/g," ");var i=t.getTokens();for(var a in i)i[a]=i[a].toLowerCase();return-1==$.inArray(e.toLowerCase(),i)?e:!1}},locations:{tokenize_keycodes:[9,13],allowPaste:!1,minlength:2,maxlength:50,id:"locations",limit:10,limitmessage:"You can enter up to 10 locations.",limitcallback:function(){},init:function(){},validateToken:function(e){var t=this;if(e.match(/[<>*?+\/\\\[\]\{\}]/g))return!1;e=e.replace(/\s+/g," ");var i=t.getTokens();for(var a in i)i[a]=i[a].toLowerCase();return-1==$.inArray(e.toLowerCase(),i)?e:!1}},tags:{tokenize_keycodes:[9,13,188],allowPaste:!1,minlength:2,maxlength:30,id:"tags",limit:10,limitmessage:"You can enter up to 10 tags.",limitcallback:function(){},init:function(){},validateToken:function(e){var t=this;if(e.match(/[<>*?+\/\\\[\]\{\}]/g))return!1;e=e.replace(/\s+/g," ");var i=t.getTokens();for(var a in i)i[a]=i[a].toLowerCase();return-1==$.inArray(e.toLowerCase(),i)?e:!1}}},a}),define("class/saver",["globals","log","lib/dialog","lib/ajax","lib/event"],function(e,t,i,a,o){t.module("class/saver");var n=function(e){this.data={},this.throttled=null,this.saving=!1,this.cache={_id:"cache data"},this.attempts=0,this.options={name:"Saver",delay:5e3,call:"save",maxattempts:5,quietproperties:[]},e&&$.extend(this.options,e),o.on("ajax_authentication_error",function(){this.data={}})};return n.prototype={save:function(e,i){var a=this,n=a._mangle(e,i);if($.extend(a.data,n),a.data=a._checkCache(a.data),$.isEmptyObject(a.data))return $(window).unbind("beforeunload."+a.options.name),t("save data is empty"),void o.trigger("save_data_empty");if(!a.disabled){clearTimeout(a.throttled),a.throttled=setTimeout(function(){a._submit()},a.options.delay);var s=$.extend({},a.data);$.each(a.options.quietproperties,function(e){delete s[a.options.quietproperties[e]]}),$.isEmptyObject(s)||(t("data not empty"),a.banner&&a.banner.remove(),$(window).unbind("beforeunload."+a.options.name),$(window).bind("beforeunload."+a.options.name,function(){a.disabled=!0,a.unsavedchanges=!0,clearTimeout(a.throttled);var e=function(){$("body").bind("mousemove."+a.options.name,function(){$("body").unbind("mousemove."+a.options.name),t("mouse moved"),a.disabled=!1,a.save()})};return setTimeout(e,100),"You have unsaved changes."}),o.on("ajax_authentication_error",function(){$(window).unbind("beforeunload."+a.options.name)}))}},saveNow:function(){var e=this;clearTimeout(e.throttled),e._submit()},updatecache:function(e,t){var i=this,a=i._mangle(e,t);$.extend(i.cache,a)},_mangle:function(e,i){var a=null;if("string"==typeof e&&"undefined"!=typeof i&&(a={},a[e]=i),"object"==typeof e&&"undefined"==typeof i&&(a=e),"undefined"==typeof e&&"undefined"==typeof i&&(a={}),!a)throw t(e),t(i),"Invalid save data.";return a},_checkCache:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var a=!0;null!=this.cache[i]&&JSON.stringify(e[i])==JSON.stringify(this.cache[i])&&(a=!1),a&&(t[i]=e[i])}return t},_submit:function(i){var o=this;if(!o.saving&&!o.disabled){if(o.data=o._checkCache(o.data),$.isEmptyObject(o.data))return void $(window).unbind("beforeunload."+o.options.name);var n=$.extend({},o.data);o.data={},i=i||{},i=$.extend({success:function(e,t,i,a){o._saveSuccess(n,e,t,i,a)},error:function(e,t,i,a){o._saveError(n,e,t,i,a)}},i),"function"==typeof o.options.beforeSave&&o.options.beforeSave(),o.saving=!0,e.JS_DEBUG&&t.time("save time"),a.post(o.options.call,n,i),"function"==typeof o.options.afterSave&&o.options.afterSave()}},_saveComplete:function(){var e=this;e.saving=!1,$(window).unbind("beforeunload."+e.options.name),$("body").unbind("mousemove."+e.options.name)},_saveSuccess:function(i,a,o,n,s){var r=this;delete i.call,delete i._authentication_token,r.updatecache(i),r._list(i),"function"==typeof r.options.success&&r.options.success.apply(r,[i,a,o,n,s]),r.attempts=0,r.unsavedchanges=!1,e.JS_DEBUG&&t.timeEnd("save time"),r._saveComplete(i,a,o,n,s),r.save()},_saveError:function(e,a,o,n,s){var r=this;r.options.maxattempts&&(r.attempts<r.options.maxattempts?(r.attempts=r.attempts+1,t("Save failed. Attempt #"+r.attempts),r.save(e)):(r.attempts=0,i.error("There was an error saving your changes. Please try again. You may need to reload the page."))),"function"==typeof r.options.error?r.options.error.apply(r,[e,a,o,n,s]):(t("Save failed."),t(e)),r._saveComplete(e,a,o,n,s)},_list:function(e){for(var i in e)e.hasOwnProperty(i)&&t("save: "+i+": "+e[i])}},n}),define("class/tabs",["log","lib/query"],function(e,t){e.module("class/tabs");var i=function(e,t){this.node=$(e),this.o=$.extend({showfirsttab:!0,scope:null,trigger:"a.tab",tab:function(e){return $("div.tab#"+e.attr("href").replace(/.*#/,""))},tabid:function(e){return e.attr("href").replace(/.*#/,"")},activeclass:"active",activenode:function(e){return e},readquery:!1,setquery:!1,querykey:"#!"},t),this.init()};return i.prototype={init:function(){var t=this;if(t.o.beforeInit&&t.o.beforeInit.call(t),t.tabindex=[],t.tabs={},t.node.find(t.o.trigger).each(function(){var e=$(this),i=t.o.tab.apply(t,[e]),a=t.o.tabid.apply(t,[e]);i&&i.length&&a?(e.data("tab",i),i.data("trigger",e),i.data("id",a),t.tabindex.push(a),t.tabs[a]=i):e.remove()}),0==t.tabindex.length)return e("No valid tabs found."),!1;if(t.node.find(t.o.trigger).bind("click",function(e){e.preventDefault(),t.showTab(this)}),t.o.readquery){var i=t.checkQuery();i&&(t.o.showfirsttab=!1,t.o.showtab=null),$(window).bind("hashchange",function(){t.checkQuery()})}if(t.o.showtab){var i=t.showTabByName(t.o.showtab);i&&(t.o.showfirsttab=!1)}if(t.o.showfirsttab&&t.showTab(t.node.find(t.o.trigger)[0]),t.o.scope){var a=$(document).data("tabsets")||{};a[t.o.scope]=t,$(document).data("tabsets",a)}t.o.afterInit&&t.o.afterInit.call(t),t.node.addClass("tabs-setup")},checkQuery:function(){var e=this,i=e.o.querykey+"/";e.o.scope&&(i=i+e.o.scope+"/");var a=t.parse(i,null,"/",!1),o=!1;if(a[0]&&(o=e.showTabByName(a[0]),1==a.length)){var n=$(document).data("tabsets")||{},s=[];e.o.scope&&s.push(e.o.scope),s.push(a[0]);var r=s.join("/");n[r]&&n[r].setQuery()}return o},setQuery:function(){var e=this,t=[];if(t.push(e.o.querykey),e.o.scope){t.push(e.o.scope);var i=t.join("/");if(document.location.href.indexOf(i)<0)return}t.push(e.currenttab);var a=t.join("/");document.location.href.indexOf(a)>-1||(e.o.scope&&document.location.href.match(new RegExp(e.o.scope+"$"))?document.location.replace(a):document.location=a)},showTab:function(e){var t=this,e=$(e),i=t.o.activenode(e);if(t.o.beforeSwitch){var a=t.o.beforeSwitch.apply(t,[e]);if(!a)return!1}return i.hasClass(t.o.activeclass)?!1:(t.node.find(t.o.trigger).each(function(){var e=t.o.activenode($(this));e.removeClass(t.o.activeclass),$(this).data("tab").hide()}),e.data("tab").show(),i.addClass(t.o.activeclass),t.currenttab=e.data("tab").data("id"),t.o.setquery&&t.setQuery(),void(t.o.afterSwitch&&t.o.afterSwitch.call(t)))},showTabByName:function(e){var t=this,i=t.tabs[e];if(i&&i.length){t.showTab(i.data("trigger"));var a=$(document).data("tabsets")||{},o=[];t.o.scope&&o.push(t.o.scope),o.push(t.currenttab);var n=o.join("/");return a[n]&&a[n].checkQuery(),!0}return!1}},$.fn.tabs=function(e){return this.each(function(){$(this).data("tabs",new i(this,e))})},i}),define("controller/welcomescreen",["globals","log","lib/dialog","lib/event","lib/ajax","viewer","viewport","class/tabs"],function(e,t,i,a,o,n,s){t.module("controller/welcomescreen");var r={init:function(){t("WelcomeScreen.init"),s.is("small")||n.logged_in&&(n.get("welcome_count")>=5||(r.createmodal(),a.ready("customize_ready",function(e,t){t&&t.firstview&&!n.isUser($.jStorage.get("firstviewComplete"))&&($.jStorage.set("firstviewComplete",n.get("user_name")),window.optimizely=window.optimizely||[],window.optimizely.push(["trackEvent","Signup complete"]),a.ready("deferred_ready",function(){$(".ui-dialog:visible").length?$(".ui-dialog:visible").find(".ui-dialog-content").one("dialogclose",function(){$.doTimeout(500,function(){r.open()})}):$(".banner:visible").length?$(".banner:visible").one("close",function(){$.doTimeout(500,function(){r.open()})}):r.open()}))}),n.get("welcome_count")<5&&r.count()))},createmodal:function(){t("WelcomeScreen.createmodal"),r.html=$("#welcome").remove().html(),r.html='<div id="welcome">'+r.html+"</div>",a.trigger("welcome_modal_ready")},open:function(){$(r.html).dialog({dialogClass:"welcome dark",disableScrolling:!0,clickOverlayToClose:!0,autoDestroy:!0,title:"Make it easy for people to learn about you and find what you share",width:694,close:function(){t("welcome_closed"),a.trigger("welcome_closed")}});r.settabs("#welcome ul.tabs"),r.nextpage("#welcome p.buttons","welcome")},close:function(){$("#welcome").prev().find(".ui-dialog-titlebar-close").trigger("click")},settabs:function(e){$(e)&&$(e).tabs({scope:"welcome",readquery:!0,setquery:!0})},nextpage:function(e,t){if($(e)&&$(e).length){var i=$(e).length;$(e).each(function(e){var a=e+1;i>a?$(this).on("click",function(){$("#"+t+" a.tab.step"+(a+1)).trigger("click")}):a==i&&$(this).on("click",function(){r.close()})})}},count:function(){var e={counter_name:"welcome",increment:"1"};o.post("tracking_counter",e,{})}};return n.when("ready",r.init,r),r}),function(e){function t(e){return!isNaN(parseFloat(e))&&isFinite(e)}function i(e,t,a,o,n,s,r,l){var c,d,u;return l?(c=0===o?"":a.slice(-o),d=a.slice(-n)):(c=a.slice(0,o),d=a.slice(0,n)),t<s.html(r)[e]()?0:s.html(d+r)[e]()<s.html(c+r)[e]()?n:(u=parseInt((o+n)/2,10),c=l?a.slice(-u):a.slice(0,u),s.html(c+r),s[e]()===t?u:(s[e]()>t?n=u-1:o=u+1,i(e,t,a,o,n,s,r,l)))}e.fn.truncate=function(a){var o={width:"auto",token:"&hellip;",center:!1,addclass:!1,addtitle:!1,multiline:!1};return a=e.extend(o,a),this.each(function(){var o,n,s,r=e(this),l={fontFamily:r.css("fontFamily"),fontSize:r.css("fontSize"),fontStyle:r.css("fontStyle"),fontWeight:r.css("fontWeight"),"font-variant":r.css("font-variant"),"text-indent":r.css("text-indent"),"text-transform":r.css("text-transform"),"letter-spacing":r.css("letter-spacing"),"word-spacing":r.css("word-spacing"),display:"none"},c=r.text(),d=e("<span/>").css(l).html(c).appendTo("body"),u=d.width(),p=t(a.width)?a.width:r.width(),f="width";a.multiline?(d.width(r.width()),f="height",n=d.height(),s=r.height()+1):(n=u,s=p),n>s&&(d.text(""),a.center?(s=parseInt(s/2,10)+1,o=c.slice(0,i(f,s,c,0,c.length,d,a.token,!1))+a.token+c.slice(-1*i(f,s,c,0,c.length,d,"",!0))):o=c.slice(0,i(f,s,c,0,c.length,d,a.token,!1))+a.token,a.addclass&&r.addClass(a.addclass),a.addtitle&&r.attr("title",c),r.empty().append(o)),d.remove()})}}(jQuery),define("truncate",function(){}),/**
 * @license
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var i=e.originalEvent.changedTouches[0],a=document.createEvent("MouseEvents");a.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(a)}}if(e.support.touch="ontouchend"in document,e.support.touch){var i,a=e.ui.mouse.prototype,o=a._mouseInit;a._touchStart=function(e){var a=this;!i&&a._mouseCapture(e.originalEvent.changedTouches[0])&&(i=!0,a._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},a._touchMove=function(e){i&&(this._touchMoved=!0,t(e,"mousemove"))},a._touchEnd=function(e){i&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),i=!1)},a._mouseInit=function(){var t=this;t.element.bind("touchstart",e.proxy(t,"_touchStart")).bind("touchmove",e.proxy(t,"_touchMove")).bind("touchend",e.proxy(t,"_touchEnd")),o.call(t)}}}(jQuery),define("touchpunch",function(){}),define("controller/addappmodal",["require","globals","viewer","lib/event","viewport","lib/metrics","lib/ajax","lib/utils","data/user","controller/tooltips","log","carousel","truncate","doTimeout","touchpunch","easyxdm"],function(e){var t=e("globals"),i=e("viewer"),a=e("lib/event"),o=e("viewport"),n=e("lib/metrics"),s=e("lib/ajax"),r=e("lib/utils"),l=e("data/user"),c=(e("controller/tooltips"),e("log"));e("carousel"),e("truncate"),e("doTimeout"),e("touchpunch"),e("easyxdm"),c.module("controller/addappmodal");var d=c.create("addapp","background-color:#bada55;color:white"),u={current:null,from_spotlight:!1,markup:'<div id="addapp" style="display:none"><div class="payload-loading"></div></div>',load:function(){$("head").append('<link rel="stylesheet" type="text/css" href="'+t.STATIC_HOSTNAME+'/css/view/addapp.css" />'),u.modal=$(u.markup),u.modal.dialog({title:"App Center",autoOpen:!0,dialogClass:"addapp",disableScrolling:!0,width:695,open:function(){$(this);a.trigger("customize_savenow"),$("#url_field").val(""),$(".apps div#addserviceoptions").hide().empty(),$(".app").removeClass("active")},close:function(){u.hideAppDetail(),$(".apps div#addserviceoptions").hide().empty()}}),e(["/me/viewer/addapp"],function(e){$("#addapp").empty(),r.insertCSS(e.css,"addapp-css"),r.insertHTML(e.html,"#addapp"),u.init(),a.trigger("add_app_loaded")}),a.on("reenable_app_addappmodal",function(e,t){t&&$(".addapp div.apps ."+t).removeClass("added")})},init:function(){var e=$(".addapp-carousel").children().first().outerWidth(!0)*$(".addapp-carousel").children().size();$(".addapp-carousel").width(e),$("#addapp-nav").append('<span class="button first glyph-angle-left glyph-center">&nbsp;</span>');for(var i=1;i<=$(".addapp-carousel").children().size();i++)$("#addapp-nav").append('<span class="button number">'+i+"</span>");$("#addapp-nav").append('<span class="button last glyph-angle-right glyph-center">&nbsp;</span>');var n=$("#addapp-carousel").css({width:696,height:246}).jcarousel();$("#addapp-nav").find(".button.last").on("jcarouselcontrol:active",function(){$(this).removeClass("inactive disabled")}).on("jcarouselcontrol:inactive",function(){$(this).addClass("inactive disabled")}).jcarouselControl({target:"+=1",carousel:n}),$("#addapp-nav").find(".button.first").on("jcarouselcontrol:active",function(){$(this).removeClass("inactive disabled")}).on("jcarouselcontrol:inactive",function(){$(this).addClass("inactive disabled")}).jcarouselControl({target:"-=1",carousel:n}),$("#addapp-nav").find(".number").each(function(){$(this).on("jcarouselcontrol:active",function(){$(this).addClass("active")}).on("jcarouselcontrol:inactive",function(){$(this).removeClass("active")}).jcarouselControl({target:parseInt($(this).text())-1,carousel:n})}),u.pane=$("#addserviceoptions"),u.templates=$("#addserviceoptions-templates"),$.each(u.internal.servicesWithURLs,function(){$("#addapp .app."+this).addClass("url")}),$.each(u.internal.servicesWithoutRegConfirm,function(){$("#addapp .app."+this).addClass("direct")}),$("#addapp .apps .app.external-app").click(u.external.getRegUrl),$("#addapp .apps .app").not(".external-app").click(u.internal.addService),$("body").on("click","#addservice .cancel,#addserviceoptions .cancel",u.hideAppDetail),o.isNot("small")&&$(".app .description").truncate({multiline:!0});var s=["twitter","facebook","px500"];$.each(s,function(e,a){i=e+1;var o=1==i?"large":"small",n=$("#addapp .app."+a),s=$("#addapp-promo"+i);n.find(".description").clone().appendTo(s),s.attr("data-platform",a).find("img").attr("src",t.STATIC_HOSTNAME+"/images/addapp_promos/"+o+"/"+a+".png").end().attr("class",n.attr("class")).removeClass("app").on("click",function(){$(this).hasClass("added")?u.alreadyAdded.call(n):$(this).hasClass("external-app")?u.external.getRegUrl.call(n):u.internal.addService.call(n)})}),a.trigger("appmodal_loaded")},open:function(){return i.logged_in&&i.is("weak_login")?(a.trigger("weak_login",["clicked on app","weak_addapp_open","","event"]),!1):(a.ifTriggered("appmodal_loaded")?$("#addapp").dialog("open"):u.load(),!1)},close:function(){return $("#addapp").dialog("close"),!1},showAppDetail:function(e){$("#addapp-add").removeClass("invisible"),$(".apps").addClass("invisible"),$(e).clone().prependTo($("#addapp-add #addservice")),$("body").on("keyup.appdetail",function(e){return 27==e.keyCode&&u.hideAppDetail(),!1})},hideAppDetail:function(){for(var e in u.external.XD)u.external.XD[e]=null;$("#addapp-add").addClass("invisible"),$(".apps").removeClass("invisible"),$("#addservice, #addserviceoptions").empty(),$("body").off("keyup.appdetail")},alreadyAdded:function(){u.showAppDetail(this),u.templates.find(".pane.added").clone().appendTo(u.pane)},internal:{servicesWithURLs:["tumblr","wordpress","blogger","typepad","behance","medium"],servicesWithoutRegConfirm:["favs"],config:{favs:{displayname:"Favorites",header:"Instagram photos",description:"Before you continue, please note that once you authenticate, users will be able to see your photos (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to one of your favorite Instagram photos by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Instagram photo",urllabel:"Instagram URL",urlstub:"instagr.am/",fieldoffset:11,showfeeds:!1,authURL:"/instagram/login/"},instagram:{displayname:"Instagram",header:"Instagram photos",description:"Before you continue, please note that once you authenticate, users will be able to see your photos (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to one of your favorite Instagram photos by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Instagram photo",urllabel:"Instagram URL",urlstub:"instagr.am/",fieldoffset:11,showfeeds:!1,authURL:"/instagram/login/"},youtube:{displayname:"YouTube",header:"a YouTube channel",description:"Before you continue, please note that once you authenticate, users will be able to see your uploads and favorites (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to your YouTube channel by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a YouTube channel",urllabel:"YouTube URL",urlstub:"youtube.com/",fieldoffset:12,showfeeds:!1,authURL:"/youtube/login/"},lastfm:{displayname:"Last.fm",header:"a Last.fm profile",description:"Before you continue, please note that once you authenticate, users will be able to see your library (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to your LastFm profile by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Last.fm profile",urllabel:"Last.fm URL",urlstub:"last.fm/user/",fieldoffset:13,authURL:"/lastfm/login/"},vimeo:{displayname:"Vimeo",header:"a Vimeo channel",description:"Before you continue, please note that once you authenticate, users will be able to see your uploads and likes (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to your Vimeo profile by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Vimeo channel",urllabel:"Vimeo URL",urlstub:"vimeo.com/",fieldoffset:11,showfeeds:!1,authURL:"/vimeo/login/"},fitbit:{displayname:"Fitbit",header:"a Fitbit Profile",description:"Before you continue, please note that once you authenticate, users will be able to see your data (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to your Fitbit profile by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Fitbit Profile",urllabel:"Fitbit URL",urlstub:"fitbit.com/",fieldoffset:12,showfeeds:!1,authURL:"/fitbit/login/"},github:{displayname:"GitHub",header:"a GitHub profile",description:"Before you continue, please note that once you authenticate, users will be able to see your repos and gists (even if you have a private account). If that&rsquo;s not ok with you, you can always add a flat link to your GitHub profile by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a GitHub profile",urllabel:"GitHub URL",urlstub:"github.com/",fieldoffset:17,showfeeds:!1,authURL:"/github/login/"},px500:{displayname:"500px",showfeeds:!1,authURL:"/px500/login/"},twitter:{displayname:"Twitter",header:"a Twitter profile",description:"Adding Twitter will allow any visitor to see your tweets on your about.me page, unless you have a protected Twitter account.",urlheader:"a Twitter link",urllabel:"Twitter URL",urlstub:"twitter.com/",fieldoffset:12,showfeeds:!1,authURL:"/twitter/login/"},facebook:{displayname:"Facebook",header:"a Facebook profile",urlheader:"a Facebook profile link",urllabel:"Facebook profile URL",urlstub:"facebook.com/",fieldoffset:13,showfeeds:!1,authURL:"/facebook/login/"},facebookpage:{displayname:"Facebook",header:"a Facebook page",urlheader:"a Facebook page link",urllabel:"Facebook page URL",urlstub:"facebook.com/",fieldoffset:13,showfeeds:!1,authURL:"/facebook/login?page=1"},linkedin:{displayname:"LinkedIn",header:"a LinkedIn profile",urlheader:"a LinkedIn link",urllabel:"LinkedIn URL",urlstub:"linkedin.com/in/",fieldoffset:16,showfeeds:!1,authURL:"/linkedin/login/"},foursquare:{displayname:"Foursquare",header:"a Foursquare profile",description:"Before you continue, please note that once you authenticate, users will be able to see your recent check-ins (even if your account normally just shows to friends). If that's not ok with you, you can always add a flat link to your Foursquare profile by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Foursquare link",urllabel:"Foursquare URL",urlstub:"foursquare.com/user/",fieldoffset:20,showfeeds:!1,authURL:"/foursquare/login/"},formspring:{displayname:"Formspring",header:"a Formspring profile",description:"Before you continue, please note that once you authenticate, users will be able to see your recent questions and answers. If that's not ok with you, you can always add a flat link to your Formspring profile by clicking the &ldquo;Add a link instead&rdquo; button.",urlheader:"a Formspring link",urllabel:"Formspring URL",urlstub:"formspring.me/",fieldoffset:14,showfeeds:!1,authURL:"/formspring/login/"},flickr:{displayname:"Flickr",showfeeds:!1,authURL:"/flickr/login/"},tumblr:{displayname:"Tumblelog",urlheader:"Tumblr",urllabel:"Tumblr URL",urlstub:".tumblr.com",fieldoffset:0,showfeeds:!0},wordpress:{displayname:"WordPress",urlheader:"a WordPress blog",urllabel:"WordPress URL",urlstub:".wordpress.com",fieldoffset:0,showfeeds:!0},blogger:{displayname:"Blogger",urlheader:"a Blogger blog",urllabel:"Blogger URL",urlstub:".blogspot.com",fieldoffset:0,showfeeds:!0},medium:{displayname:"Medium",urlheader:"Medium",urllabel:"Medium URL",urlstub:"medium.com/feed/@",fieldoffset:17,showfeeds:!0},typepad:{displayname:"TypePad",urlheader:"a TypePad blog",urllabel:"TypePad URL",urlstub:".typepad.com",fieldoffset:0,showfeeds:!0},behance:{displayname:"Behance",urlheader:"a Behance portfolio",urllabel:"Behance profile URL",urlstub:"behance.net/",fieldoffset:12,showfeeds:!0},googleplus:{displayname:"Google+",header:"a Google+ profile",description:'Before you continue, please note that users will be able to see only the posts you\'ve marked "public".',urlheader:"a Google+ profile link",urllabel:"Google+ profile URL",urlstub:"plus.google.com/",fieldoffset:16,showfeeds:!1,authURL:"/oauth2/googleplus/authorize/"},urlrss:{urlheader:"a URL",urllabel:"URL Location",urlstub:"",fieldoffset:0,showfeeds:!1}},addService:function(){return $(this).hasClass("added")||(u.showAppDetail(this),u.internal.showPane(this)),!1},showPane:function(e){u.pane.empty(),u.current=$(e).attr("data-platform"),u.from_spotlight=$(e).hasClass("from_spotlight")?!0:!1;var t=["github","instagram","flickr","googleplus","youtube","fitbit","linkedin","lastfm","vimeo","px500"];$.inArray(u.current,t)>-1?u.internal.authorizeService():$(e).hasClass("direct")?u.internal.registerService():$(e).hasClass("url")?(u.internal.showURLPane(),r.setCaretToPos(u.pane.find("input.text")[0],u.internal.config[u.current].fieldoffset)):u.internal.showServicePane()},showURLPane:function(){u.templates.find(".pane.url").clone().appendTo(u.pane),u.internal.config[u.current]&&(u.pane.find(".headertext").html(u.internal.config[u.current].urlheader),u.pane.find("label").html(u.internal.config[u.current].urllabel),u.pane.find("input.text").val(u.internal.config[u.current].urlstub).keyup(function(e){r.handleReturnKey(e,u.internal.validateURLInput)}),u.pane.find("span.addbutton").click(u.internal.validateURLInput))},showServicePane:function(){u.templates.find(".pane."+u.current).length?u.templates.find(".pane."+u.current).clone(!0).appendTo(u.pane):u.templates.find(".pane.service").clone(!0).appendTo(u.pane),u.internal.config[u.current]&&(u.pane.find(".headertext").html(u.internal.config[u.current].header),u.pane.find(".description").html(u.internal.config[u.current].description),u.pane.find("span.authorizebutton").click(u.internal.authorizeService),u.pane.find(".button.url").attr("data-platform",u.current).click(function(){return u.internal.showPane(this),!1}),u.pane.find("span.savefacebookoptions").click(u.internal.saveFacebookOptions),u.pane.find("span.facebookpageadd").click(u.internal.getFacebookPageOptions),u.pane.find("span.linkedinoptions").click(u.internal.saveLinkedInOptions),u.pane.find("span.foursquareoptions").click(u.internal.saveFourSquareOptions)),u.internal.tinytips()},validateURLInput:function(){if(u.pane.find(".urloptions").is(":visible"))u.pane.find(".urloptions").slideToggle("fast",function(){u.pane.find(".urloptions").remove(),u.internal.validateURLInput()});else{u.pane.find("input.text").unbind("keyup"),u.pane.find("span.addbutton").unbind("click"),u.pane.find(".alarum").remove();var e=u.pane.find("input.text").val();if(r.validURL(e)){u.templates.find(".pane.loading").clone().hide().appendTo(u.pane).slideToggle("fast");var t={success:function(e){1==e.success&&u.pane.find(".pane.loading").is(":visible")?u.pane.find(".pane.loading").slideToggle("fast",function(){u.pane.find(".pane.loading").remove(),u.internal.showURLOptions(e)}):u.pane.find(".pane.loading").slideToggle("fast",function(){u.pane.find(".pane.loading").remove(),u.internal.showURLOptions(e)})},error:function(e){d(e.error)}},i={website:e};s.post("get_link_choices",i,t)}else u.pane.find("input.text").after('<span class="alarum">This URL is not valid. Please try again.</span>'),u.pane.find("input.text").keyup(function(e){r.handleReturnKey(e,u.internal.validateURLInput)}),u.pane.find("span.addbutton").click(u.internal.validateURLInput)}},showURLOptions:function(e){u.templates.find(".urloptions").clone().hide().appendTo(u.pane);var t="You can add a direct link to this site",i=!1;if(u.internal.config[e.platform]&&(i=u.internal.config[e.platform].showfeeds),e.feeds.length>0&&i===!0&&(t+=" or import from the RSS feed"),t+=".",u.pane.find(".urloptions h4").html(t),e.feeds.length>0&&i===!0){var a="";a+='<li><label for="urloption-0">',a+='<input type="radio" class="radio" name="url" id="urloption-0" value="site" />',a+='<span class="labeltext">Add text link</span>',a+="</label></li>",a+='<li><label for="urloption-1">',a+='<input type="radio" class="radio" name="url" id="urloption-1" value="'+e.preferred_feed+'"',a+=' checked="checked"',a+=" />",a+='<span class="labeltext">Import from: '+u.internal.config[e.platform].displayname+"</span>",a+="</label></li>"}u.pane.find(".urloptions ul").html(a),u.pane.find(".urloptions .button-submit").click(function(){u.internal.addURL(e)}),u.pane.find("input.text").keyup(function(e){r.handleReturnKey(e,u.internal.validateURLInput)}),u.pane.find("span.addbutton").click(u.internal.validateURLInput),u.pane.find(".urloptions").slideToggle("fast")},addURL:function(e){var t=u.pane.find("input[name=url]:radio:checked").val();"site"==t&&a.trigger("customize_settab",["links"]),u.pane.empty(),u.templates.find(".pane.loading").clone().appendTo(u.pane).find(".loadingtext").html("Adding…");var i={success:function(e){1!=e.success?Dialog.error(e.error):window.location.reload(!0)}},o={website:e.website,feed_url:t,platform:e.platform};s.post("add_link",o,i)},registerService:function(){a.trigger("customize_settab",["apps"]),u.templates.find(".pane.registering").clone().appendTo(u.pane),u.pane.find(".pane.registering .servicename").html(u.internal.config[u.current].displayname);var e={success:function(){window.location.reload()},error:function(){u.pane.empty(),u.templates.find(".pane.error").clone().appendTo(u.pane).find("h4").html("We were unable to add this app at this time. Please try again later."),u.pane.show()}};s.post("favs_registration",{},e)},authorizeService:function(){if(u.internal.config[u.current]){if(a.trigger("customize_settab",["apps"]),"twitter"==u.current){if($("#follow_twitter").is(":checked")){u.internal.config.twitter.authURL+="?follow=true";var e=!0}if($("#twitter_bio").is(":checked")){var t=e?"&":"?";u.internal.config.twitter.authURL+=t+"add_bio=true";var e=!0;n.log("One-Click Twitter - In Add App")}if(u.from_spotlight){var t=e?"&":"?";u.internal.config.twitter.authURL+=t+"from_spotlight=true"}}else"linkedin"==u.current?u.from_spotlight&&(u.internal.config.linkedin.authURL+="?from_spotlight=true"):"instagram"==u.current&&u.from_spotlight&&(u.internal.config.instagram.authURL+="?from_spotlight=true");u.pane.empty(),u.templates.find(".pane.authorizing").clone().appendTo(u.pane),u.pane.find(".pane.authorizing .servicename").html(u.internal.config[u.current].displayname),window.location=u.internal.config[u.current].authURL}},saveFourSquareOptions:function(){var e={success:function(e){1!=e.success?Dialog.error(e.error):u.internal.authorizeService()}},t={show_checkins:u.pane.find(".foursquareshareoptions input:checkbox#showcheckins")[0].checked};s.post("foursquare_options",t,e)},saveLinkedInOptions:function(){var e={success:function(e){1!=e.success?Dialog.error(e.error):u.internal.authorizeService()}},t={share:u.pane.find(".linkedinshareoptions input:checkbox#sharewithconnections")[0].checked};s.post("linkedin_options",t,e)},saveFacebookOptions:function(){var e={show_photos:u.pane.find(".facebookprivacyoptions input:checkbox#showfacebookphotos")[0].checked,show_updates:u.pane.find(".facebookprivacyoptions input:checkbox#showfacebookupdates")[0].checked,show_friends:u.pane.find(".facebookprivacyoptions input:checkbox#showfacebookfriends")[0].checked};$(".facebooktimelineoptions").length&&(e.share_updates=u.pane.find(".facebooktimelineoptions input:checkbox#shareupdates")[0].checked,e.share_directory=u.pane.find(".facebooktimelineoptions input:checkbox#sharedirectory")[0].checked,e.share_compliment=u.pane.find(".facebooktimelineoptions input:checkbox#sharecompliment")[0].checked),(e.share_updates||e.share_directory||e.share_compliment)&&n.log("FB Timeline - In Add App");var t={success:function(e){1!=e.success?Dialog.error(e.error):u.internal.authorizeService()},error:function(e){d(e.error)}};s.post("update_facebook_options",e,t)},getFacebookPageOptions:function(e){u.pane.empty(),u.templates.find(".pane.authorizing").clone().appendTo(u.pane),u.pane.find(".pane.authorizing .authorizingtext").text("Listing your Facebook pages");var t={user_id:l.Settings.user_id},i={success:function(e){$.doTimeout("show-facebook-options",1500,function(){u.internal.showFacebookPageChoices(e.accounts)})},error:function(t){"101"!=t.error&&"1"!=t.error||"true"==e?(u.pane.find(".pane.authorizing").remove(),$("#addapp").dialog("close"),Dialog("There was a problem authorizing with Facebook. Please try again later.",{status:"error"})):u.internal.authorizeService()}};s.post("get_facebook_page_accounts",t,i)},showFacebookPageChoices:function(e){u.pane.find(".pane.authorizing").remove();var t=u.templates.find(".facebookpageoptions").clone().appendTo("#addserviceoptions");if(e.length>0){$.each(e,function(e,i){var a='<label for="'+r.htmlEncode(i.name)+"_"+i.id+'">';a+='<input name="'+r.htmlEncode(i.name)+"_"+i.id+'" id="'+r.htmlEncode(i.name)+"_"+i.id+'" data-id="'+i.id+'" data-access="'+i.access_token+'" type="checkbox" checked="checked" />',a+='<span class="labeltext">'+r.htmlEncode(i.name)+"</span>",a+="</label>",t.find(".facebookpagechoices").append(a)});var i=u.pane.find(".savefacebookpageoptions");u.pane.find(".facebookpage").remove(),t.slideDown("fast"),u.pane.find(".facebookpageoptions p.message").html("Which of these pages would you like to import to your about.me profile?"),u.pane.find(".facebookpagechoices input").bind("change",function(){d("input clicked");var e=u.pane.find(".facebookpagechoices input:checked");e.length>0?(d(e.length+" pages chosen"),u.pane.find(".savefacebookpageoptions").removeClass("disabled")):(d("no pages chosen"),u.pane.find(".savefacebookpageoptions").addClass("disabled"))}),u.pane.on("click",".cancelfacebookpageoptions",u.hideAppDetail),i.click(u.internal.saveFacebookPageChoices)}else u.pane.find(".savefacebookpageoptions").replaceWith('<span data-platform="facebookpage" class="url button large dark savefacebookpageoptions">Add a link instead</span>'),u.pane.find(".savefacebookpageoptions").click(function(){u.internal.showPane(this)}),u.pane.find(".facebookpageoptions p.message").html("We can&rsquo;t find any Facebook pages listing you as an Administrator. Please check to see if you&rsquo;ve already added your pages. If all else fails, add a text link instead.")},saveFacebookPageChoices:function(){var e=[],t=u.pane.find(".facebookpagechoices input:checked");if(t.length>0){t.each(function(t,i){var a=$(i).attr("data-access"),o=$(i).attr("data-id"),n={};n.id=o,n.access_token=a,e.push(n)});var i={success:function(){window.location.reload()},error:function(e){d(e)}},a={accounts:JSON.stringify(e)};u.pane.empty(),u.templates.find(".pane.authorizing").clone().appendTo(u.pane),u.pane.find(".pane.authorizing .authorizingtext").text("Adding your Facebook pages"),$.doTimeout("facebookpage-reload-page",1500,function(){s.post("add_facebook_pages",a,i)})}},tinytips:function(){var e=[{name:"timeline-tip",attachTo:'.facebooktimelineoptions label[for="shareupdates"] .labeltext',content:"Your page is shared one hour after you are done editing",arrow:"top"}];$.each(e,function(e,t){$(t.attachTo).tinytip(t)})}},external:{XD:{},getRegUrl:function(){if(!$(this).hasClass("added")){u.current=$(this).attr("data-platform"),u.showAppDetail(this);var e={service_name:u.current,user_name:l.Settings.user_name,type:"add"},t={success:function(e){u.external.setupIframe(e.appurl)},error:function(){u.pane.empty(),u.templates.find(".pane.error").clone().appendTo(u.pane).find("h4").html("Hmmm, unable to fetch registration URL. Please try again."),u.pane.show()}};s.post("app_url",e,t)}},setupIframe:function(e){function t(){u.external.XD[u.current]=new easyXDM.Socket({lazy:!1,remote:e,swf:"http://d2ed0w4q03gsmw.cloudfront.net/core/easyxdm/easyxdm.swf",interval:100,props:{scrolling:"no"},container:u.pane.attr("id"),onMessage:function(e){u.external.iframeMessage.incoming(e)},onReady:function(){setTimeout(function(){u.pane.find(".pane.creatingframe").remove(),u.pane.find("iframe").css("position","static")},100)}})}u.templates.find(".pane.creatingframe").clone().appendTo(u.pane),u.pane.slideDown("fast",t),$.doTimeout("check-load-"+u.current,1e4,function(){d("page failing to load: "+u.current),u.pane.find(".pane.creatingframe").remove(),u.external.XD[u.current].destroy(),u.external.XD[u.current]=null,u.templates.find(".pane.error").clone().appendTo(u.pane),u.pane.find(".pane.error h4").html("Ooops… Error loading URL.")})},iframeMessage:{incoming:function(e){var t=$.parseJSON(e);switch(t.method){case"loaded":$.doTimeout("check-load-"+u.current),d(u.current+" page is loaded");break;case"setHeight":d("height is "+t.height),u.pane.find("iframe").attr("height",t.height);break;case"cancelProcess":u.external.XD[u.current].destroy(),u.external.XD[u.current]=null,u.hideAppDetail();break;case"newPage":u.external.XD[u.current].destroy(),u.external.XD[u.current]=null,u.external.setupIframe(t.url);break;case"registerApp":u.external.registerApp(t);break;case"confirmComplete":window.location.reload()}},outgoing:function(e,t){u.external.XD[t.id].postMessage(e)}},registerApp:function(e){var t={success:function(){window.location.reload()},error:function(){u.external.XD[u.current].destroy(),u.pane.empty(),u.templates.find(".pane.error").clone().appendTo(u.pane).find("h4").html("Ooops, unable to register app. Please try again."),u.pane.show()}};s.post("register_app",{service_name:u.current,api_args:e.api_args,service_url:e.service_url,display_name:e.display_name,app_user_id:e.app_user_id,config_url:e.config_url,remove_url:e.remove_url,site_url:e.site_url},t)}},addServicesParseQuery:function(e){u.open(),a.ready("appmodal_loaded",function(){if(/from=spotlight/i.test(e[0]))var t=$("#addapp .apps .app."+e[0].split("?")[0]);else var t=$("#addapp .apps .app."+e[0]);if(t.length){if(t.hasClass("added"))return void u.alreadyAdded.call(t);if(t.hasClass("external-app"))u.external.getRegUrl.call(t[0]);else{var i=e[0].split("?");1==e.length&&2==i.length?(t[0]=$(t[0]).addClass("from_spotlight"),u.internal.addService.call(t[0])):u.internal.addService.call(t[0])}switch(e[0]){case"facebookpage":"options"==e[1]&&u.internal.getFacebookPageOptions("true")}}})}};return u}),define("text!template/backstory_promos.html",[],function(){return'<script type="text/template" id="template_backstory_card">\n    <div class="card">\n        <div class="promo-art">\n            <img src="[[ data.img_url ]]" />\n        </div>\n    	<div class="note-data">\n    		<div class="title">You’re one step closer to career success. Set yourself apart professionally by using about.me’s newest feature, Backstory.</div>\n            <cite>– Antonio Neves</cite>\n    		<div class="description">\n    			<p>Nationally Recognized Career Expert</p>\n    		</div>\n            <a href="{{data.url}}/below/backstory" class="button dark blue large">Create Backstory</a>\n    	</div>\n    </div>\n</script>\n\n<script class="dashboard-roadblock">\n<img src="[[ data.img_url ]]" />\n<h1>We’ve just launched a new feature.</h1>\n<p>Set yourself apart professionally by creating a Backstory for your page.</p>\n<span class="button confirm dark blue large">Show me how</span>\n<a href="#" class="cancel">Maybe later</a>\n</script>\n\n<script class="edit-roadblock">\n<img src="[[ data.img_url ]]" />\n<h1>Backstory is the newest addition to your page.</h1>\n<p>Complete your Backstory to complete your page.</p>\n<span class="button confirm dark blue large">Show me how</span>\n<a href="#" class="cancel">Maybe later</a>\n</script>'}),define("module/backstory_promos",["require","globals","marionette","viewer","lib/metrics","text!template/backstory_promos.html","log"],function(e){var t=e("globals"),i=e("marionette"),a=(e("viewer"),e("lib/metrics"),e("text!template/backstory_promos.html")),o=(e("log"),i.ItemView.extend({template:_.template($(a).filter("script.dashboard-roadblock").html()),ui:{confirm_button:".button.confirm",cancel_button:".cancel"},events:{"click @ui.confirm_button":"onClickConfirm","click @ui.cancel_button":"onClickCancel"},onBeforeRender:function(){var e={};e.img_url=t.STATIC_HOSTNAME+"/images/backstory/roadblockimg.png",this.templateHelpers=_.extend({},this.templateHelpers,e)},preventDefault:function(e){e.preventDefault()},onClickConfirm:function(){this.trigger("confirm")},onClickCancel:function(){this.trigger("cancel")}})),n=i.ItemView.extend({template:_.template($(a).filter("script.edit-roadblock").html()),ui:{confirm_button:".button.confirm",cancel_button:".cancel"},events:{"click @ui.confirm_button":"onClickConfirm","click @ui.cancel_button":"onClickCancel"},onBeforeRender:function(){var e={};e.img_url=t.STATIC_HOSTNAME+"/images/backstory/roadblockimg.png",this.templateHelpers=_.extend({},this.templateHelpers,e)},preventDefault:function(e){e.preventDefault()},onClickConfirm:function(){this.trigger("confirm")},onClickCancel:function(){this.trigger("cancel")}});return{DashboardRoadblockView:o,EditRoadblockView:n}}),/**
 * @license
 * jQuery UI Widget 1.10.3+amd
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */
function(e){"function"==typeof define&&define.amd?define("widget",["jquery"],e):e(jQuery)}(function(e,t){var i=0,a=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var i,a=0;null!=(i=t[a]);a++)try{e(i).triggerHandler("remove")}catch(n){}o(t)},e.widget=function(t,i,a){var o,n,s,r,l={},c=t.split(".")[0];t=t.split(".")[1],o=c+"-"+t,a||(a=i,i=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[c]=e[c]||{},n=e[c][t],s=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,n,{version:a.version,_proto:e.extend({},a),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(a,function(t,a){return e.isFunction(a)?void(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},o=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,n=this._superApply;return this._super=e,this._superApply=o,t=a.apply(this,arguments),this._super=i,this._superApply=n,t}}()):void(l[t]=a)}),s.prototype=e.widget.extend(r,{widgetEventPrefix:n?r.widgetEventPrefix:t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:o}),n?(e.each(n._childConstructors,function(t,i){var a=i.prototype;e.widget(a.namespace+"."+a.widgetName,s,i._proto)}),delete n._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var o,n,s=a.call(arguments,1),r=0,l=s.length;l>r;r++)for(o in s[r])n=s[r][o],s[r].hasOwnProperty(o)&&n!==t&&(i[o]=e.isPlainObject(n)?e.isPlainObject(i[o])?e.widget.extend({},i[o],n):e.widget.extend({},n):n);return i},e.widget.bridge=function(i,o){var n=o.prototype.widgetFullName||i;e.fn[i]=function(s){var r="string"==typeof s,l=a.call(arguments,1),c=this;return s=!r&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,this.each(r?function(){var a,o=e.data(this,n);return o?e.isFunction(o[s])&&"_"!==s.charAt(0)?(a=o[s].apply(o,l),a!==o&&a!==t?(c=a&&a.jquery?c.pushStack(a.get()):a,!1):void 0):e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")}:function(){var t=e.data(this,n);t?t.option(s||{})._init():e.data(this,n,new o(s,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,a){a=e(a||this.defaultElement||this)[0],this.element=e(a),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),a!==this&&(e.data(a,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===a&&this.destroy()}}),this.document=e(a.style?a.ownerDocument:a.document||a),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,a){var o,n,s,r=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(r={},o=i.split("."),i=o.shift(),o.length){for(n=r[i]=e.widget.extend({},this.options[i]),s=0;s<o.length-1;s++)n[o[s]]=n[o[s]]||{},n=n[o[s]];if(i=o.pop(),a===t)return n[i]===t?null:n[i];n[i]=a}else{if(a===t)return this.options[i]===t?null:this.options[i];r[i]=a}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,a){var o,n=this;"boolean"!=typeof t&&(a=i,i=t,t=!1),a?(i=o=e(i),this.bindings=this.bindings.add(i)):(a=i,i=this.element,o=this.widget()),e.each(a,function(a,s){function r(){return t||n.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?n[s]:s).apply(n,arguments):void 0}"string"!=typeof s&&(r.guid=s.guid=s.guid||r.guid||e.guid++);var l=a.match(/^(\w+)\s*(.*)$/),c=l[1]+n.eventNamespace,d=l[2];d?o.delegate(d,c,r):i.bind(c,r)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?a[e]:e).apply(a,arguments)}var a=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,a){var o,n,s=this.options[t];if(a=a||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(o in n)o in i||(i[o]=n[o]);return this.element.trigger(i,a),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(a))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(a,o,n){"string"==typeof o&&(o={effect:o});var s,r=o?o===!0||"number"==typeof o?i:o.effect||i:t;o=o||{},"number"==typeof o&&(o={duration:o}),s=!e.isEmptyObject(o),o.complete=n,o.delay&&a.delay(o.delay),s&&e.effects&&e.effects.effect[r]?a[t](o):r!==t&&a[r]?a[r](o.duration,o.easing,n):a.queue(function(i){e(this)[t](),n&&n.call(a[0]),i()})}})}),/**
 * @license
 * jQuery Iframe Transport Plugin 1.7
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"function"==typeof define&&define.amd?define("iframeTransport",["jquery"],e):e(window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(i){if(i.async){var a,o,n;return{send:function(s,r){a=e('<form style="display:none;"></form>'),a.attr("accept-charset",i.formAcceptCharset),n=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+n+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+n+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+n+"_method=PATCH",i.type="POST"),t+=1,o=e('<iframe src="javascript:false;" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,n=e.isArray(i.paramName)?i.paramName:[i.paramName];o.unbind("load").bind("load",function(){var t;try{if(t=o.contents(),!t.length||!t[0].firstChild)throw new Error}catch(i){t=void 0}r(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(a),window.setTimeout(function(){a.remove()},0)}),a.prop("target",o.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(a)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after(function(e){return t[e]}),i.paramName&&i.fileInput.each(function(t){e(this).prop("name",n[t]||i.paramName)}),a.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),a.submit(),t&&t.length&&i.fileInput.each(function(i,a){var o=e(t[i]);e(a).prop("name",o.prop("name")),o.replaceWith(a)})}),a.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src","javascript".concat(":false;")),a&&a.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var i=t&&t[0];return i&&e.isXMLDoc(i)?i:e.parseXML(i.XMLDocument&&i.XMLDocument.xml||e(i.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),/**
 * @license
 * jQuery File Upload Plugin 5.31.6
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"function"==typeof define&&define.amd?define("fileUpload",["jquery","widget"],e):e(window.jQuery)}(function(e){e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&e.each(i,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(e){return e.serializeArray()},add:function(t,i){(i.autoUpload||i.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var a=e-this.timestamp;return(!this.bitrate||!i||a>i)&&(this.bitrate=(t-this.loaded)*(1e3/a)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i,a=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&a-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=a,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(a,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(a,i,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,this._progress)}},_initProgressListener:function(t){var i=this,a=t.xhr?t.xhr():e.ajaxSettings.xhr();a.upload&&(e(a.upload).bind("progress",function(e){var a=e.originalEvent;e.lengthComputable=a.lengthComputable,e.loaded=a.loaded,e.total=a.total,i._onProgress(e,t)}),t.xhr=function(){return a})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var i,a=this,o=t.files[0],n=t.multipart||!e.support.xhrFileUpload,s=t.paramName[0];t.headers=t.headers||{},t.contentRange&&(t.headers["Content-Range"]=t.contentRange),n&&!t.blob&&this._isInstanceOf("File",o)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"'),n?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:s,value:t.blob}):e.each(t.files,function(e,a){i.push({name:t.paramName[e]||s,value:a})})):(a._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(s,t.blob,o.name):e.each(t.files,function(e,o){(a._isInstanceOf("File",o)||a._isInstanceOf("Blob",o))&&i.append(t.paramName[e]||s,o,o.name)})),t.data=i):(t.contentType=o.type,t.data=t.blob||o),t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var i=e(t.fileInput),a=t.paramName;return a?e.isArray(a)||(a=[a]):(a=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",o=(t.prop("files")||[1]).length;o;)a.push(i),o-=1}),a.length||(a=[i.prop("name")||"files[]"])),a},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,a){var o=e.Deferred(),n=o.promise();return i=i||this.options.context||n,t===!0?o.resolveWith(i,a):t===!1&&o.rejectWith(i,a),n.abort=o.promise,this._enhancePromise(n)},_addConvenienceMethods:function(t,i){var a=this,o=function(t){return e.Deferred().resolveWith(a,[t]).promise()};i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||o(this)).pipe(e,t)),this._processQueue||o(this)},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=a._trigger("submit",t,this)!==!1&&a._onSend(t,this)),this.jqXHR||a._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():a._getXHRPromise()},i.state=function(){return this.jqXHR?a._getDeferredState(this.jqXHR):this._processQueue?a._getDeferredState(this._processQueue):void 0},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),a=i&&i.length>1&&parseInt(i[1],10);return a&&a+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var a,o,n=this,s=t.files[0],r=s.size,l=t.uploadedBytes,c=t.maxChunkSize||r,d=this._blobSlice,u=e.Deferred(),p=u.promise();return this._isXHRUpload(t)&&d&&(l||r>c)&&!t.data?i?!0:l>=r?(s.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",s.error])):(o=function(){var i=e.extend({},t),p=i._progress.loaded;i.blob=d.call(s,l,l+c,s.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+r,n._initXHRData(i),n._initProgressListener(i),a=(n._trigger("chunksend",null,i)!==!1&&e.ajax(i)||n._getXHRPromise(!1,i.context)).done(function(a,s,c){l=n._getUploadedBytes(c)||l+i.chunkSize,p+i.chunkSize-i._progress.loaded&&n._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=a,i.textStatus=s,i.jqXHR=c,n._trigger("chunkdone",null,i),n._trigger("chunkalways",null,i),r>l?o():u.resolveWith(i.context,[a,s,c])}).fail(function(e,t,a){i.jqXHR=e,i.textStatus=t,i.errorThrown=a,n._trigger("chunkfail",null,i),n._trigger("chunkalways",null,i),u.rejectWith(i.context,[e,t,a])})},this._enhancePromise(p),p.abort=function(){return a.abort()},o(),p):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,a,o){var n=o._progress.total,s=o._response;o._progress.loaded<n&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:n,total:n}),o),s.result=o.result=t,s.textStatus=o.textStatus=i,s.jqXHR=o.jqXHR=a,this._trigger("done",null,o)},_onFail:function(e,t,i,a){var o=a._response;a.recalculateProgress&&(this._progress.loaded-=a._progress.loaded,this._progress.total-=a._progress.total),o.jqXHR=a.jqXHR=e,o.textStatus=a.textStatus=t,o.errorThrown=a.errorThrown=i,this._trigger("fail",null,a)},_onAlways:function(e,t,i,a){this._trigger("always",null,a)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var a,o,n,s,r=this,l=r._getAJAXSettings(i),c=function(){return r._sending+=1,l._bitrateTimer=new r._BitrateTimer,a=a||((o||r._trigger("send",t,l)===!1)&&r._getXHRPromise(!1,l.context,o)||r._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){r._onDone(e,t,i,l)}).fail(function(e,t,i){r._onFail(e,t,i,l)}).always(function(e,t,i){if(r._onAlways(e,t,i,l),r._sending-=1,r._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>r._sending)for(var a=r._slots.shift();a;){if("pending"===r._getDeferredState(a)){a.resolve();break}a=r._slots.shift()}0===r._active&&r._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(n=e.Deferred(),this._slots.push(n),s=n.pipe(c)):(this._sequence=this._sequence.pipe(c,c),s=this._sequence),s.abort=function(){return o=[void 0,"abort","abort"],a?a.abort():(n&&n.rejectWith(l.context,o),c())},this._enhancePromise(s)):c()},_onAdd:function(t,i){var a,o,n,s,r=this,l=!0,c=e.extend({},this.options,i),d=c.limitMultiFileUploads,u=this._getParamName(c);if((c.singleFileUploads||d)&&this._isXHRUpload(c))if(!c.singleFileUploads&&d)for(n=[],a=[],s=0;s<i.files.length;s+=d)n.push(i.files.slice(s,s+d)),o=u.slice(s,s+d),o.length||(o=u),a.push(o);else a=u;else n=[i.files],a=[u];return i.originalFiles=i.files,e.each(n||i.files,function(o,s){var c=e.extend({},i);return c.files=n?s:[s],c.paramName=a[o],r._initResponseObject(c),r._initProgressObject(c),r._addConvenienceMethods(t,c),l=r._trigger("add",t,c)}),l},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,a){return a===t[0]?i[0]:a}),t[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,i){var a,o=this,n=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),n.resolve([e])};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,n.resolve(t._file)):t.file(function(e){e.relativePath=i,n.resolve(e)},s):t.isDirectory?(a=t.createReader(),a.readEntries(function(e){o._handleFileTreeEntries(e,i+t.name+"/").done(function(e){n.resolve(e)}).fail(s)},s)):n.resolve([]),n.promise()},_handleFileTreeEntries:function(t,i){var a=this;return e.when.apply(e,e.map(t,function(e){return a._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,a,o=t.prop("webkitEntries")||t.prop("entries");if(o&&o.length)return this._handleFileTreeEntries(o);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(a=t.prop("value"),!a)return e.Deferred().resolve([]).promise();i=[{name:a.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,a={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(a.fileInput).always(function(e){a.files=e,i.options.replaceFileInput&&i._replaceFileInput(a.fileInput),i._trigger("change",t,a)!==!1&&i._onAdd(t,a)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,a={files:[]};return i&&i.length&&(e.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&a.files.push(i)}),this._trigger("paste",t,a)===!1||this._onAdd(t,a)===!1)?!1:void 0},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=this,i=e.dataTransfer,a={};i&&i.files&&i.files.length&&(e.preventDefault(),this._getDroppedFiles(i).always(function(i){a.files=i,t._trigger("drop",e,a)!==!1&&t._onAdd(e,a)}))},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=t.dataTransfer;if(i){if(this._trigger("dragover",t)===!1)return!1;-1!==e.inArray("Files",i.types)&&(i.dropEffect="copy",t.preventDefault())}},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var a=-1!==e.inArray(t,this._specialOptions);a&&this._destroyEventHandlers(),this._super(t,i),a&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options;e.each(e(this.element[0].cloneNode(!1)).data(),function(e,a){t._isRegExpOption(e,a)&&(a=t._getRegExp(a)),i[e]=a})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,a,o=this,n=e.Deferred(),s=n.promise();return s.abort=function(){return a=!0,i?i.abort():(n.reject(null,"abort","abort"),s)},this._getFileInputFiles(t.fileInput).always(function(e){a||(t.files=e,i=o._onSend(null,t).then(function(e,t,i){n.resolve(e,t,i)},function(e,t,i){n.reject(e,t,i)}))}),this._enhancePromise(s)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),/**
 * @license
 * Color picker
 * Author: Stefan Petre www.eyecon.ro
 * Plugin URL http://www.eyecon.ro/colorpicker/
 * Dual licensed under the MIT and GPL licenses
 *
 */
function(e){var t=function(){var t=65,i='<div class="colorpicker">                <div class="colorpicker_color">                    <div>                        <div></div>                        </div>                    </div>                    <div class="colorpicker_hue">                        <div></div>                    </div>                        <div class="colorpicker_new_color"></div>                        <div class="colorpicker_current_color"></div>                        <div class="colorpicker_hex colorpicker_field">                            <input type="text" maxlength="6" size="6" id="colorpicker_hex" />                        </div>                        <div class="colorpicker_rgb_r colorpicker_field">                            <div>R</div>                            <input type="text" maxlength="3" size="3" />                            <span></span>                        </div>                        <div class="colorpicker_rgb_g colorpicker_field">                            <div>G</div>                            <input type="text" maxlength="3" size="3" />                            <span></span>                        </div>                        <div class="colorpicker_rgb_b colorpicker_field">                            <div>B</div>                            <input type="text" maxlength="3" size="3" />                            <span></span>                        </div>                        <div class="colorpicker_hsb_h colorpicker_field">                            <input type="text" maxlength="3" size="3" />                            <span></span>                        </div>                        <div class="colorpicker_hsb_s colorpicker_field">                            <input type="text" maxlength="3" size="3" />                            <span></span>                        </div>                        <div class="colorpicker_hsb_b colorpicker_field">                            <input type="text" maxlength="3" size="3" />                            <span></span>                        </div>                        <div class="colorpicker_submit"></div>                </div>',a={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},o=function(t,i){var a=F(t);e(i).data("colorpicker").fields.eq(1).val(a.r).end().eq(2).val(a.g).end().eq(3).val(a.b).end()},n=function(t,i){e(i).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},s=function(t,i){e(i).data("colorpicker").fields.eq(0).val(q(t)).end()},r=function(t,i){e(i).data("colorpicker").selector.css("backgroundColor","#"+q({h:t.h,s:100,b:100})),e(i).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},l=function(t,i){e(i).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},c=function(t,i){e(i).data("colorpicker").currentColor.css("backgroundColor","#"+q(t))},d=function(t,i){e(i).data("colorpicker").newColor.css("backgroundColor","#"+q(t))},u=function(i){var a=i.charCode||i.keyCode||-1;if(a>t&&90>=a||32==a)return!1;var o=e(this).parent().parent();o.data("colorpicker").livePreview===!0&&p.apply(this)},p=function(t){var i,a=e(this).parent().parent();a.data("colorpicker").color=i=this.parentNode.className.indexOf("_hex")>0?N(E(this.value)):this.parentNode.className.indexOf("_hsb")>0?P({h:parseInt(a.data("colorpicker").fields.eq(4).val(),10),s:parseInt(a.data("colorpicker").fields.eq(5).val(),10),b:parseInt(a.data("colorpicker").fields.eq(6).val(),10)}):D(L({r:parseInt(a.data("colorpicker").fields.eq(1).val(),10),g:parseInt(a.data("colorpicker").fields.eq(2).val(),10),b:parseInt(a.data("colorpicker").fields.eq(3).val(),10)})),t&&(o(i,a.get(0)),s(i,a.get(0)),n(i,a.get(0))),r(i,a.get(0)),l(i,a.get(0)),d(i,a.get(0)),a.data("colorpicker").onChange.apply(a,[i,q(i),F(i)])},f=function(){var t=e(this).parent().parent();t.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},g=function(){t=this.parentNode.className.indexOf("_hex")>0?70:65,e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),e(this).parent().addClass("colorpicker_focus")},h=function(t){var i=e(this).parent().find("input").focus(),a={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",a,b),e(document).bind("mousemove",a,m)},m=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&p.apply(e.data.field.get(0),[!0]),!1},b=function(t){return p.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colorpicker_slider").find("input").focus(),e(document).unbind("mouseup",b),e(document).unbind("mousemove",m),!1},v=function(){var t={cal:e(this).parent(),y:e(this).offset().top};t.preview=t.cal.data("colorpicker").livePreview,e(document).bind("mouseup",t,_),e(document).bind("mousemove",t,k)},k=function(e){return p.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},_=function(t){return o(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),s(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",_),e(document).unbind("mousemove",k),!1},y=function(){var t={cal:e(this).parent(),pos:e(this).offset()};t.preview=t.cal.data("colorpicker").livePreview,e(document).bind("mouseup",t,x),e(this).parent().find("div.colorpicker_color").bind("mouseup",t,$),e(document).bind("mousemove",t,w)},w=function(e){return p.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},$=function(t){return p.apply(t.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,t.pageY-t.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,t.pageX-t.data.pos.left))/150,10)).get(0),[t.data.preview]),e(document).unbind("mouseup",x),e(document).unbind("mousemove",w),e(this).parent().find("div.colorpicker_color").unbind("mouseup",$),!1},x=function(t){return o(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),s(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",x),e(document).unbind("mousemove",w),!1},C=function(){e(this).addClass("colorpicker_focus")},S=function(){e(this).removeClass("colorpicker_focus")},T=function(){var t=e(this).parent(),i=t.data("colorpicker").color;t.data("colorpicker").origColor=i,c(i,t.get(0)),t.data("colorpicker").onSubmit(i,q(i),F(i),t.data("colorpicker").el)},A=function(){var t=e("#"+e(this).data("colorpickerId"));t.data("colorpicker").onBeforeShow.apply(this,[t.get(0)]);var i=e(this).offset(),a=z(),o=i.top+this.offsetHeight,n=i.left;return o+176>a.t+a.h&&(o-=this.offsetHeight+176),n+356>a.l+a.w&&(n-=356),t.css({left:n+"px",top:o+"px"}),0!=t.data("colorpicker").onShow.apply(this,[t.get(0)])&&t.show(),e(document).bind("mousedown",{cal:t},I),!1},I=function(t){R(t.data.cal.get(0),t.target,t.data.cal.get(0))||(0!=t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e(document).unbind("mousedown",I))},R=function(e,t,i){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var a=t.parentNode;a&&a!=i;){if(a==e)return!0;a=a.parentNode}return!1},z=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},P=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},L=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},E=function(e){var t=6-e.length;if(t>0){for(var i=[],a=0;t>a;a++)i.push("0");i.push(e),e=i.join("")}return e},U=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}},N=function(e){return D(U(e))},D=function(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),a=Math.max(e.r,e.g,e.b),o=a-i;return t.b=a,t.s=0!=a?255*o/a:0,t.h=0!=t.s?e.r==a?(e.g-e.b)/o:e.g==a?2+(e.b-e.r)/o:4+(e.r-e.g)/o:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},F=function(e){var t={},i=Math.round(e.h),a=Math.round(255*e.s/100),o=Math.round(255*e.b/100);if(0==a)t.r=t.g=t.b=o;else{var n=o,s=(255-a)*o/255,r=(n-s)*(i%60)/60;360==i&&(i=0),60>i?(t.r=n,t.b=s,t.g=s+r):120>i?(t.g=n,t.b=s,t.r=n-r):180>i?(t.g=n,t.r=s,t.b=s+r):240>i?(t.b=n,t.r=s,t.g=n-r):300>i?(t.b=n,t.g=s,t.r=s+r):360>i?(t.r=n,t.g=s,t.b=n-r):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},O=function(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(i,function(e,t){1==t.length&&(i[e]="0"+t)}),i.join("")},q=function(e){return O(F(e))},j=function(){var t=e(this).parent(),i=t.data("colorpicker").origColor;t.data("colorpicker").color=i,o(i,t.get(0)),s(i,t.get(0)),n(i,t.get(0)),r(i,t.get(0)),l(i,t.get(0)),d(i,t.get(0))};return{init:function(t){if(t=e.extend({},a,t||{}),"string"==typeof t.color)t.color=N(t.color);else if(void 0!=t.color.r&&void 0!=t.color.g&&void 0!=t.color.b)t.color=D(t.color);else{if(void 0==t.color.h||void 0==t.color.s||void 0==t.color.b)return this;t.color=P(t.color)}return this.each(function(){if(!e(this).data("colorpickerId")){var a=e.extend({},t);a.origColor=t.color;var m="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colorpickerId",m);var b=e(i).attr("id",m);a.flat?b.appendTo(this).show():b.appendTo(document.body),a.fields=b.find("input").bind("keyup",u).bind("change",p).bind("blur",f).bind("focus",g),b.find("span").bind("mousedown",h).end().find(">div.colorpicker_current_color").bind("click",j),a.selector=b.find("div.colorpicker_color").bind("mousedown",y),a.selectorIndic=a.selector.find("div div"),a.el=this,a.hue=b.find("div.colorpicker_hue div"),b.find("div.colorpicker_hue").bind("mousedown",v),a.newColor=b.find("div.colorpicker_new_color"),a.currentColor=b.find("div.colorpicker_current_color"),b.data("colorpicker",a),b.parent().find("div.colorpicker_submit").bind("mouseenter",C).bind("mouseleave",S).bind("click",T),o(a.color,b.get(0)),n(a.color,b.get(0)),s(a.color,b.get(0)),l(a.color,b.get(0)),r(a.color,b.get(0)),c(a.color,b.get(0)),d(a.color,b.get(0)),a.flat?b.css({position:"relative",display:"block"}):e(this).bind(a.eventName,A)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&A.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if("string"==typeof t)t=N(t);else if(void 0!=t.r&&void 0!=t.g&&void 0!=t.b)t=D(t);else{if(void 0==t.h||void 0==t.s||void 0==t.b)return this;t=P(t)}return this.each(function(){if(e(this).data("colorpickerId")){var i=e("#"+e(this).data("colorpickerId"));i.data("colorpicker").color=t,i.data("colorpicker").origColor=t,o(t,i.get(0)),n(t,i.get(0)),s(t,i.get(0)),l(t,i.get(0)),r(t,i.get(0)),c(t,i.get(0)),d(t,i.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hidePicker,ColorPickerShow:t.showPicker,ColorPickerSetColor:t.setColor})}(jQuery),define("colorPicker",function(){}),/**
 * @license
 * DO NOT UPDATE -nf
 * jQuery dropper plug-in
 *
 * Copyright 2010 Scott Trudeau
 *
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
function(e){e.fn.dropper=function(t){var i={clickCallback:function(){},mouseMoveCallback:function(){},mouseOutCallback:function(){},destroy:!1};t&&e.extend(i,t),this.each(function(){if("IMG"!==this.tagName)return this;e(this).on("load readystatechange",function(){var t=e(this),n=t.width(),s=t.height(),r=t.get(0),l=t.parent();l.find("canvas").remove();var c=document.createElement("canvas");c.width=201,c.height=s*(201/n),s*=201/n,n=201,l.prepend(c);try{var d=c.getContext("2d");d.drawImage(r,0,0,n,s);var u=d.getImageData(0,0,n,s)}catch(p){return e(c).remove(),t.show(),!1}t.hide(),t.on("destroy.eyedropper",function(){e(c).remove(),t.show()}),e(c).addClass("droppertarget").css({marginTop:-(s-155)/2}),e(c).on({"mousemove.eyedropper":function(t){var n=o(t,e(this).width(),e(this).offset()),s=a(n,u.data);i.mouseMoveCallback(s),e.doTimeout("droppertimeout")},"mouseout.eyedropper":function(n){var s=o(n,e(this).width(),e(this).offset()),r=a(s,u.data);i.mouseOutCallback(r),e.doTimeout("droppertimeout",3500,function(){t.trigger("destroy.eyedropper")})},"click.eyedropper":function(n){var s=o(n,e(this).width(),e(this).offset()),r=a(s,u.data);return t.trigger("destroy.eyedropper"),i.clickCallback(r),!1}})});var t=this.src;return this.src="#",this.src=t,this});var a=function(e,t){var i={r:t[e],g:t[e+1],b:t[e+2],alpha:t[e+3]};return i.rgbhex=s(i.r,i.g,i.b),i},o=function(e,t,i){var a=e.pageX-parseInt(i.left),o=e.pageY-parseInt(i.top);return 4*(a+o*t)},n=function(e){if(void 0===e)return"FF";for(var t=e.toString(16);t.length<2;)t="0"+t;return t},s=function(e,t,i){return n(e)+n(t)+n(i)}}}(jQuery),define("dropper",function(){}),/**
 * @license
 * fontAvailable jQuery Plugin, v1.1
 *
 * Copyright (c) 2009, Howard Rauscher
 * Licensed under the MIT License
 */
function(e){var t;e.fontAvailable=function(i){var a,o;return t||(t=e(document.createElement("span")).css("visibility","hidden").css("position","absolute").css("top","-10000px").css("left","-10000px").html("abcdefghijklmnopqrstuvwxyz").appendTo(document.body)),a=t.css("font-family","__FAKEFONT__").width(),o=t.height(),t.css("font-family",i),a!==t.width()||o!==t.height()}}(jQuery),define("fontAvailable",function(){}),define("controller/socialimport",["globals","log","lib/event","data/user","lib/metrics"],function(e,t,i,a,o){t.module("controller/socialimport");var n={init:function(){n.check(),i.on("bio_changed background_image_changed",function(){n.check()})},check:function(){$(".profile").find(".social-import").remove();var e=$(".profile").find(".bio").text();if(a.Settings.page_complete.bio=/\S/.test(e),!a.Settings.page_complete.bio&&"custom"!=a.Settings.page_complete.background){var t='<div class="profile-content social-import"><div class="buttons"><a href="/facebook/update_profile" class="button glyph-facebook import-facebook">Import Profile from Facebook</a><a href="/twitter/update_profile" class="button glyph-twitter import-twitter">Import Profile from Twitter</a></div></div>';$(".profile-head").after(t),$(".social-import").find(".button").on("click",function(){var e=$(this);e.hasClass("import-facebook")?o.log("Import Profile Data from Facebook"):e.hasClass("import-twitter")&&o.log("Import Profile Data from Twitter")}),i.trigger("biobox_changed")}}};n.init()}),define("view/edit",["globals","log","viewer","lib/event","lib/metrics","/me/viewer/edit/"+(new Date).getTime(),"lib/dialog","lib/ajax","lib/utils","lib/color","lib/colorthief","class/tokenbox","class/saver","data/user","class/tabs","lib/query","browser","viewport","controller/tooltips","controller/welcomescreen","lib/windowtools","lib/escape","controller/addappmodal","module/backstory_promos","text!template/share_banner.html","widget","iframeTransport","fileUpload","colorPicker","dropper","carousel","truncate","fontAvailable","backstretch","class/progressbar","doTimeout","jstorage","touchpunch","class/menu","controller/socialimport","easyxdm"],function(e,t,i,a,o,n,s,r,l,c,d,u,p,f,g,h,m,b,v,k,y,w,x,C,S){t.module("view/edit");var T=t.create("edit","background-color:purple;color:white"),A={init:function(){T.important("Customize.init"),$("head").append('<link rel="stylesheet" type="text/css" href="'+e.STATIC_HOSTNAME+'/css/view/edit.css" />'),$("body").addClass("profilepage-edit"),l.insertCSS(n.css,"edit-css"),l.insertHTML(n.html,".page-content"),A.boxLeft=n.customize.boxLeft,A.boxTop=n.customize.boxTop,A.saved_backgrounds=n.customize.saved_backgrounds,A.has_instagram=n.customize.has_instagram,A.has_facebook=n.customize.has_facebook,A.has_px500=n.customize.has_px500,A.instagram_backgrounds=n.customize.instagram_backgrounds,A.facebook_backgrounds=n.customize.facebook_backgrounds,A.px500_backgrounds=n.customize.px500_backgrounds,A.gallery_backgrounds=n.customize.gallery_backgrounds,A.currenttab=n.customize.currenttab,A.firstview=n.customize.firstview,T("Customize.firstview: "+A.firstview);var t='<li><span class="addbutton addservicebutton button dark">Add App</span></li>';$(".profile ul.services").append(t),a.trigger("biobox_changed"),$("body").on("click",".addservicebutton",x.open),$("div.profile").hover(function(){$(this).hasClass("profile-transparent")&&$(this).css("border-color","#"+f.Settings.colors.name_color)},function(){$(this).hasClass("profile-transparent")&&($(this).hasClass("profile-transparent-dragging")||$(this).css("border-color","transparent"))}),A.initSavers(),A.updatecache("edit_currenttab",A.currenttab),$(".customize-tabs").tabs({trigger:"li.button",tab:function(e){return $("div.tab#customize-pane-"+this.o.tabid(e))},tabid:function(e){return e.attr("data-section")},activenode:function(e){return e.closest("li")},readquery:!0,setquery:!0,beforeInit:function(){this.checkQuery=A.checkScope,this.setQuery=A.setScope},afterInit:function(){A.Tabs||(A.Tabs=this)},afterSwitch:function(){A.Tabs||(A.Tabs=this),A.afterShowTab()}}),a.on("weak_edit_open",A.open),a.on("weak_addapp_open",x.open),A.initDraggables(),$(".topnav .editbutton").on("click",A.toggle).closest(".nav-link").vshow(),$(".topnav .editpage").remove(),A.firstview&&$.jStorage.get("firstviewComplete")!=f.Settings.user_name||A.Promos.init(),A.firstview&&$.jStorage.get("firstviewComplete")!=f.Settings.user_name&&(a.ready("welcome_closed",function(){m.is("touch")||(v.init(A.Tooltips.tips),$.doTimeout(2300,function(){v.start("edit")}))}),AboutMe.when("viewport:small",function(){v.cancel()})),AboutMe.whenever("viewport:not:small",function(){f.Settings.mobile.background_image&&f.Settings.mobile.background_image.length&&(A.open(),A.showTab("backgrounds"))}),a.everReady("edit_pane_ready",function(){A.editField.init(),A.Tooltips.init()}),A.EditClickTrack.init(),AboutMe.on("window:resize",function(){b.isNot("small")&&A.checkPosition()}),a.on("customize_settab",function(e,t){A.setCurrentTab(t)}),a.trigger("customize_ready",[{firstview:A.firstview}]),T.timeEnd("··· view/edit complete in"),A.checkQueryActions()},checkPosition:function(){if(!b.is("small")){var e=$(window).width(),t=$(".customize");if(t.length){var i=t.outerWidth(),a=t.offset().left,o=i+a;0>a&&t.animate({left:"0",marginLeft:"0px"},200),o>e&&t.animate({left:e-i-20+"px",marginLeft:"0px"},200)}}},editField:{init:function(){A.editField.toggleEmpties(),$(".customize-pane fieldset").not(".pic-upload").find(".field").on("click.reveal",A.editField.reveal),$(".tokeninput, input.mintext").on("focus.reveal",A.editField.reveal),$("body").on("click dragstart",A.editField.conceal),$("body").on("keydown",".editfield",A.editField.conceal)},reveal:function(e){"click"==e.type&&e.stopPropagation();var t=$(this),i=t.closest("fieldset");1!=i.data("editing")&&(A.editField.toggleEmpties(i),i.removeClass("notediting editing").addClass("editing"),"click"==e.type&&(i.hasClass("bio")?(A.biography.BioEditor.instance.setData($(".profile div.bio").html()),A.biography.BioEditor.focus()):i.hasClass("country")||i.hasClass("state")&&!i.find("select").hasClass("invisible")?i.find("select").eq(0).focus():i.find("input[type=text]").eq(0).focus()),i.data("editing",!0))},conceal:function(e){"click"==e.type&&$(e.target).closest(".customize .ui-dialog-titlebar, .linkdialog, .ui-widget-overlay, .cke_editor_bio_input_container_dialog").length||"dragstart"==e.type&&$(e.target).closest(".customize").length||("keydown"!=e.type||13==e.which)&&$("fieldset.editing").each(function(){$(this).data("editing",!1),$(this).removeClass("editing notediting empty").addClass(A.editField.isEmpty($(this))?"editing empty":"notediting")})},toggleEmpties:function(e){var t;t=e?e.siblings():$(".customize-pane").find("fieldset"),t.each(function(){$(this).data("editing",!1),$(this).removeClass("editing notediting empty").addClass(A.editField.isEmpty($(this))?"editing empty":"notediting")})},isEmpty:function(e){var t=e.find(".token"),i=e.find("input.mintext").eq(0),a=e.find(".display"),o=$.trim(i.val()),n=$.trim(a.text()),s=!1;return 0!=t.size()||o||n||(s=!0),s}},checkScope:function(){var e=this,t=A.currenttab;e.o.scope&&(t=t.replace(new RegExp("^"+e.o.scope+"/"),"")),T("tabstring: "+t);var i=t.split("/"),a=!1;return i[0]&&i[0].length&&(T("Customize.checkScope: "+i[0]),a=e.showTabByName(i[0])),a},setScope:function(){var e=this,t=[];if(e.o.scope){t.push(e.o.scope);var i=t.join("/");if(A.currenttab.indexOf(i)<0)return}t.push(e.currenttab);var a=t.join("/");A.currenttab.indexOf(a)>-1||A.setCurrentTab(a);var o=$(document).data("tabsets")||{};o[a]&&o[a].setQuery()},setCurrentTab:function(e){A.currenttab=e.length?e:"backgrounds",T("Customize.setCurrentTab: "+e)},showTab:function(e){if("string"!=typeof e)return T("Customize.showTab called with non-string:"),void T(e);T("Customize.showTab: "+e),e=e.length?e:"backgrounds",A.setCurrentTab(e);var t=e.split("/");T("Customize.showTab: "+e),A.Tabs&&A.Tabs.showTabByName(t[0])},afterShowTab:function(){var e=A.Tabs.currenttab;$("#customize-pane-"+e).length&&($("#customize-pane-"+e).hasClass("loading")&&a.everReady("biobox_shown",function(){A.loadPane(e)}),A.save&&A.save("edit_currenttab",A.currenttab))},loadPane:function(t){require(["/me/viewer/"+t],function(i){var o=$("#customize-pane-"+t);switch(i.html&&(l.insertHTML(i.html,o),o.removeClass("loading")),i.css&&A.insertCSS(i.css,t+"-css"),A[t].init&&A[t].init(),t){case"backgrounds":A.EditClickTrack.background(),A.backgrounds.carousel.single.bgSaved&&A.backgrounds.carousel.single.bgSaved.items.length>0&&$(".customize-pane .bg_saved_carousel,.customize-pane .bg_saved_carousel + hr").removeClass("invisible");break;case"fonts":A.fonts.restyleMenus(),f.Settings.fonts.typekitEnabled===!1&&($(".font_select_message").empty().append("Typekit fonts are currently unavailable for about.me users. We hope to have font selection restored shortly. Thank you for your patience."),$(".fontselect").hide());break;case"getvisitors":A.EditClickTrack.promote();var n=$("#customize-pane-getvisitors"),s=n.find(".linkchart img.thumb");s.error(function(){s.attr("src","http://"+e.DOMAIN_NAME+"/images/directory/silhouette-210x140.png")}),s.attr("src",s.attr("data-src"));break;case"colors":A.EditClickTrack.colors(),a.on("background_image_changed",function(){A.colors.Colors.setupColorPickers()})}a.trigger("edit_pane_ready")})},checkQueryActions:function(){var t=h.parse("#!/",null,"/",!1);switch(t[0]){case"addservice":var i=t.slice(1);T(i),x.addServicesParseQuery(i);break;case"getstarted":a.ready("welcome_modal_ready",function(){k.open()});break;case"edit":var i=t.slice(1);T("Customize.checkQueryActions: "+i),A.open(),i.length&&A.showTab(i.join("/"))}t.length&&0!=e.RESET_HASH_URL&&(document.location="#")},updateName:function(){var e=$("#customize-pane-biography"),t=$.trim(e.find("input.firstname").val()),i=$.trim(e.find("input.lastname").val()),o=t+" "+i;$(".profile div.profile-head h1.name").text(o);var n=t||f.Settings.user_name||"My Page";$(".structure.topnav").find(".mypage .menu-label").text(n).attr("data-menuname",n),a.trigger("biobox_changed")},initSavers:function(){A.Saver=new p({name:"CustomizeSaver",success:function(e){var t=this,i=$.extend({},e);t.unsavedchanges?(t.banner=s.banner("Your changes have been saved."),t.unsavedchanges=!1):($.each(t.options.quietproperties,function(e){delete i[t.options.quietproperties[e]]}),$.isEmptyObject(i)||A.Notifier.show()),i.background_image&&($(".theme_background").removeClass("inactive"),$(".theme_background").closest("li").animate({opacity:"1.0"},200))},beforeSave:function(){A.Notifier.hide()},quietproperties:["_authentication_token","call","profile_width","customize_top","customize_left","edit_currenttab"],delay:e.CUSTOMIZE_SAVER_DELAY}),A.Saver.save&&(A.save=function(e,t){A.Saver.save(e,t)},A.updatecache=function(e,t){A.Saver.updatecache(e,t)}),a.everReady("userprofile_changed",function(e,t,i){void 0!==t&&A.Saver.save(t,i)}),a.everReady("customize_savenow",function(){A.Saver.saveNow()}),A.cacheUserSettings(f.Settings)},initDraggables:function(){AboutMe.when("viewport:not:small",function(){m.is("touch")||(0==$(".profile-constrain").size()&&$(".background-container").prepend('<div class="profile-constrain"></div>'),$("div.profile").on("mousedown",function(){if("right"!=f.Settings.images.background_repeat&&"left"!=f.Settings.images.background_repeat){var e=$(this);e.css({marginLeft:0,left:e.offset().left,right:"auto"})}}),$("div.profile").on("mouseup",function(){"right"!=f.Settings.images.background_repeat&&"left"!=f.Settings.images.background_repeat&&A.setBioPos({save:!1})}),$("div.profile").draggable({cursor:"move",delay:300,containment:".profile-constrain",cancel:".actions li, ul#service-icons li, .meta a, .bio a, .menu, .profile_photo img",scroll:!1,start:function(){$(".menu.active").click();{var e=$(this);e.data("draggable"),$(".background-container")}"right"==f.Settings.images.background_repeat&&e.css({marginLeft:0,left:e.offset().left,right:"auto"}),$("html").addClass("profile-dragging"),e.hasClass("profile-transparent")&&e.addClass("profile-transparent-dragging")},drag:function(e,t){return i.logged_in&&i.is("weak_login")?(a.trigger("weak_login",["biobox drag","","","event"]),!1):void(t.position.top<=0&&(t.position.top=0))},stop:function(){{var e=$(this),t=e.data("draggable");$(t.options.containment)}$("html").removeClass("profile-dragging"),e.hasClass("profile-transparent")&&(e.removeClass("profile-transparent-dragging"),e.css("border-color","transparent")),A.setBioPos({dragged:!0}),a.trigger("biobox_changed")}}),$(".background").draggable({cursor:"move",scroll:!1,delay:300,start:function(e){$("html").addClass("background-dragging"),$(".menu.active").click(),A.backgrounds.startY=e.pageY,("scale partial"==f.Settings.images.background_repeat||"scale"==f.Settings.images.background_repeat)&&(A.backgrounds.set({type:"drag"}),$(".background").css({width:f.Settings.images.background_width,height:f.Settings.images.background_height,marginLeft:e.pageX-f.Settings.images.background_width/2,marginTop:e.pageY-f.Settings.images.background_height/2,position:"absolute"}))},drag:function(e){if(i.logged_in&&i.is("weak_login"))return a.trigger("weak_login",["background drag","","","event"]),!1;A.backgrounds.endY=e.pageY;var t=Math.round(A.backgrounds.startY-A.backgrounds.endY);if("repeat"==f.Settings.images.background_repeat){var o=$(".background-container").css("background-position").split(" "),n=Math.round(parseInt(o[1])-t);$(".background-container").css({backgroundPosition:"50% "+n+"px"}),A.backgrounds.startY=e.pageY}},stop:function(){if($("html").removeClass("background-dragging"),"repeat"!=f.Settings.images.background_repeat){var e=parseInt($(this).offset().left-$(".background-container").width()/2,10),t=parseInt($(this).css("margin-top"));A.backgrounds.set({type:"drag",pos:{x:e,y:parseInt($(this).css("top"),10)+t}}),$(this).css("margin-top",0)}"repeat"==f.Settings.images.background_repeat&&($(".background-container .background").css({left:0,top:0,width:"100%",height:"100%",marginLeft:0}),A.backgrounds.set({pos:{x:50,y:parseInt($(".background-container").css("background-position").split(" ")[1])}}))}}),$.browser.msie&&$.browser.version<9&&$(".background").draggable("disable"))}),$("div#customize").dialog({title:"Edit Page",modal:!1,autoOpen:!1,autoCenter:!1,dialogClass:"customize small dark",width:580,zIndex:299,stack:!1,position:[A.boxLeft,A.boxTop],open:function(){$("body,html").animate({scrollTop:0},200),$("div.customize").draggable({containment:".profile-container",handle:".ui-dialog-titlebar",cancel:".ui-dialog-titlebar-close",start:function(){$(".menu.active").click();var e=$(this);e.addClass("customize-dragging"),a.trigger("edit_start_dragging")},drag:function(t,i){i.position.top<=e.NAV_HEIGHT&&(i.position.top=e.NAV_HEIGHT)},stop:function(){var e=$(this);e.removeClass("customize-dragging"),A.boxLeft=e.offset().left,A.boxTop=e.offset().top,A.checkPosition(),A.save({customize_left:A.boxLeft,customize_top:A.boxTop}),a.trigger("edit_stop_dragging")}})},close:function(){a.trigger("edit_close"),A.opened=!1,$("div.customize").draggable("destroy")}}),AboutMe.on("viewport:small",function(){$("div.profile").data("draggable")&&$("div.profile").draggable("disable"),$(".background").data("draggable")&&$(".background").draggable("disable")}),AboutMe.on("viewport:not:small",function(){$("div.profile").data("draggable")&&$("div.profile").draggable("enable"),$(".background").data("draggable")&&$(".background").draggable("enable")})},open:function(){if(i.logged_in&&i.is("weak_login"))return a.trigger("weak_login",["clicked on edit panel","weak_edit_open","","event"]),!1;if($("div#customize").dialog("open"),A.boxTop<e.NAV_HEIGHT&&(A.boxTop=e.NAV_HEIGHT),A.firstview&&-500==A.boxLeft){var t=$(window).width();A.boxLeft=t/2,A.save({customize_left:A.boxLeft})}$("div.customize").css({top:A.boxTop+"px",left:A.boxLeft+"px"}),A.checkPosition(),$(".topnav .editbutton").closest(".nav-link").addClass("active"),$(".topnav .editbutton").closest(".menu").data("menu").hide(),A.opened=!0,a.trigger("edit_open"),T.timeEnd("Customize.open"),T("Customize.open, currenttab: "+A.currenttab)},close:function(){T("Customize.close"),$("div#customize").dialog("close")},toggle:function(e){e&&e.preventDefault&&e.preventDefault(),A.opened?A.close():A.open()},cacheUserSettings:function(e){for(var t in e)if(e.hasOwnProperty(t)&&null!=e[t])switch(e[t].constructor.name){case"Boolean":case"String":A.updatecache(t,e[t]);break;case"Array":A.updatecache(t,JSON.stringify(e[t]));break;case"Object":A.cacheUserSettings(e[t]);break;case"Function":}},updateStyle:function(e){$("head").append('<style type="text/css" id="user-changes">'+e+"</style>")},setBioPos:function(e){T("Customize.setBioPos"),e=$.extend({dragged:!1,save:!0},e);var t=$("div.profile"),i=$(".background-container");switch(f.Settings.profile.text_top=parseInt(t.css("top"),10),f.Settings.images.background_repeat){case"left":f.Settings.profile.text_left=t.offset().left,t.css({left:f.Settings.profile.text_left,marginLeft:0,right:"auto"});break;case"right":f.Settings.profile.text_left=parseInt(i.width()-t.offset().left-t.outerWidth(),10),t.css({right:f.Settings.profile.text_left,marginLeft:0,left:"auto"});break;case"instagram-left":f.Settings.profile.text_top=e.dragged?f.Settings.profile.text_top:100,f.Settings.profile.text_left=e.dragged?parseInt(t.offset().left-i.width()/2,10):32,t.css({marginLeft:f.Settings.profile.text_left,right:"auto",left:"50%",top:f.Settings.profile.text_top}),e.dragged&&A.backgrounds.set({type:"drag"});break;case"instagram-right":f.Settings.profile.text_top=e.dragged?f.Settings.profile.text_top:100,f.Settings.profile.text_left=e.dragged?parseInt(t.offset().left-i.width()/2,10):parseInt(0-t.outerWidth()+10),t.css({marginLeft:f.Settings.profile.text_left,right:"auto",left:"50%",top:f.Settings.profile.text_top}),e.dragged&&A.backgrounds.set({type:"drag"});break;default:f.Settings.profile.text_left=Math.max(-640,parseInt(t.offset().left-i.width()/2,10)),f.Settings.profile.text_left=Math.min(f.Settings.profile.text_left,640-t.width()),t.css({marginLeft:f.Settings.profile.text_left,right:"auto",left:"50%"})}e.save&&A.save({text_left:f.Settings.profile.text_left,text_top:f.Settings.profile.text_top}),e.complete&&e.complete(),a.trigger("biobox_moved")},confirmDelete:function(){var e=$(this).parents("ul.servicelinklist li"),t=$(this).parents("ul.servicelinklist");A.apps.needPassword=!1;var i={site_id:e.attr("data-id"),platform:e.attr("data-platform")},a="Are you sure you want to remove this item?",o="Remove Item";if(t.hasClass("servicelist")){var a="Are you sure you want to remove this app?";"twitter"!=i.platform||n.has_password||n.can_login_facebook||(a+="<br /><br /><strong>If you remove this app, you will be asked to choose a new password so you can continue logging in to about.me.</strong>",A.apps.needPassword=!0);var o="Remove App"}if(t.hasClass("linklist"))var a="Are you sure you want to remove this link?",o="Remove Link";if(t.hasClass("rsslist"))var a="Are you sure you want to remove your blog?",o="Remove";var r=function(t){t&&A.apps.deleteService(e,i)},l={button_labels:[o,"Cancel"],width:400};s.confirm(a,r,l)},sortableList:function(e){e&&(e=$(e),e.find("ul.sortablelist").each(function(){$(this).children().size()>1&&($(this).sortable({cursor:A.apps.sortCursor(),axis:"y",containment:"parent",tolerance:"pointer",placeholder:"ui-sortable-highlight",cancel:".button,span.button-content,.service-edit",scroll:!1,stop:A.apps.onSort,sort:function(e,t){t.placeholder.position().top;t.helper.css({top:t.position.top+$(window).scrollTop()+"px"})}}),$(this).children("li, .service-name, .icon").css("cursor",A.apps.sortCursor()))}),e.find("ul.sortablelist li").each(function(){this.onselectstart=function(){return!1}}))}};A.backgrounds={init:function(){$("#customize-pane-backgrounds ul.bg-select").tabs({scope:"backgrounds",readquery:!0,setquery:!0,tab:function(e){return $("#customize-pane-backgrounds div.tab."+e.attr("href").replace(/.*#/,""))},beforeInit:function(){this.checkQuery=A.checkScope,this.setQuery=A.setScope},afterSwitch:function(){A.afterShowTab()}}),A.backgrounds.setcarousels(),A.backgrounds.choices=$("#bg_saved_thumbs, #bg_custom_thumbs, #bg_instagram_thumbs, #bg_facebook_thumbs, #bg_px500_thumbs"),$("#bg_saved_thumbs").find("li").each(function(){var e=$(this).find(".checkmark").detach();$(this).find(".saved_bg").append(e)}),$("html").addClass(document.getElementById("background_upload").disabled?"no-fileupload":"fileupload"),$(".bgpositionoptions .button").on("click",A.backgrounds.positionButtons),A.backgrounds.Instagram.init(),A.backgrounds.Facebook.init(),A.backgrounds.Upload.init(),A.backgrounds.choices.on("click",".theme_background:not(.inactive)",A.backgrounds.select),$("body").on("click","#bg_saved_thumbs .remove-thumb:not(.inactive)",A.backgrounds.saved.confirmRemove),a.on("biobox_width_changed",function(){if("instagram-right"==f.Settings.images.background_repeat){var e=$("div.profile"),t=parseInt(0-e.outerWidth()+10);e.css({marginLeft:t},200),A.setBioPos()}}),AboutMe.whenever("viewport:not:small",function(){if(f.Settings.mobile.background_image&&f.Settings.mobile.background_image.length){var e={type:f.Settings.mobile.background_repeat,image:f.Settings.mobile.background_image,dims:{width:f.Settings.mobile.background_width,height:f.Settings.mobile.background_height}};f.Settings.mobile={},A.backgrounds.set(e,!0);var t={image:f.Settings.mobile.background_image,thumb:f.Settings.mobile.background_image.replace(/\/background\//,"/thumbnail/")};A.backgrounds.saved.update(t)}})},carousel:{single:{}},setcarousels:function(){if(A.has_instagram&&A.instagram_backgrounds&&A.instagram_backgrounds.length){var e=[];$.each(A.instagram_backgrounds,function(t,i){e.push([i.thumbnail,i.big_image])}),A.backgrounds.carousel.single.bgInstagram={items:e,items_num:12,items_class:"theme_background",rows_num:2,type:"multiRow",items_height:190,nav_type:"bar",wrap:!1},$("#bg_instagram_thumbs").meCarousel(A.backgrounds.carousel.single.bgInstagram)}if(A.has_facebook){var t=[],i=function(){$.each(A.facebook_backgrounds,function(e,i){i.src.length&&i.orig.length&&t.push([i.src,i.orig])}),A.backgrounds.carousel.single.bgFacebook={items:t,items_num:12,items_class:"theme_background",rows_num:2,type:"multiRow",items_height:190,nav_type:"bar",wrap:!1},$("#bg_facebook_thumbs").meCarousel(A.backgrounds.carousel.single.bgFacebook)};if(A.facebook_backgrounds.length<1||!A.facebook_backgrounds[0].orig){$.doTimeout("load-fb-images"),T(">>>>HITTING get_facebook_photos");var a={success:function(e){A.facebook_backgrounds=e.images,T(A.facebook_backgrounds),i()},error:function(e){T(e)}};r.post("get_facebook_photos",{},a)}else i()}A.backgrounds.carousel.single.bgSaved={items:A.saved_backgrounds,items_num:3,items_class:"saved_bg theme_background",type:"bgSaved",items_height:130,nav_type:"bar",wrap:!1,active:f.Settings.images.background_image},$("#bg_saved_thumbs").meCarousel(A.backgrounds.carousel.single.bgSaved),A.backgrounds.carousel.single.bgCustom={items:A.gallery_backgrounds,items_class:"theme_background",items_num:3,type:"bgCustom",items_height:130,nav_type:"bar",wrap:!1},$("#bg_custom_thumbs").meCarousel(A.backgrounds.carousel.single.bgCustom)},select:function(t){t.preventDefault(),T("image clicked");{var i=$(this).attr("data-value"),a=$(this).find("img").attr("src"),o=$("#bg_saved_thumbs");$("#bg_custom_thumbs")}if($(this).closest("li").hasClass("active"))i="no-background",$(this).closest("li").removeClass("active"),A.backgrounds.set({image:i},!0);else if(o.find("li").removeClass("active"),$(this).hasClass("saved_bg"))$(this).closest("li").addClass("active"),$("body").append("<img src="+i+' class="test_image" />'),$(".test_image").on("load",function(){var e={width:$(this).width(),height:$(this).height()};$(this).remove(),A.backgrounds.set({image:i,dims:e})});else if(i.indexOf("http://")>-1||i.indexOf("https://")>-1)$(this).closest("#bg_instagram_thumbs").length?A.backgrounds.customize_type="Instagram":$(this).closest("#bg_facebook_thumbs").length?A.backgrounds.customize_type="Facebook":$(this).closest("#bg_px500_thumbs").length&&(A.backgrounds.customize_type="500px"),A.backgrounds.get({image_src:i,element:$(this)});else{a=e.AWS_IMAGES+"/thumbnail/"+i,i=e.AWS_IMAGES+"/background/"+i;var n=!1;if(o.find("li").each(function(){i===$(this).find(".theme_background").attr("data-value")&&($(this).addClass("active"),$("#bg_saved_thumbs-carousel").trigger("refresh"),n=!0)}),!n){var s={image:i,thumb:a,from:$(this).closest("li")};A.backgrounds.saved.update(s)}A.backgrounds.set({image:i,dims:{width:1680,height:1050}},!0)}},get:function(e){var t=e.element.closest(".section");A.ProgressBar.init(t,{width:"300px",left:"50%",marginLeft:"-150px",position:"absolute",top:"84px",marginTop:"-24px"},"Transferring your background&hellip;");var i={success:function(i){if(T("success:"),T(i),A.ProgressBar.hide(t),i.success===!0){e.image_thumb_src=i.new_background_image[0],e.image_src=i.new_background_image[1];var a={image:e.image_src,thumb:e.image_thumb_src};A.backgrounds.saved.update(a),A.backgrounds.set({image:e.image_src,dims:{width:i.width,height:i.height}})}},error:function(e){T("error:"),T(e),A.ProgressBar.hide(t),s.banner("There was a problem retrieving your image. Please try again later.",{status:"error"})}},a={image_url:e.image_src};r.post("import_image_from_url",a,i)},set:function(t,i){var o={},n=$(".background-container"),s=n.find(".background"),r=$("#backstretch");if(t.image){var l=t.image;f.Settings.images.background_image=l;var c=$(".mobile-background-container");if(n.css({backgroundImage:"none"}),s.empty(),r.remove(),"no-background"!=l){switch(f.Settings.images.background_repeat){case"repeat":n.css({backgroundImage:"url("+f.Settings.images.background_image+")"});break;case"scale":$.backstretch(f.Settings.images.background_image,{centeredY:!1,attachTo:".background-container"});break;case"scale partial":case"center":case"left":case"right":case"drag":case"instagram-left":case"instagram-right":s.html('<img src="'+f.Settings.images.background_image+'" />'),$(window).trigger("resize.scalepartial")}"drag"==f.Settings.images.background_repeat&&$(".bgpositionoptions").find("[data-value=center]").click(),c.find("img").size()<1&&c.append('<img class="mobile-bg-test-img" />'),c.find("img.mobile-bg-test-img").attr("src",f.Settings.images.background_image),c.css({backgroundImage:"url("+f.Settings.images.background_image+")"})}else c.css("background-image","none").find("img.mobile-bg-test-img").remove();f.Settings.page_complete.background=f.Settings.images.background_image.length?-1!=f.Settings.images.background_image.indexOf(f.Settings.user_name)?"custom":"gallery":"none",A.EditClickTrack.background(A.backgrounds.customize_type?A.backgrounds.customize_type:f.Settings.page_complete.background),A.backgrounds.customize_type="",a.trigger("background_image_changed"),o.background_image=f.Settings.images.background_image}if(t.dims){var l=t.dims;switch(f.Settings.images.background_width=l.width,f.Settings.images.background_height=l.height,f.Settings.images.background_repeat){case"scale partial":s.css({width:"100%",height:"100%",position:"fixed"}),$(window).trigger("resize.scalepartialfix");break;case"center":s.css({width:f.Settings.images.background_width,height:f.Settings.images.background_height,marginLeft:-(l.width/2)});default:s.css({width:l.width+"px",height:l.height+"px"})}if(612==f.Settings.images.background_width)A.backgrounds.Instagram.enableTemplates(),612==f.Settings.images.background_height&&$(".bg-instagram-layouts .bg-instagram-right").click();else switch(A.backgrounds.Instagram.disableTemplates(),f.Settings.images.background_repeat){case"instagram-left":case"instagram-right":$(".bgpositionoptions").find("[data-value=center]").click()}$(window).trigger("resize.scalepartial"),o.background_width=f.Settings.images.background_width,o.background_height=f.Settings.images.background_height}if(t.type){var l=t.type;f.Settings.images.background_repeat=l,A.setBioPos({complete:function(){function i(e){A.backgrounds.unsetPositions(),e&&$(".bgpositionoptions").find('[data-value="'+e+'"]').addClass("active")}n.removeClass("center scale left right repeat drag instagram-right instagram-left partial").addClass(l),s.draggable("enable"),$.browser.msie&&$.browser.version<9&&$(".background").draggable("disable");{var c=t.image||f.Settings.images.background_image;t.dims?t.dims.width:f.Settings.images.background_width}switch(l){case"scale":s.css({width:"100%",height:"100%",marginLeft:0,top:e.NAV_HEIGHT,left:0,position:"fixed"}),$.backstretch(c,{centeredY:!1,attachTo:".background-container"}),s.empty(),n.css({backgroundImage:"none"}),i("scale");break;case"scale partial":s.html('<img src="'+c+'" class="background-image" />'),r.remove(),n.css({backgroundImage:"none"}),s.css({width:"100%",height:"100%",marginLeft:0,top:e.NAV_HEIGHT,left:0,position:"fixed"}),i("scale partial"),a.trigger("resize.scalepartial");break;case"repeat":n.css({backgroundImage:"url("+c+")",backgroundPosition:"50% 0"}),s.empty(),r.remove(),s.css({width:"100%",height:"100%",marginLeft:0,top:0,left:0}),f.Settings.images.background_y=0,o.background_y=0,i("repeat");break;case"center":s.html('<img src="'+c+'" />'),n.css({backgroundImage:"none"}),r.remove(),s.css({top:0,right:"auto",left:"50%",marginLeft:-(f.Settings.images.background_width/2),width:f.Settings.images.background_width,height:f.Settings.images.background_height}),i("center");break;case"left":s.html('<img src="'+c+'" />'),n.css({backgroundImage:"none"}),r.remove(),s.css({top:0,left:0,right:"auto",marginLeft:0,width:f.Settings.images.background_width,height:f.Settings.images.background_height}),i("left");break;case"right":s.html('<img src="'+c+'" />'),n.css({backgroundImage:"none"}),r.remove(),s.css({top:0,right:0,left:"auto",marginLeft:0,width:f.Settings.images.background_width,height:f.Settings.images.background_height}),i("right");break;case"drag":s.html('<img src="'+c+'" />'),n.css({backgroundImage:"none"}),r.remove(),s.css({width:f.Settings.images.background_width,height:f.Settings.images.background_height}),i();break;case"instagram-left":case"instagram-right":s.html('<img src="'+c+'" />'),n.css({backgroundImage:"none"}),r.remove(),s.css({width:f.Settings.images.background_width,height:f.Settings.images.background_height,left:"50%",right:"auto",top:100,marginLeft:"instagram-right"==l?32:-600}),i()}s.find("img").length<1&&s.html('<img src="'+e.STATIC_HOSTNAME+'/images/blank.gif" class="background-fill" />')}}),o.background_repeat=f.Settings.images.background_repeat}if(t.pos){var l=t.pos;f.Settings.images.background_x=l.x,f.Settings.images.background_y=l.y,"repeat"!=f.Settings.images.background_repeat&&"scale"!=f.Settings.images.background_repeat&&s.css({left:"50%",top:l.y,marginLeft:l.x}),o.background_x=f.Settings.images.background_x,o.background_y=f.Settings.images.background_y}i||(i=!1),A.backgrounds.save(o,i)},save:function(e,t){$.each(e,function(e,i){t?A.Saver.save(e,i,{delay:0}):A.save(e,i)})},px500:{init:function(){if($("#bg-px500-tile").on("click",A.backgrounds.px500.tileButton),$("#bg-add-px500").on("click",function(){x.open(),a.ready("appmodal_loaded",function(){$("#addapp-carousel .px500").first().click()})}),A.has_px500&&A.px500_backgrounds.length<1){var e=0;$.doTimeout("load-px500-images",300,function(){if(10==e)return!1;if(A.px500_backgrounds.length<1){var t={success:function(e){if(e.success===!0){$("#bg-px500 .no-content").hide(),$(".bg-px500-added,#bg_px500_thumbs").show();var t=[];A.px500_backgrounds=jQuery.parseJSON(e.profile_data),A.px500_backgrounds.length?($("#bg-px500 .carousel .no-content").hide(),$.each(A.px500_backgrounds,function(e,i){T(i),t.push([i.src,i.orig])}),A.backgrounds.carousel.single.bgpx500={items:t,items_num:12,items_class:"theme_background",rows_num:2,type:"multiRow",items_height:85,nav_type:"bar",wrap:!1},$("#bg_px500_thumbs").meCarousel(A.backgrounds.carousel.single.bgpx500)):$("#bg-px500 .carousel .no-content").show()
}else if(e.error)switch(T(e),e.error){case"Nopx500ImagesFound":s.banner("We couldn&rsquo;t find any 500px photos.",{status:"warning"})}},error:function(e){T(e)}},i={data_field:"px500_photos"};return r.post("get_user_profile_data",i,t),!1}return e++,!0})}},tileButton:function(){A.ProgressBar.init(".bg-px500-tiled",{width:"360px",left:"50%",marginLeft:"-180px",position:"absolute",top:"50%",marginTop:"-26px"},"Creating your background (this may take several minutes)&hellip;");var e={success:function(e){if(T("tile bg success"),T(e),A.ProgressBar.hide(".bg-px500-tiled"),e.success===!0){A.backgrounds.customize_type="500px collage";var t={image:e.new_background_image[1],thumb:e.new_background_image[0],dims:{width:e.width,height:e.height}};A.backgrounds.saved.update(t);var t={type:"center",image:e.new_background_image[1],dims:{width:e.width,height:e.height}};A.backgrounds.set(t)}else if(e.error)switch(e.error){case"Nopx500ImagesFound":s.banner("We couldn&rsquo;t find any 500px photos.",{status:"warning"})}},error:function(e){T("tile bg error"),T(e),A.ProgressBar.hide(".bg-px500-tiled"),s.banner("There was an issue creating your background. Please try again later.",{status:"error"})}},t={service:"px500"};r.post("create_tile_image",t,e)}},Facebook:{init:function(){if($("#bg-facebook-tile").on("click",A.backgrounds.Facebook.tileButton),$("#bg-add-facebook").on("click",function(){x.open(),a.ready("appmodal_loaded",function(){$("#addapp-carousel .facebook").first().click()})}),A.has_facebook&&A.facebook_backgrounds.length<1){var e=0;$.doTimeout("load-fb-images",300,function(){if(10==e)return!1;if(A.facebook_backgrounds.length<1){var t={success:function(e){if(e.success===!0){$("#bg-facebook .no-content").hide(),$(".bg-facebook-added,#bg_facebook_thumbs").show();var t=[];A.facebook_backgrounds=jQuery.parseJSON(e.profile_data),A.facebook_backgrounds.length?($("#bg-facebook .carousel .no-content").hide(),$.each(A.facebook_backgrounds,function(e,i){T(i),t.push([i.src,i.orig])}),A.backgrounds.carousel.single.bgFacebook={items:t,items_num:12,items_class:"theme_background",rows_num:2,type:"multiRow",items_height:85,nav_type:"bar",wrap:!1},$("#bg_facebook_thumbs").meCarousel(A.backgrounds.carousel.single.bgFacebook)):$("#bg-facebook .carousel .no-content").show()}else if(e.error)switch(T(e),e.error){case"NoFacebookImagesFound":s.banner("We couldn&rsquo;t find any Facebook photos.",{status:"warning"})}},error:function(e){T(e)}},i={data_field:"facebook_photos"};return r.post("get_user_profile_data",i,t),!1}return e++,!0})}},tileButton:function(){A.ProgressBar.init(".bg-facebook-tiled",{width:"360px",left:"50%",marginLeft:"-180px",position:"absolute",top:"50%",marginTop:"-26px"},"Creating your background (this may take several minutes)&hellip;");var e={success:function(e){if(T("tile bg success"),T(e),A.ProgressBar.hide(".bg-facebook-tiled"),e.success===!0){A.backgrounds.customize_type="Facebook collage";var t={image:e.new_background_image[1],thumb:e.new_background_image[0],dims:{width:e.width,height:e.height}};A.backgrounds.saved.update(t);var t={type:"center",image:e.new_background_image[1],dims:{width:e.width,height:e.height}};A.backgrounds.set(t)}else if(e.error)switch(e.error){case"NoFacebookImagesFound":s.banner("We couldn&rsquo;t find any Facebook photos.",{status:"warning"})}},error:function(e){T("tile bg error"),T(e),A.ProgressBar.hide(".bg-facebook-tiled"),s.banner("There was an issue creating your background. Please try again later.",{status:"error"})}},t={service:"facebook"};r.post("create_tile_image",t,e)}},Instagram:{init:function(){if(A.backgrounds.Instagram.templateAvailable(),$("#bg-instagram-tile").on("click",A.backgrounds.Instagram.tileButton),0==$("#bg-instagram").find(".section").size()&&$("#bg-instagram .no-content").show(),$("#bg-add-instagram").on("click",function(){x.open(),a.ready("appmodal_loaded",function(){$("#addapp-carousel .instagram").first().click()})}),A.has_instagram&&A.instagram_backgrounds.length<1){var e=0;$.doTimeout("load-ig-images",300,function(){if(10==e)return!1;if(A.instagram_backgrounds.length<1){var t={success:function(e){$("#bg-instagram .no-content").hide(),$(".bg-instagram-added,#bg_instagram_thumbs").show();var t=[];A.instagram_backgrounds=jQuery.parseJSON(e.profile_data),$.each(A.instagram_backgrounds,function(e,i){t.push([i.thumbnail,i.big_image])}),A.backgrounds.carousel.single.bgInstagram={items:t,items_num:12,items_class:"theme_background",rows_num:2,type:"multiRow",items_height:85,nav_type:"bar",wrap:!1},$("#bg_instagram_thumbs").meCarousel(A.backgrounds.carousel.single.bgInstagram)},error:function(e){T(e)}},i={data_field:"instagram_media"};return r.post("get_user_profile_data",i,t),!1}return e++,!0})}},templateAvailable:function(){$(".bg-instagram-layouts span").on("click",A.backgrounds.Instagram.setTemplate),612!=f.Settings.images.background_width&&A.backgrounds.Instagram.disableTemplates()},enableTemplates:function(){$(".bg-instagram-layouts span").on("click",A.backgrounds.Instagram.setTemplate),$(".bg-instagram-layouts span").removeClass("inactive")},disableTemplates:function(){$(".bg-instagram-layouts span").addClass("inactive").removeClass("active"),$(".bg-instagram-layouts span").off("click")},setTemplate:function(){if(612==f.Settings.images.background_width){var e=($("div.profile"),$(this).attr("data-value"));A.backgrounds.unsetPositions(),$(this).addClass("active");var t=32;"instagram-left"===e&&(t=-600);var i={type:e,pos:{x:t,y:100}};T(e),a.trigger("resize"),A.backgrounds.set(i)}},tileButton:function(){A.ProgressBar.init(".bg-instagram-tiled",{width:"360px",left:"50%",marginLeft:"-180px",position:"absolute",top:"50%",marginTop:"-26px"},"Creating your background (this may take several minutes)&hellip;");var e={success:function(e){if(T("tile bg success"),T(e),A.ProgressBar.hide(".bg-instagram-tiled"),e.success===!0){A.backgrounds.customize_type="Instagram collage";var t={image:e.new_background_image[1],thumb:e.new_background_image[0],dims:{width:e.width,height:e.height}};A.backgrounds.saved.update(t);var t={type:"center",image:e.new_background_image[1],dims:{width:e.width,height:e.height}};A.backgrounds.set(t)}else if(e.error)switch(e.error){case"NoInstagramImagesFound":s.banner("We couldn&rsquo;t find any Instagram photos.",{status:"warning"})}},error:function(e){T("tile bg error"),T(e),A.ProgressBar.hide(".bg-instagram-tiled"),s.banner("There was an issue creating your background. Please try again later.",{status:"error"})}},t={service:"instagram"};r.post("create_tile_image",t,e)}},Upload:{init:function(){window.FileReader||$("html").addClass("no-filedrag"),Modernizr.draganddrop||$("html").addClass("no-draganddrop");{var e=$("#background_change");e.width(),e.height()}$.browser.msie&&10==$.browser.version&&e.on("mousedown",function(){$("#background_upload").trigger("click")}),$("#bg-upload-target").fileupload({url:"/upload",type:"POST",dataType:"json",dropZone:$("#bg-upload-target"),fileInput:$("#background_upload"),replaceFileInput:!0,paramName:"user_background",maxNumberOfFiles:1,maxFileSize:5e6,acceptFileTypes:"/(.|/)(gif|jpe?g|png)$/i",dragover:function(){$("#bg-upload-target").addClass("active"),$("#bg-upload-target").on("dragleave",function(){$(this).removeClass("active")})},drop:function(){$("#bg-upload-target").addClass("dropped")},send:function(e,t){return t.files.length>1?(s.banner("You may only upload one file at a time.",{status:"warning"}),!1):(A.ProgressBar.init("#bg-upload-target",{width:"300px",left:"50%",marginLeft:"-150px",position:"absolute",top:"50%",marginTop:"-32px"},"Uploading&hellip;"),void $("#bg-upload-target").find(".uploadinghide").hide())},done:A.backgrounds.Upload.complete,fail:function(e,t){T("error:"),T(t.errorThrown),T(t.textStatus),T(t.jqXHR),s.banner("There was a problem with your upload. Please try again later.",{status:"error"})}})},complete:function(e,t){var i=t.result;if($("#bg-upload-target").removeClass("active dropped"),A.ProgressBar.hide("#bg-upload-target"),$("#bg-upload-target .uploadinghide").show(),i.success===!0){A.backgrounds.customize_type="Upload";var a={image:i.pic_location,dims:{width:i.width,height:i.height}};A.backgrounds.set(a);var a={image:i.pic_location,thumb:i.pic_location.replace(/\/background\//,"/thumbnail/")};A.backgrounds.saved.update(a),A.backgrounds.showSuccessBanner()}else T(i),s.banner("A problem occurred with this upload. Please try a different image.",{status:"error"})}},showSuccessBanner:function(){var e={type:"update_photo"},t="http://twitter.com/intent/tweet?text=",a="I've just updated my @aboutdotme page with a new photo! Check it out: "+i.get("page_url");i.get("twitter_name")&&(a=a+" @"+i.get("twitter_name")),t+=encodeURIComponent(a),e.tweet_url=t,i.get("facebook_compliment_share")||(e.facebook_url="http://www.facebook.com/share.php?u="+encodeURIComponent(i.get("page_url")));var n=_.template(S,e),r=s.banner(n,{duration:7e3});o.log("display: update and share",{trigger:"photo"}),r.find(".button.twitter").click(function(){o.log("share: update and share",{target:"twitter"})}),r.find(".button.facebook").click(function(){o.log("share: update and share",{target:"facebook"})})},unsetPositions:function(){$(".bgpositionoptions").find(".button").removeClass("active"),$(".bg-instagram-layouts span").removeClass("active")},positionButtons:function(){var e=$(this);A.backgrounds.set({type:e.attr("data-value")})},saved:{update:function(t){$(".customize-pane .bg_saved_carousel,.customize-pane .bg_saved_carousel + hr").removeClass("invisible");{var i=$(".bg-select .tab.active"),a=$(".bg-select .tab.bg-gallery"),o=$("#bg_saved_thumbs");$("#bg_custom_thumbs")}if(o.find("li").removeClass("active"),$("#bg_saved_thumbs-carousel").jcarousel("scroll",0,!1),t.from)var n=t.from.clone();else{var n='<li style="background:url('+e.STATIC_HOSTNAME+'/images/ajax/ajax-loader-alt2.gif) center 30px no-repeat;">';n+='<a href="#" data-value="'+t.image+'" class="saved_bg theme_background">',n+='<img src="'+t.thumb+'" />',n+="</a>",n+="</li>"}o.prepend(n);var s=o.find("li:eq(0)");s.addClass("active"),s.append('<span class="checkmark" />');var r='<span class="bgthumbaction remove-thumb glyph-close glyph-center" title="Delete this image">&nbsp;</span>';if(s.find(".background-sig").size()<1&&(r+='<a href="'+t.image+'" class="bgthumbaction saved-download glyph-download glyph-center" target="_blank" download title="Download this image"></a>'),s.append(r),s.find(".theme_background").addClass("saved_bg").attr("data-value",t.image),i.hasClass("bg-gallery")){var l=o.width();o.css({width:l+300}),s.css({position:"relative",zIndex:5,marginRight:-120,marginTop:40,backgroundColor:"transparent"}).animate({marginRight:11,marginTop:0},{duration:600,easing:"easeOutBounce",complete:function(){$(this).css({position:"inherit",zIndex:"inherit"}),A.backgrounds.carousel.single.bgSaved.items.push([t.thumb,t.image]),$("#bg_saved_thumbs-carousel").trigger("refresh")}})}else{$("#bg_saved_thumbs-carousel").trigger("refresh");var c=s.find("img").clone().detach().appendTo("body"),d=a.offset().left,u=a.offset().top;A.backgrounds.carousel.single.bgSaved.items.push([t.thumb,t.image]),c.css({position:"absolute",left:d+50,top:u+50,zIndex:5e3,height:63,width:100}).animate({width:0,height:0,left:d+35,top:u+15},{duration:500,easing:"easeInBack",complete:function(){$(this).remove()}})}},confirmRemove:function(){var e=($(this),$(this).closest("li")),t=function(t){t&&A.backgrounds.saved.removeSavedBg(e)},i={button_labels:["Delete Image","Cancel"],width:400};s.confirm("Are you sure you want to delete this image?",t,i)},removeSavedBg:function(e){var t=e.find("a.saved_bg").attr("data-value");if(!t)return T.error("remove image failed");$(".theme_background .remove-thumb").addClass("inactive"),e.fadeOut(200,function(){$(this).hasClass("active")&&A.backgrounds.set({image:"no-background"},!0),$(this).remove(),$("#bg_saved_thumbs li").size()<1?$(".customize-pane .bg_saved_carousel,.customize-pane .bg_saved_carousel + hr").addClass("invisible"):$("#bg_saved_thumbs-carousel").trigger("refresh",[!1])});var i={bg_url:t},a={success:function(e){T("success: "),T(e),$(".theme_background .remove-thumb").removeClass("inactive")},error:function(e){T("error: "),T(e)}};r.post("delete_background",i,a)}}},A.biography={init:function(){A.biography.BioEditor.init(),A.biography.Jobs.init(),A.biography.Educations.init(),A.biography.Locations.init(),A.biography.Tags.init(),A.biography.Avatar.init(),A.biography.savers(),AboutMe.on("viewport:not:small",function(){var e=$("#customize-pane-biography"),t=$(".profile h2.headline");A.updatecache("first_name",f.Settings.first_name),A.updatecache("last_name",f.Settings.last_name),A.updatecache("header_text_input",$(".profile h2.headline").text()),A.updatecache("work",JSON.stringify(f.Settings.work)),A.updatecache("education",JSON.stringify(f.Settings.education)),A.updatecache("locations",JSON.stringify(f.Settings.locations)),A.updatecache("tags",JSON.stringify(f.Settings.tags)),e.find("input.firstname").val(f.Settings.first_name),e.find("input.lastname").val(f.Settings.last_name),e.find("input.headline").val(t.text()),A.biography.Jobs.init(),A.biography.Educations.init(),A.biography.Locations.init(),A.biography.Tags.init(),e.find("fieldset.name .display .firstname").text(f.Settings.first_name),e.find("fieldset.name .display .lastname").text(f.Settings.last_name),e.find("fieldset.headline .display").text(t.text())})},savers:function(){var e=$("#customize-pane-biography");$("#first_name, #last_name").each(function(){A.updatecache(this.id,$(this).val())}),A.updatecache("profile_text_content",$("#bio_input_container").val()),A.cacheUserSettings(f.Settings),e.find("input.firstname, input.lastname, input.headline").on("keyup change",function(){A.save($(this).data("key"),$(this).val())}),e.find("input.firstname").on("keyup change",function(){e.find("fieldset.name .display .firstname").text($(this).val()),A.updateName()}),e.find("input.lastname").on("keyup change",function(){e.find("fieldset.name .display .lastname").text($(this).val()),A.updateName()}),e.find("input.headline").on("keyup change",function(){var t=$(this).val();$(".profile div.profile-head h2.headline").text(t),e.find("fieldset.headline .display").text(t),a.trigger("biobox_changed")})},BioEditor:{init:function(){$(".customize fieldset.bio .display a").on("click",function(e){e.preventDefault()}),require(["/js/ckeditor/ckeditor.js"],function(){A.biography.BioEditor.loadEditor()})},loadEditor:function(){A.biography.BioEditor.instance=CKEDITOR.replace("bio_input_container",{customConfig:"",removePlugins:"elementspath,styles,scayt,menubutton,contextmenu",extraPlugins:"onchange",entities:!1,resize_enabled:!1,skin:"aboutme",language:"en",keystrokes:[],toolbarCanCollapse:!1,toolbar:"Basic",toolbar_Basic:[["Bold","Italic","Underline","-","NumberedList","BulletedList","-","Link","Unlink"]],autoGrow_maxHeight:400,forcePasteAsPlainText:!0,startupFocus:!0},$("#bio_input_container").text()),AboutMe.on("viewport:not:small",function(){var e=$(".profile div.bio");A.updatecache("profile_text_content",e.html()),$("#bio_input_container").text(e.html()),$(".customize fieldset.bio .display").html(e.html())}),A.biography.BioEditor.instance.on("instanceReady",function(){$(".character-count").appendTo($(".bio .field"))}),A.biography.BioEditor.instance.on("change",function(){A.biography.BioEditor.update()}),A.biography.BioEditor.instance.on("dialogShow",function(){var e=CKEDITOR.dialog.getCurrent(),t=e.getContentElement("info","url"),i=t._.inputId,a=$("#"+i);a.focus()}),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name,i=e.data.definition;if("link"==t){i.title="Add or Edit Link",i.removeContents("target"),i.removeContents("advanced");var a=i.getContents("info");a.remove("linkType")}})},focus:function(){A.biography.BioEditor.instance.focus()},update:function(){var e=A.biography.BioEditor.instance.getData();if(void 0!==e){var t=$(".profile div.bio");e=A.biography.BioEditor.checkMarkup(e),e.length?t.removeClass("invisible"):t.addClass("invisible"),e.length>2500?$(".customize fieldset.bio .character-count").addClass("error").html(e.length+" characters, exceeded 2500 character maximum. Bio text will be truncated."):$(".customize fieldset.bio .character-count").removeClass("error").html(e.length+" characters including formatting"),t.html(e),t.find("a").css("color","#"+f.Settings.colors.links_color),$(".customize fieldset.bio .display").html(e).find("a").on("click",function(e){e.preventDefault()}),A.save("profile_text_content",e),a.trigger("bio_changed"),a.trigger("biobox_changed")}},checkMarkup:function(e){e=e?String(e):"";var t=function(t,i){e=e.replace(new RegExp(t,"gim"),i)};t("<(/?)div([^>]*)>","<$1p$2>"),t("<(ul|ol)","</p><$1"),t("</(ul|ol)>","</$1><p>"),e="<p>"+e+"</p>",e=$("<div />").html(e).html();var i="p|li|ul|ol";return t("<br */?></("+i+")>","</$1>"),t("&nbsp;</("+i+")>","</$1>"),t("<p[^>]*></p>",""),t("<li[^>]*></li>",""),t("<ul[^>]*></ul>",""),t("<ol[^>]*></ol>",""),t("&nbsp;"," "),t("<a href=([^>]*)>",'<a href=$1 target="_blank">'),t('<a href=("mailto:[^>]*) target="_blank"',"<a href=$1"),e}},Jobs:{init:function(){$("fieldset.jobs .tokenbox").tokenbox("destroy"),$("fieldset.jobs .tokenbox").tokenbox($.extend(u.configs.jobs,{onchange:function(){var e=this;$.doTimeout("Customize.biography.Jobs.update",100,function(){A.biography.Jobs.update(e)})},items:f.Settings.work,typeahead:{corpus:"work"}}))},update:function(t){if(t){var i=t.getTokens(),o=$(".profile ul.jobs");o.find("li").remove();for(var n in i){var s=i[n],r=$("<li></li>");r.html('<a href="'+e.DOMAIN_NAME_URL+"/search/org:"+encodeURIComponent(s)+'"></a>'),r.find("a").text(s),o.append(r)}f.Settings.work=i,A.save("work",JSON.stringify(i)),a.trigger("biobox_changed")}}},Educations:{init:function(){$("fieldset.educations .tokenbox").tokenbox("destroy"),$("fieldset.educations .tokenbox").tokenbox($.extend(u.configs.educations,{onchange:function(){var e=this;$.doTimeout("Customize.biography.Educations.update",100,function(){A.biography.Educations.update(e)})},items:f.Settings.education,typeahead:{corpus:"education"}}))},update:function(t){if(t){var i=t.getTokens(),o=$(".profile ul.educations");o.find("li").remove();for(var n in i){var s=i[n],r=$("<li></li>");r.html('<a href="'+e.DOMAIN_NAME_URL+"/search/org:"+encodeURIComponent(s)+'"></a>'),r.find("a").text(s),o.append(r)}f.Settings.education=i,A.save("education",JSON.stringify(i)),a.trigger("biobox_changed")}}},Locations:{init:function(){$.trim(f.Settings.location)&&0==f.Settings.locations.length&&T.error("legacy user with a string location"),$("fieldset.locations .tokenbox").tokenbox("destroy"),$("fieldset.locations .tokenbox").tokenbox($.extend(u.configs.locations,{onchange:function(){var e=this;$.doTimeout("Customize.biography.Locations.update",100,function(){A.biography.Locations.update(e)})},items:f.Settings.locations,typeahead:{corpus:"locations"}}))},update:function(t){if(t){var i=t.getTokens(),o=$(".profile ul.locations");o.find("li").remove();for(var n in i){var s=i[n],r=$("<li></li>");r.html('<a href="'+e.DOMAIN_NAME_URL+"/search/place:"+encodeURIComponent(s)+'"></a>'),r.find("a").text(s),o.append(r)}f.Settings.locations=i,A.save("locations",JSON.stringify(i)),a.trigger("contactinfo_changed")}}},Tags:{init:function(){$("fieldset.tags .tokenbox").tokenbox("destroy"),$("fieldset.tags .tokenbox").tokenbox($.extend(u.configs.tags,{onchange:function(){var e=this;$.doTimeout("Customize.biography.Tags.update",100,function(){A.biography.Tags.update(e)})},items:f.Settings.tags,typeahead:{corpus:"tags"}})),$("fieldset.tags #tags_visible").change(function(){var e=$(this).is(":checked");f.Settings.tags_visible=e,A.save(this.id,e),a.trigger("biobox_changed")})},update:function(t){if(t){var i=t.getTokens(),o=$(".profile ul.tags");o.find("li").remove();for(var n in i){var s=i[n],r=$("<li></li>");r.html('<a href="'+e.DOMAIN_NAME_URL+"/search/keyword:"+encodeURIComponent(s)+'"></a>'),r.find("a").text(s),o.append(r)}f.Settings.tags=i,A.save("tags",JSON.stringify(i)),a.trigger("biobox_changed")}}},Avatar:{init:function(){$(".customize").on("click","#no-profile-image",function(e){e.preventDefault(),f.Settings.images.profile_image="",f.Settings.images.avatar_image="",$(this).closest(".no-profile-image").remove(),A.save("profile_image","no-profile-image"),a.trigger("avatar_changed")}),A.biography.Avatar.picUpload.init()},picUpload:{init:function(){{var e=$("#upload_avatar");e.width()}$.browser.msie&&10==$.browser.version&&e.on("mousedown",function(){$("#pic_upload").trigger("click")}),$("#upload_avatar").fileupload({url:"/upload",type:"POST",dataType:"json",dropZone:$("#upload_avatar"),fileInput:$("#pic_upload"),replaceFileInput:!0,paramName:"user_profile",maxNumberOfFiles:1,maxFileSize:5e6,acceptFileTypes:"/(.|/)(gif|jpe?g|png)$/i",send:function(e,t){return t.files.length>1?(s.banner("You may only upload one file at a time.",{status:"warning"}),!1):(A.ProgressBar.init(".pic-upload .field",{width:$("#upload_avatar").width()+"px",position:"absolute",left:"0px",top:"-3px"}),void $(".pic-upload").find(".uploadinghide").hide())},done:A.biography.Avatar.picUpload.uploadComplete,fail:function(e,t){T("error:"),T(t.errorThrown),T(t.textStatus),T(t.jqXHR),s.banner("There was a problem with your upload. Please try again later.",{status:"error"})}})},uploadComplete:function(e,t){var i=t.result;A.ProgressBar.hide(".pic-upload .field"),$(".pic-upload .uploadinghide").show(),i.success===!0?(T(i),f.Settings.images.profile_image=i.pic_location,f.Settings.images.avatar_image=i.avatar_location,$(".no-profile-image").remove(),$.doTimeout("show-remove-avatar",2e3,function(){var e='<div class="no-profile-image"><span id="no-profile-image">Remove</span></div>';$("#upload_avatar").after(e)}),A.save("profile_image",i.pic_trailer),a.trigger("avatar_changed")):i.error?$("#upload_status").html(i.error).css("color","red"):(T(i),s.banner("A problem occurred with this upload. Please try a different image.",{status:"error"}))}}}},A.colors={init:function(){A.colors.Colors.init(),A.colors.Patterns.init()},Colors:{init:function(){A.colors.Colors.maxSavedColors=12,A.colors.Colors.setupColorPickers(),$(".colorwell").on("click.colorpickeropen",A.colors.Colors.openColorPicker),$("body").on("click",A.colors.Colors.closeColorPickers),A.colors.Colors.bioShadow(),A.colors.Colors.sliders()},bioShadow:function(){$("#profile_shadow").on("click change",function(){var e=$(this).is(":checked");e?$("div.profile").addClass("profileshadow"):$("div.profile").removeClass("profileshadow"),f.Settings.colors.profile_shadow=e,A.save("profile_shadow",e),a.trigger("biobox_shadow_changed")})},setupColorPickers:function(){A.colors.Colors.canvas=!1,$(".colorwell").each(function(){var e=$(this),t=e.closest(".colorwrap"),i=t.find(".picker"),a=e.attr("data-colorkey"),o=f.Settings.colors[a];if(i.size()<1){t.prepend('<div class="pickerhead" />'),t.append('<div class="picker" />'),i=t.find(".picker");var n='<div class="colorselect"><h5 class="suggestedlabel">Suggested</h5><ul class="colorssuggested clearfix"></ul><h5>Recent</h5><ul class="colorssaved clearfix"></ul></div>';i.append(n);var s='<span class="eyedropper button xsmall dark gray glyph-target glyph-center" title="Choose a color from your background image">&nbsp;</span><div class="eyedroppercanvas"></div>';i.append(s)}i.ColorPicker({flat:!0,eventName:"click",color:o,onChange:function(t,i,a){A.colors.Colors.updateColor(e,i,a)}}),i.ColorPickerSetColor(o),i.on("click",function(e){e.stopPropagation()})});var e=$(".colorssaved"),t=[],i=$(".colorssuggested");if(A.colors.Colors.popSaved(e),i.hide(),$(".eyedropper").hide(),i.prev(".suggestedlabel").hide(),Modernizr.canvas&&f.Settings.images.background_image&&"no-background"!=f.Settings.images.background_image){var a=$(".mobile-bg-test-img");a.length||(a=$('<img class="mobile-bg-test-img" />'),$(".mobile-background-container").append(a)),a.get(0).crossOrigin="",a.bind("load readystatechange",function(){t=d.createPalette(a.get(0),6),"error"!=t||t.length<1?(A.colors.Colors.canvas=!0,f.Settings.colors.suggested_colors=t,A.colors.Colors.popSuggested(i),i.show().prev(".suggestedlabel").show()):(i.hide(),i.prev(".suggestedlabel").hide(),$(".eyedropper").hide(),A.colors.Colors.canvas=!1)}),a.get(0).src=f.Settings.images.background_image.replace("http://d13pix9kaak6wt.cloudfront.net/background/","http://s3.amazonaws.com/aboutme-images-1/background/")+"?cache_busters="+(new Date).getTime()}else i.hide(),i.prev(".suggestedlabel").hide(),$(".eyedropper").hide(),A.colors.Colors.canvas=!1},openColorPicker:function(e){e.stopPropagation();{var t=$(this),i=t.closest(".colorwrap"),a=i.find(".picker"),o=(a.find(".eyedroppercanvas"),a.find(".eyedropper")),n=t.attr("data-colorkey");f.Settings.colors[n]}i.hasClass("colorpickeropen")?A.colors.Colors.closeColorPickers():(A.colors.Colors.closeColorPickers(),i.addClass("colorpickeropen")),A.colors.Colors.canvas&&(o.show(),o.off("click.openeyedropper"),o.on("click.openeyedropper",function(){var e=$(this).closest(".colorwrap"),t=e.find(".picker"),i=e.find(".colorwell"),a=t.find(".eyedroppercanvas"),o=(t.find(".eyedropper"),i.attr("data-colorkey")),n=f.Settings.colors[o];if($(this).hasClass("active"))$(this).removeClass("active"),t.ColorPickerSetColor(n),A.colors.Colors.updateColor(i,n),a.hide();else{a.show(),$(this).addClass("active"),a.find("img.eyedropperreference").remove();var s=$('<img class="eyedropperreference" />');s.get(0).crossOrigin="",s.get(0).src=f.Settings.images.background_image.replace("http://d13pix9kaak6wt.cloudfront.net/background/","http://s3.amazonaws.com/aboutme-images-1/background/")+"?cache_busters="+(new Date).getTime();{var r=f.Settings.colors[o];s.dropper({mouseOutCallback:function(){t.ColorPickerSetColor(r),A.colors.Colors.updateColor(i,r),$.doTimeout("droppertimeout2",3500,function(){t.find(".eyedropper").removeClass("active"),t.data("eyedropperopened",!1),a.hide(),s.trigger("destroy.eyedropper")})},mouseMoveCallback:function(e){t.ColorPickerSetColor(e.rgbhex),A.colors.Colors.updateColor(i,e.rgbhex),$.doTimeout("droppertimeout2")},clickCallback:function(e){t.ColorPickerSetColor(e.rgbhex),t.find(".eyedropper").removeClass("active"),a.hide(),t.data("eyedropperopened",!1),s.trigger("destroy.eyedropper"),A.colors.Colors.updateColor(i,e.rgbhex)}})}a.append(s)}}))},popSaved:function(e){e.empty(),$.each(f.Settings.colors.saved_colors,function(t,i){e.append('<li data-color="'+i+'" style="background-color:#'+i+';"></li>')}),e.show(),e.find("li").on("click.selectcolor",function(){var e=$(this).closest(".colorwrap").find(".picker"),t=$(this).closest(".colorwrap").find(".colorwell"),i=$(this).attr("data-color");e.ColorPickerSetColor(i),A.colors.Colors.updateColor(t,i)})},popSuggested:function(e){f.Settings.colors.suggested_colors.length>0?(e.empty().show(),$.each(f.Settings.colors.suggested_colors,function(t,i){var a=c.getHexTriplet([i[0],i[1],i[2]]);e.append('<li data-color="'+a+'" style="background-color:#'+a+';"></li>')}),e.find("li").on("click.selectcolor",function(){var e=$(this).closest(".colorwrap").find(".picker"),t=$(this).closest(".colorwrap").find(".colorwell"),i=$(this).attr("data-color");e.ColorPickerSetColor(i),A.colors.Colors.updateColor(t,i)})):(e.hide(),e.prev(".suggestedlabel").hide())},closeColorPickers:function(){$(".colorwrap").each(function(){if($(this).hasClass("colorpickeropen")){{var e=$(this).find(".colorwell"),t=$(this).find(".colorpicker_hex input").val();$(this).find(".picker")}$(this).removeClass("colorpickeropen"),$(this).find(".eyedropper").removeClass("active"),$(this).find(".eyedroppercanvas").hide(),$(this).find("img.eyedropperreference").trigger("destroy.eyedropper"),A.colors.Colors.saveColor(e,t)}})},saveColor:function(e,t){var i=e.attr("data-colorkey");f.Settings.colors.saved_colors.unshift(t);var a=[];$.each(f.Settings.colors.saved_colors,function(e,t){return a.length==A.colors.Colors.maxSavedColors?!1:void($.inArray(t,a)<0&&a.push(t))}),f.Settings.colors.saved_colors=a,A.colors.Colors.popSaved($(".colorssaved")),A.save({saved_colors:JSON.stringify(f.Settings.colors.saved_colors)}),A.save(i,t)},updateColor:function(e,t,i){var o=e.attr("data-colorkey");switch(f.Settings.colors[o]=t,$("#colorwell_"+o).css("background-color","#"+t),o){case"background_color":$("body").css("background-color","#"+t),$(".pattern_thumb").css("background-color","#"+t);break;case"profile_color":if(i)var n=[i.r,i.g,i.b];else var n=c.getDecimalTriplet(t);a.trigger("biobox_color_changed",[n]);break;case"heading_color":$(".profile div.profile-head h2.headline").css("color","#"+t),$(".profile div.services h3").css("color","#"+t);break;case"bio_color":$(".profile div.bio, .profile .meta ul.list, .profile ul.phone.list li").css("color","#"+t),$(".profile div.rsswrapper h4, .profile ul.feeds .source").css("color","#"+t);break;case"name_color":$(".profile div.profile-head h1.name").css("color","#"+t);break;case"links_color":$(".profile ul.links a, .profile div.bio a, .profile .meta ul.list a, .profile ul.feeds a, .profile .contactinfo .menu-toggle").css("color","#"+t)}$.doTimeout("savecolor-"+o,1500,function(){var e=$("#colorwell_"+o),t=e.closest(".colorwrap").find(".colorpicker_hex input").val();A.colors.Colors.saveColor(e,t)})},sliders:function(){var e=1,t=$("html").hasClass("rgba");if(!t){e=100,$(".bioboxopacityslider").empty(),$(".profile_shadow_wrap").hide();var i='<span class="buttonbar opacity-buttons">';i+='<span class="button small opacity-off">Off</span>',i+='<span class="button small opacity-on">On</span>',i+="</span>",$(".bioboxopacityslider").append(i),f.Settings.colors.profile_opacity<=30?(f.Settings.colors.profile_opacity=0,$(".opacity-buttons .opacity-off").addClass("active")):f.Settings.colors.profile_opacity>30&&(f.Settings.colors.profile_opacity=100,$(".opacity-buttons .opacity-on").addClass("active")),$(".opacity-buttons").find(".button").on("click",function(){f.Settings.colors.profile_opacity=$(this).hasClass("opacity-off")?0:100,$(this).addClass("active").siblings().removeClass("active"),A.save("profile_opacity",f.Settings.colors.profile_opacity),a.trigger("biobox_color_changed")})}$("#profile_opacity").change(function(){var e=$(this).val();e=""!=e&&e>=0&&100>=e?Math.round(e):100,$(this).val(e),f.Settings.colors.profile_opacity=e,!t&&f.Settings.colors.profile_opacity<=30?f.Settings.colors.profile_opacity=0:!t&&f.Settings.colors.profile_opacity>30&&(f.Settings.colors.profile_opacity=100),t&&$("#bio_background_color_slider").slider("value",f.Settings.colors.profile_opacity)}),t&&$("#bio_background_color_slider").slider({range:"min",value:f.Settings.colors.profile_opacity,min:0,max:100,paddingMin:3,paddingMax:3,step:e,slide:function(e,t){$("#profile_opacity").text(t.value),f.Settings.colors.profile_opacity=t.value,a.trigger("biobox_color_changed")},change:function(e,t){A.save("profile_opacity",t.value)}})}},Patterns:{init:function(){A.colors.Patterns.setcarousels(),$(".pattern_thumb").each(function(){$.browser.msie&&$.browser.version<9&&(f.Settings.colors.pattern_opacity=100,A.save("pattern_opacity",f.Settings.colors.pattern_opacity)),$(this).css("background-color","#"+f.Settings.colors.background_color),$(this).find(".bg-thumb").css("opacity",f.Settings.colors.pattern_opacity/100)}),$("#pattern_slider").slider({range:"min",value:f.Settings.colors.pattern_opacity,min:0,max:100,paddingMin:3,paddingMax:3,step:1,slide:function(e,t){$(".background-pattern").css("opacity",t.value/100),$(".pattern_thumb").find(".bg-thumb").css("opacity",t.value/100),f.Settings.colors.pattern_opacity=t.value,$("#pattern_opacity").text(t.value)},change:function(e,t){A.save("pattern_opacity",t.value)}}),$(".pattern_thumb").on("click",A.colors.Patterns.select)},setcarousels:function(){var t=[];$.each(A.colors.Patterns.background_patterns,function(i,a){t.push({thumb_image:e.STATIC_HOSTNAME+"/images/patterns/"+a+".png",pattern_name:a})}),A.backgrounds.carousel.single.bgPatterns={items:t,items_num:3,items_class:"pattern_thumb",type:"photo",background:!0,items_height:66,nav_type:"bar",maxBarButtons:3,wrap:!1,active:e.STATIC_HOSTNAME+"/images/patterns/"+f.Settings.colors.pattern+".png"},$("#background_patterns").meCarousel(A.backgrounds.carousel.single.bgPatterns)
},select:function(){var t=$(this).data("pattern-name"),i=e.STATIC_HOSTNAME+"/images/patterns/"+t+".png";$(this).hasClass("active")?($(this).removeClass("active"),$(".background-pattern").css("background-image","none"),A.save("background_pattern","no-pattern")):($(this).addClass("active").siblings().removeClass("active"),$(".background-pattern").css("background-image","url("+i+")").css("opacity",f.Settings.colors.pattern_opacity/100),A.save("background_pattern",t))},background_patterns:["gridme","lined_paper","kuji","foggy_birds","struckaxiom","double_lined","diagonal_striped_brick","worn_dots","graphy","grilled","diagonal-noise","silver_scales","connect","plaid","pineapplecut","white_brick_wall","xv","foil","circles","ravenna","merely_cubed","wavecut","bgnoise_lg","elegant_grid","batthern","hexellence","vichy","diamonds","grunge_wall","light_honeycomb","light_checkered_tiles","soft_pad","leather_1","light_grey_floral_motif","littleknobs","paven","washi","gold_scale","knitted-netting","green_gobbler","wood_pattern_trans","brushed_alu_dark","irongrip","random_grey_variations","always_grey","carbon_fibre","crossed_stripes","inflicted","starring","darkdenim3","rubber_grip","classy_fabric","dark_circles","px_by_Gre3g","woven","vertical_cloth","squares","micro_carbon","dark_wood","flowers","dark_brick_wall","nami","black_thread","hixs_pattern_evolution","dark_mosaic","diagmonds","gun_metal","checkered_pattern","argyle","real_cf","wild_oliva","dark_leather","black_scales","crissXcross","pinstriped_suit"]}},A.fonts={init:function(){$(".fontselect select").on("change",A.fonts.changeFont),A.fonts.setupSliders()},restyleMenus:function(){var e="";e+='<div class="menu light fontmenu">',e+='<div class="menu-head menu-toggle"><span class="button light glyph-triangle-down glyph-center">&nbsp;</span></div>',e+='<ul class="menu-content"></ul>',e+="</div>";var t=$(".fontselect select");t.each(function(){var t=$(this).hide(),i=$(e).menu({forcewidth:!1});t.after(i);var a=t.find("option");a.each(function(){var e=$(this),t=$('<li class="item"><span></span></li>'),a=e.val();t.data("value",a),a=a.replace(/,/," "),t.data("class",a),t.find("span").text(e.text()).addClass(a),i.find("ul.menu-content").append(t),e.attr("selected")&&(t.addClass("glyph-check"),i.find(".menu-head").attr("class","menu-head menu-toggle").addClass(a))}),i.find("ul.menu-content").on("click","li.item",function(e){var a=$(this),o=a.data("value"),n=a.data("class");t.val(o),t.trigger("change"),i.find(".menu-head").attr("class","menu-head menu-toggle").addClass(n),a.hasClass("glyph-check")?i.data("menu")&&i.data("menu").hide():(e.stopPropagation(),i.find("li.item.glyph-check").removeClass("glyph-check"),a.addClass("glyph-check"))})})},setupSliders:function(){var e=$(".fontselect .font-slider");e.each(function(){var e=$(this),t=parseInt(e.next(".font-size").text());e.slider({range:"min",value:t,paddingMin:3,paddingMax:3,min:$(this).hasClass("big")?14:10,max:$(this).hasClass("big")?150:24,start:function(){$.doTimeout("save-font-sizes")},slide:A.fonts.changeSize,change:A.fonts.save})})},toSave:[],save:function(e,t){var i=$(this),o=i.closest(".fontselect").find("select").attr("id")+"_size",n=parseInt(t.value);A.fonts.toSave.push({property:o,size:n}),$.doTimeout("save-font-sizes",2e3,function(){$.each(A.fonts.toSave,function(e,t){A.Saver.save(t.property,t.size,{delay:0})})}),a.trigger("biobox_changed")},changeSize:function(e,t){var i=$(this),o=i.closest(".fontselect").find("select").attr("id")+"_size",n=t.value;switch(i.next(".font-size").text(n),o){case"font_name_size":$(".profile div.profile-head h1.name").css({"font-size":n+"px"}),a.trigger("name_changed");break;case"font_heading_size":$(".profile div.profile-head h2.headline").css({"font-size":n+"px"}),a.trigger("headline_changed");break;case"font_bio_size":var s=Math.round(.3*n);$(".profile div.bio").css({"font-size":n+"px"}),$(".profile div.profile_photo").css({"padding-top":s+"px"}),a.trigger("bio_changed");break;case"font_findme_size":$(".profile ul.links").css({"font-size":n+"px"}),a.trigger("links_changed")}f.Settings.fonts[o]=n,a.trigger("biobox_changed")},changeFont:function(){var e=$(this),t=e.attr("id"),i=e.val();if(f.Settings.fonts[t]!=i){f.Settings.fonts[t]=i;var o={font_kit:f.Settings.fonts.font_kit,items:[[t,i]]},n=I.fontLoad(o,!0),s=n?"inherit":"hidden";switch($(I.selectors[t]).css({"font-family":i+',"proxima-nova-1","proxima-nova-2",Tahoma,Helvetica,Verdana,sans-serif',visibility:s}),t){case"font_name":a.trigger("name_changed");break;case"font_heading":a.trigger("headline_changed");break;case"font_bio_size":a.trigger("bio_changed");break;case"font_findme":a.trigger("links_changed")}var l={success:function(){a.trigger("biobox_changed"),A.Notifier.show()}},c={font_input:t.replace(/font_/,""),type:i};r.post("font_generate",c,l)}}},A.apps={init:function(){$("#customize-pane-apps ul.servicelist").on("click",".servicedeletebutton",A.confirmDelete),$("#customize-pane-apps ul.servicelist").on("click",".serviceeditbutton",R.init),A.sortableList("#customize-pane-apps"),$('#customize-pane-apps ul.servicelist li[data-platform^="facebook"]').each(function(){$(this).children().hasClass("expired")&&$(this).find(".service-name").css({width:"180px","text-overflow":"ellipsis"})})},sortCursor:function(){var e="ns-resize";return $.browser.msie&&parseInt($.browser.version)<9&&(e="n-resize"),e},onSort:function(){var e=[],t=[],i=[];$("ul.servicelist.sortablelist li").each(function(){var t=parseInt(this.id.replace(/serviceid-/,""));$("#service-icons-setup li.site_"+t).detach().appendTo("#service-icons-setup"),$(".services_modal .ui-dialog-titlebar ul.tabheader li.site_"+t).detach().appendTo(".services_modal .ui-dialog-titlebar ul.tabheader"),e.push(t)}),$(".profile ul.services li.addbutton").detach().appendTo(".profile ul.services"),$("ul.linklist.sortablelist li").each(function(){var e=parseInt(this.id.replace(/serviceid-/,""));$(".profile ul.links li.site_"+e).detach().appendTo(".profile ul.links"),t.push(e)}),i.push(e),i.push(t),A.save("service_display_order",JSON.stringify(i)),a.trigger("apporder_changed")},checkLists:function(){$("ul.servicelinklist").each(function(){$(this).children().length<2&&($(this).data("sortable")&&$(this).sortable("disable"),$(this).children("li, .service-name, .icon").css("cursor","auto"))})},deleteService:function(e,t){var i={success:function(){A.apps.needPassword&&(window.location="/account/#!/changepassword");var i=function(){A.apps.deleteSuccess(e,t)};if(setTimeout(i,200),$.inArray(t.platform,["twitter","instagram","linkedin","tumblr","px500"])>-1){if("tumblr"!=t.platform&&$("#spotlight_banner").length){var o=$("#spotlight_banner a").attr("class").split(" ")[1];o.toLowerCase().indexOf(t.platform)>=0&&($("#spotlight_banner").remove(),$(".nav.accountlinks li.update_spotlight a").html("Create Spotlight"),$(".nav.accountlinks li.update_spotlight").addClass("create_spotlight").removeClass("update_spotlight"))}$(".followbuttons li.follow_"+t.platform).remove(),$(".followbuttons-config li.follow_"+t.platform).remove(),0==$(".followbuttons-config li").length&&$(".followbuttons-config").addClass("invisible"),a.trigger("follow_app_deleted",[t.platform]),a.trigger("followbuttons_changed")}e.parent().hasClass("rsslist")&&A.links.AddRss.refreshFeed("delete"),e.parent().hasClass("linklist sortablelist")&&$.doTimeout(700,function(){A.links.Add.showhide()})},error:function(){A.apps.deleteError(e,t)}};r.post("delete_service",t,i)},deleteSuccess:function(e,t){e.animate({height:0,opacity:0},"normal",function(){e.remove(),A.apps.checkLists()});var i=t.platform;i||(i="urlrss"),$("#service-icons-setup li.site_"+t.site_id).remove(),$(".profile ul.links li.site_"+t.site_id).remove(),$(".profile .mobile-links .flat-links").find("li[data-id="+t.site_id+"]").remove(),$(".services_modal .ui-dialog-titlebar ul.tabheader li.site_"+t.site_id).remove(),a.trigger("apporder_changed"),a.trigger("reenable_app_addappmodal",[t.platform]),$(".bg-select").find(".tab.bg-gallery").click(),$("#bg-"+i).find(".section,hr").remove(),$("#bg-"+i).find(".no-content").show(),e.parent().hasClass("linklist")&&e.parent().find("li").length<2&&$("#customize-pane-apps .linklist-header").animate({height:0,opacity:0},"normal"),$(".servicelinklist li").length<2&&$("#customize-pane-apps .pane-header").after('<p class="no-content">You haven&rsquo;t added any apps. <a href="#addservice" class="addservicebutton stats-notrack">Add an app</a></p>'),a.trigger("biobox_changed")},deleteError:function(e,t){var i="An error occurred when trying to delete this service.";t.platform||(i="An error occurred when trying to delete this link."),s.error(i)}},A.links={init:function(){$("#customize-pane-links ul.linklist").on("click",".servicedeletebutton",A.confirmDelete),A.sortableList("#customize-pane-links"),A.links.Add.init(),A.links.AddRss.init(),A.links.Edit.init(),A.featuredcontent.init()},Add:{init:function(){A.links.Add.pane=$("#addlinkoptions"),A.links.Add.templates=$("#addlinkoptions-templates"),a.on("edit_close",A.links.Add.close),A.links.Add.pane.find("span.addbutton").click(A.links.Add.validateURLInput),A.links.Add.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.Add.validateURLInput)}),A.links.Add.showhide(),AboutMe.whenever("viewport:not:small",function(){A.links.Add.updateList()})},updateList:function(){if(f.Settings.mobile.links&&f.Settings.mobile.links.length){var e=$("ul.servicelinklist.linklist.sortablelist");e.empty(),$.each(f.Settings.mobile.links,function(t,i){if(!e.find("#serviceid-"+i.id).length){var a='<li id="serviceid-'+i.id+'" data-id="'+i.id+'" data-displayname="'+i.displayname+'"><img src="http://d3bt8mhwz74rlp.cloudfront.net/favicon/default.png" class="favicon" /><div class="service-display"><div class="service-controls"><span class="servicedeletebutton button small glyph-center glyph-close" title="Remove this link">&nbsp;</span><span class="serviceeditbutton button small glyph-center glyph-pencil" title="Rename this link">&nbsp;</span></div><div class="service-name"><span class="display_name">'+i.displayname+'</span></div></div><div class="service-edit"><input type="text" class="text input inline" value="'+i.displayname+'" /><span class="button savebutton dark blue">Save</span><span class="button cancelbutton">Cancel</span></div></li>';e.append(a)}}),A.links.Add.showhide()}},close:function(){A.links.Add.pane.find(".alarum").remove(),A.links.Add.pane.find(".urloptions").remove(),A.links.Add.pane.find("input.text").val("")},showhide:function(){var e=$("ul.servicelinklist.linklist.sortablelist");e.children().size()>0?e.removeClass("invisible"):e.addClass("invisible")},validateURLInput:function(){if(A.links.Add.pane.find(".urloptions").is(":visible"))A.links.Add.pane.find(".urloptions").slideToggle("fast",function(){A.links.Add.pane.find(".urloptions").remove(),A.links.Add.validateURLInput()});else{A.links.Add.pane.find("input.text").unbind("keyup"),A.links.Add.pane.find("span.addbutton").unbind("click"),A.links.Add.pane.find(".alarum").remove();var e=A.links.Add.pane.find("input.text").val();l.validURL(e)?(l.checkRegexp(e,/^((http(s?))\:\/\/).*$/i,"")||(e="http://"+e),A.links.Add.templates.find(".pane.loading").clone().hide().appendTo(A.links.Add.pane).slideToggle("fast"),A.links.Add.addURL(e)):(A.links.Add.pane.find("input.text").after('<span class="alarum">This URL is not valid. Please try again.</span>'),A.links.Add.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.Add.validateURLInput)}),A.links.Add.pane.find("span.addbutton").click(A.links.Add.validateURLInput))}},addURL:function(e){A.setCurrentTab("links");var t={success:function(e){1!=e.success?(A.links.Add.pane.find(".pane.loading").hide(),A.links.Add.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.Add.validateURLInput)}),A.links.Add.pane.find("span.addbutton").click(A.links.Add.validateURLInput),s.error(e.msg)):(A.EditClickTrack.links("Links","a link"),window.location.reload(!0))},error:function(){A.links.Add.pane.find(".pane.loading").hide(),A.links.Add.pane.find("input.text").after('<span class="alarum">This URL is not valid. Please try again.</span>'),A.links.Add.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.Add.validateURLInput)}),A.links.Add.pane.find("span.addbutton").click(A.links.Add.validateURLInput)}},i={website:e,platform:"default"};r.post("add_link",i,t)}},Edit:{init:function(){$("ul.linklist").on("click",".serviceeditbutton",function(){var e=$(this).parents("li");A.links.Edit.show(e)}),$("ul.linklist").on("click",".service-edit .cancelbutton",function(){var e=$(this).parents("li");A.links.Edit.cancel(e)}),$("ul.linklist").on("click",".service-edit .savebutton",function(){var e=$(this).parents("li");A.links.Edit.save(e)}),$("ul.linklist").on("keyup",".service-edit input.text",function(e){var t=$(this).parents("li"),i=function(){A.links.Edit.save(t)};l.handleReturnKey(e,i)}),$("ul.linklist").on("focus",".service-edit input.text",function(){var e=$(this),t=e.parents("li");w.listen(t.attr("id"),function(){A.links.Edit.cancel(t)},function(){e.focus()})})},show:function(e){e.find(".service-display").hide(),e.find(".service-edit").show(),e.find(".service-edit input.text")[0].select(),e.find(".service-edit input.text")[0].focus()},cancel:function(e){A.links.Edit.close(e),w.unlisten(e.attr("id"))},save:function(e){var t={site_id:e.attr("data-id"),name:e.find(".service-edit input.text").val()},i={success:function(t){A.links.Edit.saveSuccess(e,t)},error:function(t){A.links.Edit.saveError(e,t)}};A.Notifier.hide(),r.post("rename_url",t,i)},saveSuccess:function(e,t){A.Notifier.show(),e.find("span.display_name").text(t.name),e.attr("data-displayname",l.htmlEncode(t.name)),$(".profile ul.links li.site_"+t.site_id+" a span.displayname").text(t.name),a.trigger("biobox_changed"),A.links.Edit.close(e)},saveError:function(e){A.links.Edit.cancel(e),s.error("An error occurred when trying to save your changes.")},close:function(e){e.find(".service-display").show(),e.find(".service-edit").hide()}},AddRss:{init:function(){A.links.AddRss.pane=$("#addrssoptions"),A.links.AddRss.templates=$("#addrssoptions-templates"),A.links.AddRss.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.AddRss.validateURLInput)}),A.links.AddRss.pane.find("span.addbutton").click(A.links.AddRss.validateURLInput),$("ul.rsslist li").length>0&&A.links.AddRss.checkTimer(),A.links.AddRss.showhide()},checkTimer:function(){var e="",t="";$("ul.rsslist li:last-child")&&(e=$("ul.rsslist li:last-child").attr("data-id"),t=$("ul.rsslist li:last-child").attr("data-displayname"));var i=0,a=0;$.doTimeout("load-rssfeeds",700,function(){if(a++,!(5>i&&5>a))return!1;var o={site_id:e,feed_url:t,platform:"syndication_feed"},n={success:function(e){if(1==e.success){if(e.post_count>0)return i=5,A.links.AddRss.refreshFeed("add"),!1;i++}},error:function(e){T(e.msg),i++}};return r.post("get_recent_posts_count",o,n),!0})},close:function(){A.links.AddRss.pane.find(".alarum").remove(),A.links.AddRss.pane.find(".urloptions").remove(),A.links.AddRss.pane.find("input.text").val("")},showhide:function(){var e=$("ul.rsslist");e.children().size()>0?e.removeClass("invisible"):e.addClass("invisible")},validateURLInput:function(){if(A.links.AddRss.pane.find(".urloptions").is(":visible"))A.links.AddRss.pane.find(".urloptions").slideToggle("fast",function(){A.links.AddRss.pane.find(".urloptions").remove(),A.links.AddRss.validateURLInput()});else{A.links.AddRss.pane.find("input.text").unbind("keyup"),A.links.AddRss.pane.find("span.addbutton").unbind("click"),A.links.AddRss.pane.find(".alarum").remove();var e=A.links.AddRss.pane.find("input.text").val();if(l.validURL(e)){A.links.AddRss.templates.find(".pane.loading").clone().hide().appendTo(A.links.AddRss.pane).slideToggle("fast");var t={success:function(e){1==e.success&&A.links.AddRss.pane.find(".pane.loading").is(":visible")?1==e.feeds.length?A.featuredcontent.Add.checkcontent("rss",e.feeds[0],"syndication_feed"):A.links.AddRss.templates.find(".pane.loading").slideToggle("fast",function(){A.links.AddRss.pane.find(".pane.loading").remove(),A.links.AddRss.showURLOptions(e)}):A.links.AddRss.pane.find(".pane.loading").slideToggle("fast",function(){A.links.AddRss.pane.find(".pane.loading").remove(),A.links.AddRss.showURLOptions(e)})},error:function(e){T(e.error)}},i={website:e,platform:"syndication_feed"};r.post("get_link_choices",i,t)}else A.links.AddRss.pane.find("input.text").after('<span class="alarum">This URL is not valid. Please try again.</span>'),A.links.AddRss.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.AddRss.validateURLInput)}),A.links.AddRss.pane.find("span.addbutton").click(A.links.AddRss.validateURLInput)}},showURLOptions:function(e){A.links.AddRss.templates.find(".urloptions").clone().hide().appendTo(A.links.AddRss.pane);var t="We’re sorry, it appears there isn’t a feed here.<br />Please try a different URL or add it as a link.";if(e.feeds.length>0&&(t="Please choose which feed you’d like to display:"),A.links.AddRss.pane.find(".urloptions h4").html(t),e.feeds.length>0){var i='<li><label for="urloption-0"><input type="radio" class="radio" name="url" id="urloption-0" value="'+e.feeds[0]+'" checked="checked" />';i+='<span class="labeltext">'+e.feeds[0]+"</span></label></li>";for(var a=1;a<e.feeds.length;a++)i+='<li><label for="urloption-'+a+'">',i+='<input type="radio" class="radio" name="url" id="urloption-'+a+'" value="'+e.feeds[a]+'" />',i+='<span class="labeltext">'+e.feeds[a]+"</span>",i+="</label></li>";A.links.AddRss.pane.find(".urloptions ul").html(i)}else if(0==e.feeds.length){var i='<li><label for="urloption-0"><input type="radio" class="radio" name="url" id="urloption-0" value="" checked="checked" />';i+='<span class="labeltext">Add text link</span></label></li>',A.links.AddRss.pane.find(".urloptions ul").html(i)}A.links.AddRss.pane.find(".urloptions .button-submit").click(function(){var t=A.links.AddRss.pane.find("input[name=url]:radio:checked").val(),i="";t?i="syndication_feed":(t=e.website,i="default"),A.links.AddRss.pane.find(".urloptions").empty(),A.links.AddRss.pane.find(".pane.loading").remove(),A.links.AddRss.templates.find(".pane.loading").clone().appendTo(A.links.AddRss.pane).find(".loadingtext").html("Adding…"),A.featuredcontent.Add.checkcontent("rss",t,i)}),A.links.AddRss.pane.find(".urloptions .cancel").click(function(){return A.links.AddRss.close(),!1}),A.links.AddRss.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.AddRss.validateURLInput)}),A.links.AddRss.pane.find("span.addbutton").click(A.links.AddRss.validateURLInput),A.links.AddRss.pane.find(".urloptions").slideToggle("fast")},addRSS:function(e,t){l.checkRegexp(e,/^((http(s?))\:\/\/).*$/i,"")||(e="http://"+e),A.setCurrentTab("links"),A.links.AddRss.pane.find(".pane.loading").remove(),A.links.AddRss.templates.find(".pane.loading").clone().appendTo(A.links.AddRss.pane).find(".loadingtext").html("Adding…"),A.links.AddRss.pane.find(".pane.loading").is(":visible")||A.links.AddRss.pane.find(".pane.loading").slideToggle("fast");var i={success:function(e){1!=e.success?s.error(e.error):("default"!=t&&$("ul.soundcloudlist li,ul.videolist li").each(function(){var e=$(this),t={user_name:f.Settings.user_name};e.length&&A.featuredcontent.deleteService(e,t)}),A.links.AddRss.pane.find(".urloptions").empty(),A.links.AddRss.pane.find(".pane.loading").remove(),$.doTimeout(500,function(){A.EditClickTrack.links("Featured","Rss"),window.location.reload(!0)}))}},a={website:e,platform:t};r.post("add_link",a,i)},refreshFeed:function(e){var t={},i={success:function(t){if("delete"==e)if(t.success){var i=t.recent_headlines.length;if(i>0){for(var o="",n=0;i>n;n++)!t.recent_headlines[n].headline&&f.Settings.user_name&&(t.recent_headlines[n].headline="A post shared by"+f.Settings.user_name),t.recent_headlines[n].feed_title||(t.recent_headlines[n].feed_title=t.recent_headlines[n].site_url),t.recent_headlines[n].post_url||(t.recent_headlines[n].post_url=t.recent_headlines[n].site_url),o+='<li><a href="'+t.recent_headlines[n].post_url+'" target="_blank" class="website"><span class="displayname">'+t.recent_headlines[n].headline+'</span></a><span class="source">'+t.recent_headlines[n].feed_title+"</span></li>";$(".rsswrapper ul.feeds").animate({opacity:0},"normal",function(){$(this).html(o).animate({opacity:1},"normal")})}else $(".rsswrapper").slideUp("slow",function(){$(".bevel-rss").hide(),$(this).hide()}),$.doTimeout(700,function(){A.links.AddRss.showhide()})}else T("profile_headlines returned error");else if("add"==e)if(t.success){var i=t.recent_headlines.length;if(i>0){for(var o="",s=0,n=0;i>n;n++)t.recent_headlines[n].headline==$("ul.feeds li:nth("+n+") a span.displayname").text()&&s++;if(3==s)T("no new feed should be added");else{for(var n=0;i>n;n++)!t.recent_headlines[n].headline&&f.Settings.user_name&&(t.recent_headlines[n].headline="A post shared by"+f.Settings.user_name),t.recent_headlines[n].feed_title||(t.recent_headlines[n].feed_title=t.recent_headlines[n].site_url),t.recent_headlines[n].post_url||(t.recent_headlines[n].post_url=t.recent_headlines[n].site_url),o+='<li><a href="'+t.recent_headlines[n].post_url+'" target="_blank" class="website"><span class="displayname">'+t.recent_headlines[n].headline+'</span></a><span class="source">'+t.recent_headlines[n].feed_title+"</span></li>";if(0==$("#profile_box div.rsswrapper").length){var r='<div class="rsswrapper clearfix invisible"><h4>Latest Posts</h4><ul class="feeds">'+o+"</ul></div>";$("#profile_box div.meta").after(r),$("div.bevel.bevel-services").clone().insertBefore("div.rsswrapper"),$("div.rsswrapper").prev(".bevel").removeClass("bevel-services").addClass("bevel-rss"),$("div.rsswrapper").slideDown("slow",function(){a.trigger("biobox_changed"),a.trigger("resize")})}else $(".rsswrapper ul.feeds").html(o),a.trigger("resize")}}else T("no feed available at this time")}else T("profile_headlines returned error")},error:function(){T("profile_headlines ajax call failed")}};r.post("get_recent_headlines",t,i)}}},A.featuredcontent={init:function(){$("#featuredcontent .buttonbar").tabs({scope:"links",showfirsttab:!1,readquery:!0,setquery:!0,trigger:"li.button",tab:function(e){return $(".customize .featured .tab."+this.o.tabid(e))},tabid:function(e){return e.data("feature")},beforeInit:function(){},beforeSwitch:function(e){return!e.hasClass("disabled")},afterInit:function(){$("ul.rsslist, ul.soundcloudlist, ul.videolist").each(function(){if($(this).children().size()){var e=$(this).parents("div.tab").attr("class").split(" ")[1];e&&$('.customize .featured .button[data-feature="'+e+'"]').trigger("click")}})},afterSwitch:function(){var e=$(".customize .featured ul.buttonbar li.active").data("feature");"rss"!=e&&(A.featuredcontent.Add.pane&&(A.featuredcontent.Add.pane.find("input.text").unbind("keyup"),A.featuredcontent.Add.pane.find("span.addbutton").unbind("click")),A.featuredcontent.Add.init(e))}}),$("#customize-pane-links ul.featuredlist").on("click",".servicedeletebutton",A.featuredcontent.confirmDelete)},confirmSwitch:function(e,t,i,a){if("rss"==e)if("soundcloud"==t)var o="You can feature one type of content at a time.  Do you want to replace your SoundCloud player with your blog articles?";else if("video"==t)var o="You can feature one type of content at a time.  Do you want to replace your video with your blog articles?";if("soundcloud"==e)if("rss"==t)var o="You can feature one type of content at a time.  Do you want to replace your blog articles with your SoundCloud player?";else if("video"==t)var o="You can feature one type of content at a time.  Do you want to replace your video with your SoundCloud player?";if("video"==e)if("rss"==t)var o="You can feature one type of content at a time.  Do you want to replace your blog articles with your video?";else if("soundcloud"==t)var o="You can feature one type of content at a time.  Do you want to replace your SoundCloud player with your video?";var n=function(t){t?"rss"==e?A.links.AddRss.addRSS(i,a):"rss"!=e&&(A.featuredcontent.Add.templates.find(".pane.loading").clone().hide().appendTo(A.featuredcontent.Add.pane).slideToggle("fast"),A.featuredcontent.Add.addVideo(i)):A.featuredcontent.buttonrebind(e)},r={button_labels:["Replace","Cancel"],width:400,open:function(){$.browser.msie&&parseInt($.browser.version)<9&&"soundcloud"==t&&$(".profile div.featured").hide()},close:function(){$.browser.msie&&parseInt($.browser.version)<9&&"soundcloud"==t&&$(".profile div.featured").show(),A.featuredcontent.buttonrebind(e)}};s.confirm(o,n,r)},confirmDelete:function(){var e=$(this).parents("ul.featuredlist li"),t=$(this).parents("ul.featuredlist"),i="Are you sure you want to remove this item?";if(t.hasClass("soundcloudlist"))var i="Are you sure you want to remove your SoundCloud player?";if(t.hasClass("videolist"))var i="Are you sure you want to remove your video?";var a=function(t){t&&A.featuredcontent.deleteService(e,{})},o={button_labels:["Remove","Cancel"],width:400,open:function(){$.browser.msie&&parseInt($.browser.version)<9&&t.hasClass("soundcloudlist")&&$(".profile div.featured").hide()},close:function(){$.browser.msie&&parseInt($.browser.version)<9&&t.hasClass("soundcloudlist")&&$(".profile div.featured").show()}};s.confirm(i,a,o)},deleteService:function(e,t){var i={success:function(){$.doTimeout(200,function(){e.animate({height:0,opacity:0},"normal",function(){e.each(function(){$(this).remove()})})}),e.parents("ul.servicelinklist").hasClass("featuredlist")?($(".profile div.featured iframe").remove(),$(".profile div.featured").addClass("invisible")):e.parents("ul.servicelinklist").hasClass("rsslist")&&($(".profile div.rsswrapper ul.feeds").empty(),$(".profile div.rsswrapper").addClass("invisible")),a.trigger("biobox_changed")},error:function(){var e="An error occurred when trying to delete this feature.";s.error(e)}};e.parents("ul.servicelinklist").hasClass("featuredlist")?r.post("delete_content_video",t,i):e.parents("ul.servicelinklist").hasClass("rsslist")&&r.post("delete_syndication_feed",t,i)},buttonrebind:function(e){"rss"==e?(A.links.AddRss.pane&&(A.links.AddRss.pane.find("input.text").unbind("keyup"),A.links.AddRss.pane.find("span.addbutton").unbind("click")),A.links.AddRss.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,A.links.AddRss.validateURLInput)}),A.links.AddRss.pane.find("span.addbutton").click(A.links.AddRss.validateURLInput)):"rss"!=e&&(A.featuredcontent.Add.pane&&(A.featuredcontent.Add.pane.find("input.text").unbind("keyup"),A.featuredcontent.Add.pane.find("span.addbutton").unbind("click")),A.featuredcontent.Add.pane.find("span.addbutton").click(function(){A.featuredcontent.Add.ValidateURLInput()}),A.featuredcontent.Add.pane.find("input.text").keyup(function(e){l.handleReturnKey(e,function(){A.featuredcontent.Add.ValidateURLInput()})}))},Add:{init:function(e){A.featuredcontent.feature=e,A.featuredcontent.Add.pane=$("#add"+A.featuredcontent.feature+"options"),A.featuredcontent.Add.templates=$("#add"+A.featuredcontent.feature+"options-templates"),A.featuredcontent.buttonrebind(A.featuredcontent.feature)},checkcontent:function(e,t,i){("youtube"==e||"vimeo"==e)&&(e="video");var a=0,o="";if($("ul.rsslist, ul.soundcloudlist, ul.videolist").not("ul."+e+"list").each(function(){$(this).children().size()&&(a++,o=$(this).parents("div.tab").attr("class").split(" ")[1])}),a>0&&"default"!=i)A.links.AddRss.pane.find(".pane.loading").remove(),A.featuredcontent.confirmSwitch(e,o,t,i);else if("rss"==e)A.links.AddRss.addRSS(t,i);else if($("ul."+e+"list").children().size()){if("soundcloud"==e)var n="Are you sure you want to change your SoundCloud URL?";else if("video"==e)var n="Are you sure you want to change your video?";var r=function(i){i?(A.featuredcontent.Add.templates.find(".pane.loading").clone().hide().appendTo(A.featuredcontent.Add.pane).slideToggle("fast"),A.featuredcontent.Add.addVideo(t)):A.featuredcontent.buttonrebind(e)},l={button_labels:["Update","Cancel"],width:400,open:function(){$.browser.msie&&parseInt($.browser.version)<9&&"soundcloud"==e&&$(".profile div.featured").hide()},close:function(){$.browser.msie&&parseInt($.browser.version)<9&&"soundcloud"==e&&$(".profile div.featured").show(),A.featuredcontent.buttonrebind(e)}};s.confirm(n,r,l)}else A.featuredcontent.Add.templates.find(".pane.loading").clone().hide().appendTo(A.featuredcontent.Add.pane).slideToggle("fast"),A.featuredcontent.Add.addVideo(t)},HostnameCheck:function(e){return/soundcloud.com|youtube.com|youtu.be|vimeo.com|snd.sc/i.test(e)?!0:!1},ValidateURLInput:function(){if(A.featuredcontent.Add.pane.find(".urloptions").is(":visible"))A.featuredcontent.Add.pane.find(".urloptions").slideToggle("fast",function(){A.featuredcontent.Add.pane.find(".urloptions").remove(),A.featuredcontent.Add.validateURLInput()});else{A.featuredcontent.Add.pane.find("input.text").unbind("keyup"),A.featuredcontent.Add.pane.find("span.addbutton").unbind("click"),A.featuredcontent.Add.pane.find(".alarum").remove();var e=A.featuredcontent.Add.pane.find("input.text").val();l.validURL(e)&&A.featuredcontent.Add.HostnameCheck(e)?(l.checkRegexp(e,/^((http(s?))\:\/\/).*$/i,"")||(e="http://"+e),A.featuredcontent.Add.checkcontent(A.featuredcontent.feature,e,"")):(A.featuredcontent.Add.pane.find("input.text").after('<span class="alarum">This URL is not valid. Please try again.</span>'),A.featuredcontent.buttonrebind(A.featuredcontent.feature))}},addVideo:function(e){A.setCurrentTab("links");var t={error:function(e){A.featuredcontent.Add.pane.find(".pane.loading").remove(),A.featuredcontent.Add.pane.find("span.alarum").remove(),A.featuredcontent.Add.pane.find("input.text").after("soundcloud"==A.featuredcontent.feature?'<span class="alarum">We’re sorry, we couldn’t add that Soundcloud URL.  Please check it and try again.</span>':"video"==A.featuredcontent.feature||"youtube"==A.featuredcontent.feature||"vimeo"==A.featuredcontent.feature?'<span class="alarum">We’re sorry, we couldn’t add that video URL.  Please check it and try again.</span>':'<span class="alarum">'+e.msg+"</span>"),A.featuredcontent.buttonrebind(A.featuredcontent.feature)},success:function(e){if(1==e.success){var t="video"==A.featuredcontent.feature?video_type:"soundcloud";A.EditClickTrack.links("Featured",t),window.location.reload(!0)}else console.log(e.error)}};"video"==A.featuredcontent.feature&&(video_type=/^((http\:\/\/){0,}(www\.){0,}(vimeo\.com){1}(\/?(.*?)){1})$/i.test(e)?"vimeo":"youtube");var i={url:e};r.post("embed_video",i,t)}}},A.contact={init:function(){$("#customize-pane-contact ul.tabs").tabs({scope:"contact",readquery:!0,setquery:!0,beforeInit:function(){this.checkQuery=A.checkScope,this.setQuery=A.setScope},afterInit:function(){},afterSwitch:function(){A.afterShowTab()}}),A.contact.savers(),A.contactinfo.init()},savers:function(){$("#customize-pane-contact label").click(function(e){e.stopPropagation()}),$('#customize-pane-contact input[type="checkbox"]').on("change",function(){var e=$(this).attr("id"),t=$(this).is(":checked");"email_public"==e?f.Settings.email_public=t:"add_visible"==e?f.Settings.add_visible=t:"allow_fave"==e?f.Settings.allow_fave=t:e.indexOf("share_")>-1?f.Settings.share_buttons[e]=t:e.indexOf("follow_")>-1?(f.Settings.follow_buttons[e]=t,a.trigger("followbuttons_changed")):e.indexOf("display_")>-1&&(f.Settings.compliment_buttons[e]=t),a.trigger("profileactions_changed"),A.save(e,t)})}},A.contactinfo={init:function(){var e=n.customize.country;e||A.contactinfo.disablefield(e,!1),A.contactinfo.Country(e),A.contactinfo.switchstate(e,!1),A.contactinfo.savers()},savers:function(){var e=$("#contactinfo");$("#phone, #country, #address1, #address2, #state, #city, #zip").each(function(){A.updatecache(this.id,$.trim($(this).val()))}),A.cacheUserSettings(f.Settings),e.find("input.phone, input.address1, input.address2, input.city, input.zip, select.country, select.state, input.state").on("keyup change",function(){f.Settings.contact[$(this).data("key")]=$.trim($(this).val()),A.save($(this).data("key"),$.trim($(this).val()))
}),$("input#contact_visible").click(function(e){e.stopPropagation()}),e.find("input#contact_visible").change(function(){var e=$(this).attr("id"),t=$(this).is(":checked");f.Settings[e]=t,A.contactinfo.showhide(),A.save(e,t)}),A.contactinfo.setup("phone"),A.contactinfo.setup("address1"),A.contactinfo.setup("address2"),A.contactinfo.setup("city"),A.contactinfo.setup("zip"),A.contactinfo.setup("state"),e.find("select.country").on("keyup change",function(){var t=$("select.country option:selected").val();A.contactinfo.disablefield(t,!0),e.find("fieldset.country .display").text(t),A.contactinfo.switchstate(t,!0),A.contactinfo.update("country",t),A.contactinfo.showhide()}),e.find("select.state").on("keyup change",function(){var t=$("select.state option:selected").val();e.find("fieldset.state .display").text(t),e.find("fieldset.state input.state").val(t),A.contactinfo.update("state",$(this).val()),A.contactinfo.showhide()})},setup:function(e){var t=$("#contactinfo");t.find("input."+e).on("keyup change",function(){var i=$.trim($(this).val());t.find("fieldset."+e+" .display").text(i),A.contactinfo.update(e,i),A.contactinfo.showhide()})},disablefield:function(e,t){var i=["input.address1","input.address2","input.city","input.zip","select.state","input.state"];e?$.each(i,function(e,t){$("#contactinfo").find(t).prop("disabled",!1).removeClass("ci-inactive")}):($.each(i,function(e,t){$("#contactinfo").find(t).prop("disabled",!0).addClass("ci-inactive")}),t&&A.contactinfo.resetfield(["phone"]))},Country:function(e){var t={},i={success:function(t){if(1==t.success){for(var i="",a=0,o=t.top_countries.length,n="<option disabled>------------------------------------</option>",s=$.merge(t.top_countries,t.countries),r=0;r<s.length;r++)r==o&&(i+=n),s[r]==e?(a=1,i+='<option value="'+s[r]+'" selected>'+s[r]+"</option>"):i+='<option value="'+s[r]+'">'+s[r]+"</option>";i=a&&e?'<option value="">Select Country</option>'+i:'<option value="" selected>Select Country</option>'+i,$("fieldset.country select").html(i),A.contactinfo.switchstate(e,!1)}},error:function(e){T(e.msg),$("fieldset.country").find("label.alarum")&&$("fieldset.country").find("label.alarum").remove(),$("fieldset.country").append('<label class="alarum" for="password" style="">Data loading error.Please try again later.</label>')}};r.post("get_country_data",t,i)},State:function(){var e=f.Settings.state,t={states:"true"},i=0,a={success:function(t){if(1==t.success){for(var a="",o=0;o<t.states.length;o++)e&&t.states[o]==e?(a+='<option value="'+t.states[o]+'" selected>'+t.states[o]+"</option>",i=1):a+='<option value="'+t.states[o]+'">'+t.states[o]+"</option>";a=i&&e?'<option value="">Select State</option>'+a:'<option value="" selected>Select State</option>'+a,$("fieldset.state select").html(a)}},error:function(e){T(e.msg),$("fieldset.state").find("label.alarum")&&$("fieldset.state").find("label.alarum").remove(),$("fieldset.state").append('<label class="alarum" for="password" style="">Data loading error.Please try again later.</label>')}};r.post("get_country_data",t,a)},switchstate:function(e,t){t&&A.contactinfo.resetfield(e?["phone","address1","address2","city","zip","country"]:["phone"]),"United States"==e?(A.contactinfo.State(),$("select.state").hasClass("invisible")&&$("select.state").removeClass("invisible"),$("input.state").hasClass("invisible")||$("input.state").addClass("invisible"),$("fieldset.zip label.label").text("zip"),$("fieldset.state label.label").text("state")):($("select.state").addClass("invisible"),$("input.state").hasClass("invisible")&&$("input.state").removeClass("invisible"),$("select.state").hasClass("invisible")||$("select.state").addClass("invisible"),$("fieldset.zip label.label").text("postal code"),$("fieldset.state label.label").text("province /region"))},resetfield:function(e){var t=e,i=["phone","country","address1","address2","state","city","zip"],a={skip:JSON.stringify(t)},o={success:function(e){1==e.success&&T("date reset successfully")},error:function(){T("failed to reset_contact")}};r.post("reset_contact",a,o),$.each(i,function(e,i){-1==$.inArray(i,t)&&(f.Settings.contact[i]="",$("#contactinfo").find("fieldset."+i+" .display").text(""),$("#contactinfo").find("fieldset."+i+" input").val(""),A.contactinfo.update(i,""))}),A.editField.toggleEmpties(),A.contactinfo.showhide()},update:function(e,t){var i=$(".profile .contactinfo ul.addresslist"),o=i.find("li.address");if(t)switch(e){case"phone":case"address1":case"address2":case"country":$(".profile .contactinfo ul.addresslist").find("."+e).text(t);break;case"city":o.find("li.group span.city").text(o.find("li.group span.state").text()?t+",":t);break;case"state":o.find("li.group span.city").text()&&","!=o.find("li.group span.city").text().substr(-1)?o.find("li.group span.city").text(o.find("li.group span.city").text()+","):!o.find("li.group span.city").text()&&o.find("li.group span.zip").text()&&o.find("li.group span.zip").text(" "+$.trim(o.find("li.group span.zip").text())),o.find("li.group span.state").text(t);break;case"zip":o.find("li.group span.zip").text(o.find("li.group span.state").text()||o.find("li.group span.city").text()?" "+t:t)}else i.find("."+e).empty(),"state"==e&&(o.find("li.group span.city").text()&&o.find("li.group span.city").text(f.Settings.city),o.find("li.group span.zip").text()&&!o.find("li.group span.city").text()&&o.find("li.group span.zip").text($.trim(o.find("li.group span.zip").text())));a.trigger("biobox_changed")},showhide:function(){a.trigger("contactinfo_changed")}},A.getvisitors={init:function(){$("#customize-pane-getvisitors ul.tabs").tabs({scope:"getvisitors",readquery:!0,setquery:!0,beforeInit:function(){this.checkQuery=A.checkScope,this.setQuery=A.setScope},afterInit:function(){}}),A.getvisitors.savers()},savers:function(){$(".getvisitors .tracker a").click(function(e){e.preventDefault();var t=$(this).closest(".tracker").attr("id");$(this).closest(".tracker").fadeOut(200),A.save(t,!0)})}},A.Notifier={timer:null,show:function(){},hide:function(){},fade:function(){}},A.Tooltips={init:function(){$.each(A.Tooltips.tinytips,function(e,t){$(t.attachTo).tinytip(t)})},tinytips:[{name:"backgrounds-tip",attachTo:"#customize-pane-backgrounds .pane-headertext",content:"A picture sets you apart from the rest.  Upload an image, import a favorite photo or make a collage!",arrow:"top"},{name:"instagram-background-tip",attachTo:"#bg-instagram .carousel h4",content:"Your Instagram account must be public to use the images in your background. If your pics don’t show, try refreshing the page.",arrow:"top"},{name:"bg-position-tip",attachTo:".bg-position h4",content:"Align your photo to the left, right or center. You can also drag and drop it directly on your page.",arrow:"bottom"},{name:"biography-tip",attachTo:"#customize-pane-biography .bio label",content:"Great bios are a couple of paragraphs and have a mix of personal and professional info.",arrow:"top"},{name:"tags-tip",attachTo:"#customize-pane-biography .tags .label",content:"List up to 10 hobbies and skills here and people with similar interests will be able find you.",arrow:"top"},{name:"bio-photo-tip",attachTo:"#customize-pane-biography .pic-upload label",content:"Your bio photo will be displayed next to your bio. Headshots work best.",arrow:"bottom"},{name:"patterns-tip",attachTo:"#customize-pane-colors .colorwells:eq(0)",content:"<p>Patterns are layered behind the background photo to enhance your design.</p><p>Note: Your color and pattern may be hidden by your background image.</p>",style:{left:197,top:-127,marginTop:0,marginBottom:0},arrow:"top"},{name:"colors-tip",attachTo:".biocolorsheader",content:"We recommend a primary neutral color for your Fonts along with one or two accent colors.",arrow:"top"},{name:"fonts-tip",attachTo:"#customize-pane-fonts .pane-headertext",content:"Choose the style and size of your fonts. We recommend no more than two different fonts on your page",arrow:"top"},{name:"apps-tip",attachTo:"#customize-pane-apps .pane-headertext",content:"Apps make it easy for people to connect with you on the services you use. Order your apps by dragging them up or down.",arrow:"top"},{name:"links-tip",attachTo:"#customize-pane-links .yourlinksheader",content:"Add links to your page. To rename a link, click the pencil icon. To change the URL, please delete and re-add the link.",arrow:"top"},{name:"feature-tip",attachTo:"#customize-pane-links .yourfeatureheader",content:"Showcase your music, writing or video in your bio box.",arrow:"top"},{name:"feeds-tip",attachTo:"#customize-pane-links .yourfeedsheader",content:"Display your most recent articles on your about.me page by adding your blog URL.",arrow:"top"},{name:"promote-tip",attachTo:"#customize-pane-getvisitors .pane-headertext",content:"Here are some popular ways people use their page. Try them out to get the most out of your page!",arrow:"top"}],tips:[{name:"profile",tours:["edit"],attachTo:"div.profile",content:"Click and drag your bio box to place it anywhere on the page.",style:{marginLeft:-125,left:"50%",top:95},arrow:"top",revealDirection:"up",beforeOpen:function(){T("profile beforeOpen"),A.close()},afterClose:function(){T("profile afterClose"),A.open()}},{name:"background drag",tours:["edit"],attachTo:"div.background-container",content:"You can drag your background image too. Try it!",target:$(".background,#backstretch"),showInIE:!1,style:{marginLeft:180,left:"50%",top:20},arrow:"bottom",revealDirection:"down",beforeOpen:function(){T("background drag afterClose"),A.close()},afterClose:function(){T("background drag afterClose"),A.open()}},{name:"open edit",tours:["edit"],attachTo:".editbutton",content:"Click on Edit Page to update<br />your page anytime.",style:{left:0,top:0,marginLeft:-247,marginTop:-41,zIndex:1e3},arrow:"right",target:$(".editbutton"),revealDirection:"right",moreOn:"click.profileTooltip",beforeOpen:function(){T("open edit beforeOpen"),$(".editbutton").css("position","relative");var e=$(".editbutton").closest(".menu").data("menu");e&&e.show&&e.show()}},{name:"edit tabs",tours:["edit"],attachTo:"#customize",content:"Edit your Background, Biography and Fonts here.",style:{left:0,top:0,marginLeft:-244,marginTop:-13},arrow:"right",moreOn:"mousedown.editTabTooltip",moreText:"Okay, thanks!",revealDirection:"right",target:$("#customize .tabheader a.tab"),beforeOpen:function(){T("edit tabs beforeOpen"),A.open(),parseInt($(".customize").css("top"))<70&&$(".customize").animate({top:70},200)}}]};var I={selectors:{font_name:".profile div.profile-head h1.name",font_heading:".profile div.profile-head h2.headline",font_bio:".profile div.bio",font_findme:".profile ul.links"},fontLoad:function(e){$("#font_loader").show();for(var t=!0,i=0;i<e.items.length;i++)if(e.items[i][0]){var o=e.items[i][1],n=o.split(","),s=I.selectors[e.items[i][0]];if($.fontAvailable(n[0])){a.trigger("biobox_changed");var r=I.fontSwitch(o);$(s).css("font-weight",r[1]).vshow(),$("#font_loader").hide()}else{t=!1;var r=I.fontSwitch(o);I.getPreviewKit(r[0],s,n,r[1])}}return t},fontShow:function(e,t,i){var o=0;$.doTimeout("font_check_"+e,100,function(){if($.fontAvailable(t[0]))return $("#font_loader").hide(),a.trigger("biobox_changed"),$(e).css("font-weight",i).vshow(),!1;try{Typekit.load()}catch(n){}return o++,50==o&&I.visibilityFailsafe(),!0})},getPreviewKit:function(e,t,i,a){var o=document.createElement("script");o.type="text/javascript",o.src="http://use.typekit.net/"+e+".js",$("head").append(o),I.fontShow(t,i,a)},fontSwitch:function(e){var t,i="";switch(e){case"apertura-condensed-1,apertura-condensed-2":i="wui7tzd",t="400";break;case"bree-1,bree-2":i="qco1rxr",t="400";break;case"facitweb-1,facitweb-2":i="bjy5ffq",t="400";break;case"ff-dagny-web-pro-1,ff-dagny-web-pro-2":i="qrp4luu",t="400";break;case"ff-meta-web-pro-1,ff-meta-web-pro-2":i="msy3yks",t="400";break;case"museo-sans-1,museo-sans-2":i="hux7bsa",t="500";break;case"ratio-1,ratio-2":i="fwa3mli",t="400";break;case"ronnia-condensed-1,ronnia-condensed-2":i="rsw0vsk",t="400";break;case"kulturista-web-1,kulturista-web-2":i="lvf1gol",t="400";break;case"museo-slab-1,museo-slab-2":i="hpq8rua",t="300";break;case"sommet-slab-1,sommet-slab-2":i="kmp0kte",t="400";break;case"calluna-1,calluna-2":i="lsi5lcd",t="400";break;case"ff-tisa-web-pro-1,ff-tisa-web-pro-2":i="gmw2nyl",t="400";break;case"lemonde-journal-1,lemonde-journal-2":i="zyb0bhk",t="400";break;case"skolar-1,skolar-2":i="kzj0ary",t="400";break;case"atrament-web-1,atrament-web-2":i="czs0vob",t="400";break;case"aurea-ultra-1,aurea-ultra-2":i="vpt1bkg",t="400";break;case"bello-pro-1,bello-pro-2":i="orm4uip",t="400";break;case"coquette-1,coquette-2":i="ehk1rys",t="400";break;case"snicker-1,snicker-2":i="mga4wgv",t="700";break;case"ff-masala-script-web-pro-1,ff-masala-script-web-pro-2":i="orw5trp",t="400";break;case"maryam-1,maryam-2":i="cfi2mev",t="400";break;case"bigsmalls-bold-1,bigsmalls-bold-2":i="wvp1hks",t="700";break;case"continuo-1,continuo-2":i="qum0tsj",t="400";break;case"corner-store-1,corner-store-2":i="noa2nbd",t="400";break;case"ff-prater-block-web-1,ff-prater-block-web-2":i="arb0imk",t="400";break;case"blackout-2am-1,blackout-2am-2":i="vql6afj",t="400";break;case"teeshirt-1,teeshirt-2":i="qfj1esm",t="400";break;case"kegger-collegiate-1,kegger-collegiate-2":i="yic6uet",t="400";break;case"jbt-annabelle-1,jbt-annabelle-2":i="cau7nof",t="400";break;case"proxima-nova-1,proxima-nova-2":i="vfg7kbz",t="400";break;case"aviano-flare-1,aviano-flare-2":i="sna7vtd",t="500";break;case"english-small-caps-1,english-small-caps-2":i="yat5lvk",t="400";break;case"felt-tip-roman-1,felt-tip-roman-2":i="gpu3kib",t="800";break;case"swingdancer-1,swingdancer-2":i="hih5rwq",t="500";break;case"good-times-1,good-times-2":i="pqu3gdz",t="300";break;case"lobster-1,lobster-2":i="ofi8jom",t="400";break;case"futura-pt-1,futura-pt-2":i="qhq1tjz",t="400";break;case"adelle-1,adelle-2":i="lwc4wwf",t="400";break;case"eigerdals-1,eigerdals-2":i="rld8jar",t="400";break;case"franklin-gothic-urw-1,franklin-gothic-urw-2":i="gmf5ygg",t="400";break;case"ff-dax-web-pro-1,ff-dax-web-pro-2":i="gfi1pmi",t="400";break;case"jaf-lapture-1,jaf-lapture-2":i="inl7wns",t="400";break;case"quatro-1,quatro-2":i="ims3zxb",t="900"}var a=[i,t];return a},visibilityFailsafe:function(){for(var e in I.selectors)$(I.selectors[e]).show().vshow(),a.trigger("biobox_changed");$("#font_loader").hide()}};A.Promos={init:function(){a.ready("biobox_shown",function(){$.doTimeout(1500,A.Promos.fetch)}),$("body").on("click","a.popup",function(e){if(!$(this).hasClass("twitter")||!window.__twitterIntentHandler){e.preventDefault();var t=$(this).attr("href");y.popup(t,{width:700,height:300,centerY:!0})}})},fetch:function(){r.post("display_cta",{page:"user"},{success:function(e){e.cta_id?"backstory_edit_roadblock"===e.cta_id?A.Promos.handlers.backstory_edit_roadblock():A.Promos.setup(e):(T("No promos to display for this user at this time"),T(e))},error:function(e){T.error("Promo ajax request failed"),T(e)}})},setup:function(e){var t={twitter_bio:"Add to Twitter Bio",facebook_timeline:"Add to FB Timeline",share_page:"Share",get_visitors:"Get More Visitors"},i=e.html;if(!i.length)return void T.error("No DOM node found for promo: "+e.cta_id);var n;switch(e.cta_id){case"share_page":n="auto";break;default:n=256}var l={dismissible:!0,delayduration:1e3,type:"profilepromos "+e.cta_id,width:n,customcss:{position:"fixed",bottom:"30px",right:"30px"}};s.bubble(i,l),$(".bubble-close, hh").click(function(){o.log("On-Profile CTA - "+t[e.cta_id]+" Closed"),r.post("display_cta",{cta_id:e.cta_id,page:"user"}),a.one("biobox_shown",function(){$.doTimeout(1500,A.Promos.fetch)})}),A.Promos.handlers[e.cta_id]?A.Promos.handlers[e.cta_id].call(i):$(".link-content, hh").click(function(){o.log("On-Profile CTA - "+t[e.cta_id]+" Clicked")}),o.log("On-Profile CTA - "+t[e.cta_id]+" Displayed")},handlers:{backstory_edit_roadblock:function(){a.ready("below:ok-to-show-modals",function(){var e=new C.EditRoadblockView,t=$("<div></div>");t.dialog({modalView:e,dialogClass:"backstory-roadblock-modal",overlayClass:"km-backstory-roadblock-modal-overlay",width:465,height:"auto",position:"center",disableScrolling:!0,autoDestroy:!0,clickOverlayToClose:!0});var i=function(e){e=e||{};var t={cta_id:"backstory_roadblock",page:"dashboard"};r.post("display_cta",t,e)};e.on("confirm",function(){i({complete:function(){t.dialog("close"),a.trigger("below:scrollto",["backstory"])}})}),e.on("cancel",i),t.on("dialogclose",i),o.click(".backstory-roadblock-modal .confirm","Backstory Edit Roadblock - Clicked Yes"),o.click(".backstory-roadblock-modal .cancel","Backstory Edit Roadblock - Clicked Cancel")})},twitter_bio:function(){$(".link-content.add_twitter_bio, promo").click(function(){o.log("On-Profile CTA - Add to Twitter Bio Clicked"),r.post("update_twitter_profile",{},{success:function(){s.banner("Your Twitter profile link was updated!"),$(".bubble-close, promo").click()},error:function(){s.error("Sorry, we couldn’t update your Twitter profile link at this time. Please try again later.")}})})},share_page:function(){var t,i="http://twitter.com/intent/tweet?text=",a="http://"+e.DOMAIN_NAME+"/"+f.Settings.user_name;t="Check out my @aboutdotme page - "+a+". Get yours now before all the names are gone. http://about.me",i+=encodeURIComponent(t),$("a.button.twitter, promo").attr("href",i),$("a.button.twitter, promo").click(function(){o.log("On-Profile CTA - Shared on Twitter")});var n="http://www.facebook.com/share.php?u="+encodeURIComponent(a);$("a.button.facebook, promo").attr("href",n),$("a.button.facebook, promo").click(function(){o.log("On-Profile CTA - Shared on Facebook")});var s="http://www.linkedin.com/shareArticle?url="+encodeURIComponent(a);$("a.button.linkedin, promo").attr("href",s),$("a.button.linkedin, promo").click(function(){o.log("On-Profile CTA - Shared on Linkedin")})}}},A.EditClickTrack={init:function(){$("ul.customize-tabs li").on("click",function(){var e=$(this).data("section")?$(this).data("section"):"unknown";o.log("Edit Panel Navigation",{"tab clicks":"clicked "+e})})},background:function(e){e?o.log("Background: "+e):$(".bg-position .bgpositionoptions .button-content").on("click",function(){var e=$(this).parent(".button").data("value")?$(this).parent(".button").data("value"):"unknown";o.log("Position",{option:e})})},colors:function(){$("#background_patterns li .img-container, #background_patterns li .checkmark").on("click",function(){var e=$(this).parent("li.pattern_thumb").hasClass("active")?"no":"yes";o.log("Patterns",{added:e})})},promote:function(){$("#customize-pane-getvisitors ul.tabs li a").on("click",function(){var e=$(this).attr("href")?$(this).attr("href").substr(1):"unknown";o.log("Promote: Clicks "+e)})},links:function(e,t){o.log(e+": added "+t)}},A.ProgressBar={init:function(e,t,i){var a=$("<div />").progressbar(i,{autowidth:!1}).css(t);$(e).css({position:"relative"}).contents().vhide(),$(e).append(a),A.ProgressBar.show(e,t)},show:function(e){$(e).find(".progressbar").fadeIn(250)},hide:function(e){$(e).find(".progressbar").remove(),$(e).contents().vshow()}};var R={XD:[],markup:$('<div id="editapp" style="display:none"><div class="pane creatingframe"><h4><img src="'+e.STATIC_HOSTNAME+'/images/ajax/ajax-loader-alt2.gif" alt="Loading Indicator" class="loading" /> <span class="loadingtext">Loading...</span></h4></div><div class="pane error"><h4>Error</h4></div><div id="iframe-container"></div></div>'),init:function(){$("head").append('<link rel="stylesheet" type="text/css" href="'+e.STATIC_HOSTNAME+'/css/view/addapp.css" />');var t=$(this).parents("ul.servicelist li");R.current=t.data("platform"),R.pane=R.markup,R.pane.dialog({title:"Edit "+$(".service-name",t).html()+" Settings",autoOpen:!0,dialogClass:"editapp",disableScrolling:!0,width:580,open:function(){$(this);R.getEditUrl()},close:function(){R.XD[R.current].destroy(),R.XD[R.current]=null,R.pane.remove()}})},getEditUrl:function(){var e={service_name:R.current,user_name:f.Settings.user_name,type:"edit"},t={success:function(e){R.setupIframe(e.appurl)},error:function(){}};r.post("app_url",e,t)},setupIframe:function(e){R.pane.find(".pane.creatingframe").show(),R.XD[R.current]=new easyXDM.Socket({lazy:!1,remote:e,swf:"http://d2ed0w4q03gsmw.cloudfront.net/core/easyxdm/easyxdm.swf",interval:100,props:{scrolling:"no"},container:"iframe-container",onMessage:function(e){R.iframeMessage.incoming(e)},onReady:function(){setTimeout(function(){R.pane.find(".pane.creatingframe").hide(),R.pane.find("iframe").css("position","static")},100)}}),$.doTimeout("check-load-"+R.current,1e4,function(){R.pane.find(".pane.creatingframe").hide(),R.pane.find(".pane.error").show().find("h4").html("Ooops… Error loading URL."),T("page failing to load: "+R.current)})},iframeMessage:{incoming:function(e){var t=$.parseJSON(e);switch(t.method){case"loaded":$.doTimeout("check-load-"+R.current),T(R.current+" page is loaded");break;case"setHeight":T("height is "+t.height),R.pane.find("iframe").attr("height",t.height);break;case"cancelProcess":R.XD[R.current].destroy(),R.XD[R.current]=null,R.pane.dialog("close");break;case"newPage":R.XD[R.current].destroy(),R.XD[R.current]=null,R.setupIframe(t.url);break;case"updateApp":R.updateApp(t)}},outgoing:function(e,t){R.XD[t.id].postMessage(e)}},updateApp:function(e){var t={success:function(){R.pane.dialog("close")},error:function(){}};r.post("register_app",{update_only:!0,service_name:R.current,api_args:e.api_args,service_url:e.service_url,display_name:e.display_name,config_url:e.config_url,remove_url:e.remove_url,site_url:e.site_url},t)}};return $(document).ready(A.init),{Customize:A}});
//# sourceMappingURL=edit.js.map